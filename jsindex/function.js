function jilubianhua(){currentsvgghtml=svgg.innerHTML;currentgggghtml=gggg.innerHTML;oldsvgghtml[bushu]=svgg.innerHTML;oldgggghtml[bushu]=gggg.innerHTML;bushu=oldsvgghtml.length;console.log("mmmmm");console.log(bushu)}function handleFiles(B){svgg.innerHTML="";if(B.length){var C=B[0];var A=new FileReader();A.onload=function(){document.getElementById("filecontent").innerHTML=this.result};A.readAsText(C)}setTimeout(chanshengshiliangtu,1000)}function gettargetDiv(A){if(A.tagName=="body"){return null}if(A.parentNode.tagName=="DIV"){return A.parentNode}else{return gettargetDiv(A.parentNode)}}function gettargetG(A){if(A.tagName=="svg"){return null}if(A.parentNode.tagName=="g"&&A.parentNode.parentNode.parentNode.tagName=="svg"){return A.parentNode}else{return gettargetG(A.parentNode)}}function tianjiaShiZi(){var C=$(svgg).children("circle");if(C==null||C==undefined){return}var A=gggg.childNodes;var D=0;for(var F=0;F<C.length;F++){if(C[F].getAttribute("class")=="shoucontrol"){cx=parseInt(C[F].getAttribute("cx"));cy=parseInt(C[F].getAttribute("cy"));r=parseInt(C[F].getAttribute("r"));move=[];move1=[];lineto=[];lineto1=[];move.push(cx-r);move.push(cy);lineto.push(cx+r);lineto.push(cy);move1.push(cx);move1.push(cy-r);lineto1.push(cx);lineto1.push(cy+r);A[D].setAttribute("d","M"+move.join(" ")+" L"+lineto.join(" ")+" M"+move1.join(" ")+" L"+lineto1.join(" "));D++}}C=$(svgg).children("g");if(C==null||C==undefined){return}var E;for(var F=0;F<C.length;F++){if(C[F].getAttribute("class")=="zuhedian"){E=$(C[F]).children("circle");for(var B=0;B<E.length;B++){if(E[B].getAttribute("class")=="shoucontrol"){cx=parseInt(E[B].getAttribute("cx"));cy=parseInt(E[B].getAttribute("cy"));r=parseInt(E[B].getAttribute("r"));move=[];move1=[];lineto=[];lineto1=[];move[0]=cx-r;move[1]=cy;lineto[0]=cx+r;lineto[1]=cy;move1[0]=cx;move1[1]=cy-r;lineto1[0]=cx;lineto1[1]=cy+r;A[D].setAttribute("d","M"+move.join(" ")+" L"+lineto.join(" ")+" M"+move1.join(" ")+" L"+lineto1.join(" "));D++}}}}}function showfuhaozuattr(A){var B=[];B.push({"name":"fill","value":diantarget.childNodes[0].getAttribute("fill"),"group":"fuhaozu","editor":{type:"text",options:{required:true,},},});B.push({"name":"font-size","value":diantarget.childNodes[0].getAttribute("font-size"),"group":"fuhaozu","editor":{type:"text",options:{required:true,},},});B.push({"name":"zujianju","value":diantarget.getAttribute("zujianju"),"group":"fuhaozu","editor":{type:"text",options:{required:true,},},});B.push({"name":"符号序列","value":diantarget.getAttribute("fuhaozuxulie"),"group":"fuhaozu","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showzuhelineattr(A){var B=[];B.push({"name":"stroke","value":diantarget.childNodes[0].getAttribute("stroke"),"group":"zuheline","editor":{type:"text",options:{required:true,},},});B.push({"name":"stroke-width","value":diantarget.childNodes[0].getAttribute("stroke-width"),"group":"zuheline","editor":{type:"text",options:{required:true,},},});B.push({"name":"zujianju","value":diantarget.getAttribute("zujianju"),"group":"zuheline","editor":{type:"text",options:{required:true,},},});B.push({"name":"组合线数","value":diantarget.getAttribute("linecount"),"group":"zuheline","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showzuhedianattr(A){var B=[];B.push({"name":"stroke","value":diantarget.childNodes[0].getAttribute("stroke"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"stroke-width","value":diantarget.childNodes[0].getAttribute("stroke-width"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"fill","value":diantarget.childNodes[0].getAttribute("fill"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"zujianju","value":diantarget.getAttribute("zujianju"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"zuhedianjianju","value":diantarget.getAttribute("zuhedianjianju"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"受控点数","value":diantarget.getAttribute("shoukongdiancount"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"控制点数","value":diantarget.getAttribute("kongzhidiancount"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showzuhedianattrsingle(A){var B=[];B.push({"name":"stroke","value":diantarget.childNodes[0].getAttribute("stroke"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"stroke-width","value":diantarget.childNodes[0].getAttribute("stroke-width"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"fill","value":diantarget.childNodes[0].getAttribute("fill"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"zujianju","value":diantarget.getAttribute("zujianju"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"受控点数","value":diantarget.getAttribute("shoukongdiancount"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"控制点数","value":diantarget.getAttribute("kongzhidiancount"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showgattr(A){var B=[];B.push({"name":"stroke","value":$(diantarget).children("circle")[0].getAttribute("stroke"),"group":"g","editor":{type:"text",options:{required:true,},},});B.push({"name":"stroke-width","value":$(diantarget).children("circle")[0].getAttribute("stroke-width"),"group":"g","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showfuhaoattr(A){var B=[];B.push({"name":"fill","value":A.target.getAttribute("fill"),"group":"text","editor":{type:"text",options:{required:true,},},});B.push({"name":"font-size","value":A.target.getAttribute("font-size"),"group":"text","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showzhilineattr(A){var B=[];B.push({"name":"stroke","value":A.target.getAttribute("stroke"),"group":"line","editor":{type:"text",options:{required:true,},},});B.push({"name":"stroke-width","value":A.target.getAttribute("stroke-width"),"group":"line","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showshoucontrol(A){var B=[];B.push({"name":"stroke","value":A.target.getAttribute("stroke"),"group":"shoucontrol","editor":{type:"text",options:{required:true,},},});B.push({"name":"stroke-width","value":A.target.getAttribute("stroke-width"),"group":"shoucontrol","editor":{type:"text",options:{required:true,},},});B.push({"name":"fill","value":A.target.getAttribute("fill"),"group":"shoucontrol","editor":{type:"text",options:{required:true,},},});B.push({"name":"r","value":A.target.getAttribute("r"),"group":"shoucontrol","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showcontrol(A){var B=[];B.push({"name":"stroke","value":A.target.getAttribute("stroke"),"group":"control","editor":{type:"text",options:{required:true,},},});B.push({"name":"stroke-width","value":A.target.getAttribute("stroke-width"),"group":"control","editor":{type:"text",options:{required:true,},},});B.push({"name":"fill","value":A.target.getAttribute("fill"),"group":"control","editor":{type:"text",options:{required:true,},},});B.push({"name":"r","value":A.target.getAttribute("r"),"group":"control","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showsvattr(B){var C=[];C.push({"name":"stroke","value":svg.childNodes[2].getAttribute("stroke"),"group":"svg","editor":{type:"text",options:{required:true,},},});C.push({"name":"stroke-width","value":svg.childNodes[2].getAttribute("stroke-width"),"group":"svg","editor":{type:"text",options:{required:true,},},});C.push({"name":"background","value":svg.getAttribute("background"),"group":"svg","editor":{type:"text",options:{required:true,},},});var A=[{"value":"yes","text":"yes"},{"value":"no","text":"no"}];C.push({"name":"gridvisible","value":svg.getAttribute("gridvisible"),"group":"svg","editor":{panelHeight:20,type:"combobox",options:{data:A,valueField:"value",textField:"text",panelHeight:40,onChange:function(I,F){if(I=="no"){var G=svg.childNodes;for(var H=0;H<G.length;H++){if(G[H].tagName=="line"){G[H].setAttribute("visibility","hidden")}}}else{var G=svg.childNodes;for(var H=0;H<G.length;H++){if(G[H].tagName=="line"){G[H].setAttribute("visibility","shown")}}}},},},});var D=svg.childNodes[2].getAttribute("stroke-dasharray").split(",")[0];if(D=="0"){D="line"}else{D="dot"}var E=[{"value":"line","text":"line"},{"value":"dot","text":"dot"}];C.push({"name":"gridstyle","value":D,"group":"svg","editor":{type:"combobox",options:{data:E,valueField:"value",textField:"text",panelHeight:40,onChange:function(I,F){if(I=="line"){var G=svg.childNodes;for(var H=0;H<G.length;H++){if(G[H].tagName=="line"){G[H].setAttribute("stroke-dasharray","0,0")}}}else{var G=svg.childNodes;for(var H=0;H<G.length;H++){if(G[H].tagName=="line"){G[H].setAttribute("stroke-dasharray","2,2")}}}},},},});$("#propertydiv").propertygrid("loadData",C)}function pushsvgcombo(){}function getDuijioffset(A){var B={offsetX:0,offsetY:0};var D=A.offsetX;var C=A.offsetY;if(D%wanggewidthh>wanggewidthh/2){D=Math.floor(D/wanggewidthh)*wanggewidthh+wanggewidthh}else{D=Math.floor(D/wanggewidthh)*wanggewidthh}if(C%wanggewidthv>wanggewidthv/2){C=Math.floor(C/wanggewidthv)*wanggewidthv+wanggewidthv}else{C=Math.floor(C/wanggewidthv)*wanggewidthv}B.offsetX=D;B.offsetY=C;return B}function getviewxy(A,E,C){var B=A.childNodes;for(var D=0;D<B.length;D++){switch(B[D].tagName){case"line":E.push(parseInt(B[D].getAttribute("x1")));E.push(parseInt(B[D].getAttribute("x2")));C.push(parseInt(B[D].getAttribute("y1")));C.push(parseInt(B[D].getAttribute("y2")));break;case"text":E.push(parseInt(B[D].getAttribute("x")));C.push(parseInt(B[D].getAttribute("y")));break;case"circle":E.push(parseInt(B[D].getAttribute("cx")));C.push(parseInt(B[D].getAttribute("cy")));break;default:break}}}function save(){$("#svgname1").window({title:"保存",width:230,height:100,collapsible:false,minimizable:false,maximizable:false,closable:true,closed:false,zIndex:9999,draggable:true,resizable:false,shadow:false,inline:false,modal:true,onclose:function(){document.getElementById("svgname1").style.display="none";$("#svgname1").window("close")}});$("#svgname1").window("move",{left:window.innerWidth/2,top:window.innerHeight/2,});document.getElementById("svgname1").style.display="block"}function save1(){var C=svgg.childNodes;xarray=[];yarray=[];for(var F=0;F<C.length;F++){switch(C[F].tagName){case"line":xarray.push(parseInt(C[F].getAttribute("x1")));xarray.push(parseInt(C[F].getAttribute("x2")));yarray.push(parseInt(C[F].getAttribute("y1")));yarray.push(parseInt(C[F].getAttribute("y2")));break;case"text":xarray.push(parseInt(C[F].getAttribute("x")));yarray.push(parseInt(C[F].getAttribute("y")));break;case"circle":xarray.push(parseInt(C[F].getAttribute("cx")));yarray.push(parseInt(C[F].getAttribute("cy")));break;case"g":getviewxy(C[F],xarray,yarray);break;default:break}}xarray=xarray.sort(sortNumber);yarray=yarray.sort(sortNumber);console.log(xarray);console.log(yarray);minx=parseInt(xarray[0])-40;miny=parseInt(yarray[0])-40;minx=minx==0?minx:0;miny=miny==0?miny:0;maxx=parseInt(xarray[xarray.length-1])+50;maxy=parseInt(yarray[yarray.length-1])+50;var A=document.createElementNS(SVG_NS,"svg");A.setAttribute("viewBox",minx+" "+miny+" "+maxx+" "+maxy);A.setAttribute("xmlns","http://www.w3.org/2000/svg");A.setAttribute("width","100px");A.setAttribute("height","100px");$(A).append(svgg.outerHTML);$(A).append(gggg.outerHTML);var E=A.outerHTML;var D=svgg.outerHTML;var G=gggg.outerHTML;var B=document.getElementById("svgname").value;$.post("servlet/SaveServlet",{aa:E,bb:D,cc:G,dd:1,ee:B},function(H){if(H.msg=="yes"){alert("保存成功")}});document.getElementById("svgname1").style.display="none";$("#svgname1").window("close")}function tanchuTiShiKuang(){$("#box").window({title:"提示",width:140,height:60,collapsible:false,minimizable:false,maximizable:false,closable:false,closed:false,zIndex:9999,draggable:true,resizable:false,shadow:false,inline:false,modal:true,});$("#box").window("move",{left:window.innerWidth/2,top:window.innerHeight/2,});document.getElementById("box").style.display="block";setTimeout(function(){document.getElementById("box").style.display="none";$("#box").window("close")},1000);gongjutype="rectimage";gongjushape=null}function isInRect(C){var D=parseInt(gongjushape.getAttribute("x"));var E=parseInt(gongjushape.getAttribute("y"));var F=parseInt(gongjushape.getAttribute("width"))+parseInt(D);var G=parseInt(gongjushape.getAttribute("height"))+parseInt(E);switch(C.tagName){case"line":var I=parseInt(C.getAttribute("x1"));var H=parseInt(C.getAttribute("x2"));var B=parseInt(C.getAttribute("y1"));var A=parseInt(C.getAttribute("y2"));if(I>=D&&H<=F&&B>=E&&A<=G){return true}else{return false}break;case"text":var I=parseInt(C.getAttribute("x"));var B=parseInt(C.getAttribute("y"));if(I>=D&&I<=F&&B>=E&&B<=G){return true}else{return false}break;case"circle":var I=parseInt(C.getAttribute("cx"));var B=parseInt(C.getAttribute("cy"));if(I>=D&&I<=F&&B>=E&&B<=G){return true}else{return false}break;default:break}}function getviewxy1(C,F,D,A){var B=C.childNodes;for(var E=0;E<B.length;E++){switch(B[E].tagName){case"line":if(isInRect(B[E])){$(A).append(B[E].outerHTML);F.push(parseInt(B[E].getAttribute("x1")));F.push(parseInt(B[E].getAttribute("x2")));D.push(parseInt(B[E].getAttribute("y1")));D.push(parseInt(B[E].getAttribute("y2")))}break;case"text":if(isInRect(B[E])){$(A).append(B[E].outerHTML);F.push(parseInt(B[E].getAttribute("x")));D.push(parseInt(B[E].getAttribute("y")))}break;case"circle":if(isInRect(B[E])){$(A).append(B[E].outerHTML);F.push(parseInt(B[E].getAttribute("cx")));D.push(parseInt(B[E].getAttribute("cy")))}break;default:break}}}function savetolocal(){var L=document.createElementNS(SVG_NS,"g");var D=svgg.childNodes;xarray=[];yarray=[];for(var F=0;F<D.length;F++){switch(D[F].tagName){case"line":if(isInRect(D[F])){$(L).append(D[F].outerHTML);xarray.push(parseInt(D[F].getAttribute("x1")));xarray.push(parseInt(D[F].getAttribute("x2")));yarray.push(parseInt(D[F].getAttribute("y1")));yarray.push(parseInt(D[F].getAttribute("y2")))}break;case"text":if(isInRect(D[F])){$(L).append(D[F].outerHTML);xarray.push(parseInt(D[F].getAttribute("x")));yarray.push(parseInt(D[F].getAttribute("y")))}break;case"circle":if(isInRect(D[F])){$(L).append(D[F].outerHTML);xarray.push(parseInt(D[F].getAttribute("cx")));yarray.push(parseInt(D[F].getAttribute("cy")))}break;case"g":getviewxy1(D[F],xarray,yarray,L);break;default:break}}var D=gggg.childNodes;var B=parseInt(gongjushape.getAttribute("x"));var C=parseInt(gongjushape.getAttribute("y"));var E=parseInt(gongjushape.getAttribute("width"))+parseInt(B);var J=parseInt(gongjushape.getAttribute("height"))+parseInt(C);for(var F=0;F<D.length;F++){var A=D[F].getAttribute("d").split(" ");var I=A[1]-(A[1]-A[0].substr(1,A[0].length-1))/2;var G=A[3]-(A[3]-A[2].substr(1,A[2].length-1))/2;if(I>=B&&I<=E&&G>=C&&G<=J){$(L).append(D[F].outerHTML)}}xarray=xarray.sort(sortNumber);yarray=yarray.sort(sortNumber);console.log(xarray);console.log(yarray);minx=parseInt(xarray[0])-40;miny=parseInt(yarray[0])-40;minx=minx==0?minx:0;miny=miny==0?miny:0;maxx=parseInt(xarray[xarray.length-1])+50;maxy=parseInt(yarray[yarray.length-1])+50;var H=document.createElementNS(SVG_NS,"svg");H.setAttribute("viewBox",minx+" "+miny+" "+maxx+" "+maxy);H.setAttribute("xmlns","http://www.w3.org/2000/svg");H.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");H.setAttribute("width","100px");H.setAttribute("height","100px");$(H).append(L.outerHTML);var K='<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE svg>'+H.outerHTML;shengchongImage(K);svgg.removeChild(gongjushape)}function shengchongImage(B){canvg(svgcanvas,B);var A=document.getElementById("svgcanvas").toDataURL("image/png");$("#canvgimage").window({title:"生成图片",width:230,height:230,collapsible:false,minimizable:false,maximizable:false,closable:true,closed:false,zIndex:9999,draggable:true,resizable:false,shadow:false,inline:false,modal:true,onclose:function(){document.getElementById("canvgimage").style.display="none";$("#canvgimage").window("close")}});$("#canvgimage").window("move",{left:window.innerWidth/2,top:window.innerHeight/2,});console.log(A);document.getElementById("canvgimage").style.display="block";document.getElementById("ccc").src=A}function sortNumber(B,A){return B-A}function gettimeid(){var A=new Date();return"svg"+A.getTime()}function getPosition(B){B=B||window.event;var A={x:0,y:0};if(B.clientX||B.clientY){A.x=B.offsetX;A.y=B.offsetY}else{A.x=B.clientX+document.body.scrollLeft-document.body.clientLeft;A.y=B.clientY+document.documentElement.scrollTop}return A}function getxy(A){switch(A){case"rect":return"x:y";break;case"text":return"x:y";break;case"circle":return"cx:cy";break;case"ellipse":return"cx:cy";break;case"polygon":return"points";break;case"polyline":return"points";break;case"line":return"x1:y1:x2:y2";break;case"path":return"ML";break;default:break}}function initialg(J){for(var D=0;D<J.childNodes.length;D++){var I=J.childNodes[D];if(I.childNodes.length!=0&&I.tagName!="text"){initialg(I)}else{switch(getxy(J.childNodes[D].tagName)){case"x:y":if(I.tagName=="text"){var F=I.getAttribute("transform");if(F!=undefined&&F!=null){var B=F.indexOf("(");var N=F.substr(B+1,F.length-2-B);var E=N.split(",");E[0]=E[0]-0;E[1]=E[1]-offx;E[2]=E[2]-offy;I.setAttribute("transform","rotate("+E.join(",")+")")}}I.setAttribute("x",I.getAttribute("x")-offx);I.setAttribute("y",I.getAttribute("y")-offy);break;case"cx:cy":console.log(I.getAttribute("cy")+"ddddd");I.setAttribute("cx",I.getAttribute("cx")-offx);I.setAttribute("cy",I.getAttribute("cy")-offy);break;case"points":if(I.getAttribute("points").indexOf(",")!=-1){var L=I.getAttribute("points").split(" ");var M=L[0].split(",");var O=L[1].split(",");M[0]=M[0]-offx;M[1]=M[1]-offy;O[0]=O[0]-offx;O[1]=O[1]-offy;L[0]=M.join(",");L[1]=O.join(",");I.setAttribute("points",L.join(" "))}else{var M=I.getAttribute("points").split(" ");for(var C=0;C<M.length;C++){M[C]=M[C]-offx;C++;M[C]=M[C]-offy}I.setAttribute("points",M.join(" "))}break;case"x1:y1:x2:y2":I.setAttribute("x1",I.getAttribute("x1")-offx);I.setAttribute("y1",I.getAttribute("y1")-offy);I.setAttribute("x2",I.getAttribute("x2")-offx);I.setAttribute("y2",I.getAttribute("y2")-offy);break;case"ML":var K=I.getAttribute("d");var Q="";if(K.indexOf("A")!=-1){if(K.indexOf(" ")==1){var A=K.split(" ");var P=A.length;A[1]=A[1]-offx;A[2]=A[2]-offy;A[P-2]=A[P-2]-offx;A[P-1]=A[P-1]-offy;Q=A.join(" ");I.setAttribute("d",Q);continue}else{var A=K.split(" ");var H=A[0].substr(1,A[0].length-1).split(",");var G=A[A.length-1].split(",");H[0]=H[0]-offx;H[1]=H[1]-offy;G[0]=G[0]-offx;G[1]=G[1]-offy;Q="M"+H.join(",");for(var C=1;C<A.length-1;C++){Q=Q+" "+A[C]}Q=Q+" "+G.join(",");I.setAttribute("d",Q);continue}}if(K.indexOf(" ")==1&&K.indexOf(",")==-1){var H=K.split(" ");H[1]=H[1]-offx;H[2]=H[2]-offy;Q=H.join(" ");I.setAttribute("d",Q);continue}if(K.indexOf(" ")==1){var A=K.replace(/\ L/g,"#L").split("#");console.log(K.replace(/\ L/g,"#L"));var H=null;for(var C=0;C<A.length;C++){H=A[C].split(" ");H[1]=H[1]-offx;H[2]=H[2]-offy;console.log(A);console.log(H+"pppp");Q=Q+H.join(" ")+" "}I.setAttribute("d",Q.substr(0,Q.length-1))}else{var A=K.substr(1,K.length-1).split(" ");var H=A[0].split(",");H[0]=H[0]-offx;H[1]=H[1]-offy;console.log(A);console.log(H);Q="M"+H.join(",")+" "+A[1];if(A.length==3){Q=Q+A[2]}I.setAttribute("d",Q)}break;default:break}}}}function create(D,A){var H=shapeinfo[D].indexOf(">");var L=shapeinfo[D].substr(3,H-3);var J=shapeinfo[D].substr(H+1,shapeinfo[D].length-5-H);var C=document.createElementNS(SVG_NS,"g");var E=L.replace(/\" /g,'"!').split("!");var G;var I;while(E.length){G=E.shift().split("=");D=G[0];I=C.getAttribute(D)||G[1];if(I!=undefined){I=I.substr(1,I.length-2)}else{I=""}if(D!=""){C.setAttribute(D,I)}}$(C).html(J);$(svgg).append(C);var B=$(C).find("circle")[0];console.log(B);var F=A.offsetX;var K=A.offsetY;console.log(F+"eeee");if(F%wanggewidth>wanggewidth/2){F=Math.floor(F/wanggewidth)*wanggewidth+wanggewidth}else{F=Math.floor(F/wanggewidth)*wanggewidth}if(K%wanggewidth>wanggewidth/2){K=Math.floor(K/wanggewidth)*wanggewidth+wanggewidth}else{K=Math.floor(K/wanggewidth)*wanggewidth}offx=B.getAttribute("cx")-F;offy=B.getAttribute("cy")-K;hideshowciecle(C,"hidden");initialg(C);C.setAttribute("id",gettimeid())}function hideshowciecle(A,C){var B=A.childNodes;for(var D=0;D<B.length;D++){if(B[D].tagName=="g"){hideshowciecle(B[D],C)}else{if(B[D].tagName=="circle"&&B[D].getAttribute("tishi")=="yes"){B[D].style.visibility=C}}}}function moveg(J,O,C){for(var D=0;D<J.childNodes.length;D++){var I=J.childNodes[D];if(I.childNodes.length!=0&&I.tagName!="text"){moveg(I)}else{switch(getxy(J.childNodes[D].tagName)){case"x:y":if(I.tagName=="text"){var F=I.getAttribute("transform");if(F!=undefined&&F!=null){var B=F.indexOf("(");var N=F.substr(B+1,F.length-2-B);var E=N.split(",");E[0]=E[0]-0;E[1]=E[1]-offx+O;E[2]=E[2]-offy+C;I.setAttribute("transform","rotate("+E.join(",")+")")}}I.setAttribute("x",I.getAttribute("x")-offx+O);I.setAttribute("y",I.getAttribute("y")-offy+C);break;case"cx:cy":I.setAttribute("cx",I.getAttribute("cx")-offx+O);I.setAttribute("cy",I.getAttribute("cy")-offy+C);break;case"points":if(I.getAttribute("points").indexOf(",")!=-1){var L=I.getAttribute("points").split(" ");var M=L[0].split(",");var Q=L[1].split(",");M[0]=M[0]-offx+O;M[1]=M[1]-offy+C;Q[0]=Q[0]-offx+O;Q[1]=Q[1]-offy+C;L[0]=M.join(",");L[1]=Q.join(",");I.setAttribute("points",L.join(" "))}else{var M=I.getAttribute("points").split(" ");for(var P=0;P<M.length;P++){M[P]=M[P]-offx+O;P++;M[P]=M[P]-offy+C}I.setAttribute("points",M.join(" "))}break;case"x1:y1:x2:y2":I.setAttribute("x1",I.getAttribute("x1")-offx+O);I.setAttribute("y1",I.getAttribute("y1")-offy+C);I.setAttribute("x2",I.getAttribute("x2")-offx+O);I.setAttribute("y2",I.getAttribute("y2")-offy+C);break;case"ML":var K=I.getAttribute("d");var S="";if(K.indexOf("A")!=-1){if(K.indexOf(" ")==1){var A=K.split(" ");var R=A.length;A[1]=A[1]-offx+O;A[2]=A[2]-offy+C;A[R-2]=A[R-2]-offx+O;A[R-1]=A[R-1]-offy+C;S=A.join(" ");I.setAttribute("d",S);continue}else{var A=K.split(" ");var H=A[0].substr(1,A[0].length-1).split(",");var G=A[A.length-1].split(",");H[0]=H[0]-offx+O;H[1]=H[1]-offy+C;G[0]=G[0]-offx+O;G[1]=G[1]-offy+C;S="M"+H.join(",");for(var P=1;P<A.length-1;P++){S=S+" "+A[P]}S=S+" "+G.join(",");I.setAttribute("d",S);continue}}if(K.indexOf(" ")==1&&K.indexOf(",")==-1){var H=K.split(" ");H[1]=H[1]-offx+O;H[2]=H[2]-offy+C;S=H.join(" ");I.setAttribute("d",S);continue}if(K.indexOf(" ")==1){var A=K.replace(/\ L/g,"#L").split("#");console.log(K.replace(/\ L/g,"#L"));var H=null;for(var P=0;P<A.length;P++){H=A[P].split(" ");H[1]=H[1]-offx+O;H[2]=H[2]-offy+C;S=S+H.join(" ")+" "}I.setAttribute("d",S.substr(0,S.length-1))}else{var A=K.substr(1,K.length-1).split(" ");var H=A[0].split(",");H[0]=H[0]-offx+O;H[1]=H[1]-offy+C;S="M"+H.join(",")+" "+A[1];I.setAttribute("d",S)}break;default:break}}}}function createzuheline(){var E=document.getElementById("linecount").value;var B=parseInt(document.getElementById("linelong").value);var C=parseInt(document.getElementById("jianjuline").value);var A=document.createElementNS(SVG_NS,"g");A.setAttribute("class","zuheline");A.setAttribute("zujianju",C);A.setAttribute("linecount",E);A.setAttribute("linelong",B);var D;for(var F=0;F<E;F++){D=document.createElementNS(SVG_NS,"line");D.setAttribute("x1",eee.offsetX);D.setAttribute("y1",eee.offsetY+F*C*10);D.setAttribute("x2",eee.offsetX+B*10);D.setAttribute("y2",eee.offsetY+F*C*10);D.setAttribute("stroke","black");D.setAttribute("stroke-width",2);D.setAttribute("fill","none");D.setAttribute("class","zuheline");D.setAttribute("id",gettimeid());A.appendChild(D)}document.getElementById("zuhelinediv").style.display="none";$("#zuhelinediv").window("close");svgg.appendChild(A);jilubianhua()}function createzuhelineByAttrGrid(B,H,D,C){var G=B;var F=parseInt(H.getAttribute("linelong"));var I=parseInt(H.getAttribute("zujianju"));H.setAttribute("linecount",G);var A;for(var E=0;E<G;E++){A=document.createElementNS(SVG_NS,"line");A.setAttribute("x1",D);A.setAttribute("y1",C+E*I*10);A.setAttribute("x2",D+F*10);A.setAttribute("y2",C+E*I*10);A.setAttribute("stroke","black");A.setAttribute("stroke-width",2);A.setAttribute("fill","none");A.setAttribute("class","zuheline");A.setAttribute("id",gettimeid());H.appendChild(A)}jilubianhua()}function tanchuzuhelinecanshu(A){$("#zuhelinediv").window({title:"组合线参数",width:110,height:140,collapsible:false,minimizable:false,maximizable:false,closable:true,closed:false,zIndex:9999,draggable:true,resizable:false,shadow:false,inline:false,modal:false,onClose:function(){},});$("#zuhelinediv").window("move",{left:A.clientX,top:A.clientY,});document.getElementById("zuhelinediv").style.display="block";eee=getDuijioffset(A)}function createzuhedian(){var D=parseInt(document.getElementById("kongzhidiancount").value);var H=parseInt(document.getElementById("shoukongdiancount").value);var F=D+H;var B=parseInt(document.getElementById("jianjudian").value);zuhedianjianju=B;var L=document.createElementNS(SVG_NS,"g");L.setAttribute("class","zuhedian");L.setAttribute("zujianju",zuhedianjianju);L.setAttribute("issingle","yes");L.setAttribute("kongzhidiancount",D);L.setAttribute("shoukongdiancount",H);var C=document.createElementNS(SVG_NS,"line");C.setAttribute("x1",eee.offsetX);C.setAttribute("y1",eee.offsetY);C.setAttribute("x2",eee.offsetX);C.setAttribute("y2",eee.offsetY+(F-1)*B*10);C.setAttribute("stroke","black");C.setAttribute("stroke-width",2);C.setAttribute("fill","none");L.appendChild(C);var E=document.createElementNS(SVG_NS,"rect");E.setAttribute("x",eee.offsetX-8);E.setAttribute("y",eee.offsetY);E.setAttribute("width",16);E.setAttribute("height",(F-1)*B*10);E.setAttribute("stroke","black");E.setAttribute("stroke-width",1);E.setAttribute("fill","white");E.setAttribute("opacity",0);L.appendChild(E);var I;var G;var A;var M;var K;for(var J=0;J<F;J++){K=document.createElementNS("http://www.w3.org/2000/svg","circle");K.setAttribute("cx",eee.offsetX);K.setAttribute("cy",eee.offsetY+J*B*10);K.setAttribute("stroke-width",1);K.setAttribute("id",gettimeid()+parseInt(Math.random()*100));if(J<D){K.setAttribute("stroke","black");K.setAttribute("r",8);K.setAttribute("fill","black");K.setAttribute("class","control")}else{K.setAttribute("stroke","red");K.setAttribute("r",11);K.setAttribute("fill","white");K.setAttribute("class","shoucontrol");I=parseInt(eee.offsetX);G=parseInt(eee.offsetY+J*B*10);A=11;M=document.createElementNS("http://www.w3.org/2000/svg","path");move=[];move1=[];lineto=[];lineto1=[];move.push(I-A);move.push(G);lineto.push(I+A);lineto.push(G);move1.push(I);move1.push(G-A);lineto1.push(I);lineto1.push(G+A);M.setAttribute("d","M"+move.join(" ")+" L"+lineto.join(" ")+" M"+move1.join(" ")+" L"+lineto1.join(" "));M.setAttribute("stroke","black");M.setAttribute("stroke-width",2);console.log(M.getAttribute("d"));gggg.appendChild(M)}L.appendChild(K)}document.getElementById("zuhediandiv").style.display="none";$("#zuhediandiv").window("close");svgg.appendChild(L);jilubianhua()}function createzuhedianByAttrGrid(M,C,L,I,H,A){var P=M;var Q=C;var F=P+Q;var G=parseInt(L.getAttribute("zujianju"));L.setAttribute("kongzhidiancount",P);L.setAttribute("shoukongdiancount",Q);var E=document.createElementNS(SVG_NS,"line");E.setAttribute("x1",I);E.setAttribute("y1",H);E.setAttribute("x2",I);E.setAttribute("y2",H+(F-1)*G*10);E.setAttribute("stroke","black");E.setAttribute("stroke-width",2);E.setAttribute("fill","none");L.appendChild(E);var K=document.createElementNS(SVG_NS,"rect");K.setAttribute("x",I-8);K.setAttribute("y",H);K.setAttribute("width",16);K.setAttribute("height",(F-1)*G*10);K.setAttribute("stroke","black");K.setAttribute("stroke-width",1);K.setAttribute("fill","white");K.setAttribute("opacity",0);L.appendChild(K);var D;var O;var N;var B;var R;for(var J=0;J<F;J++){R=document.createElementNS("http://www.w3.org/2000/svg","circle");R.setAttribute("cx",I);R.setAttribute("cy",H+J*G*10);R.setAttribute("stroke-width",1);R.setAttribute("id",gettimeid()+parseInt(Math.random()*100));if(A==0){if(J<C){R.setAttribute("stroke","red");R.setAttribute("r",11);R.setAttribute("fill","white");R.setAttribute("class","shoucontrol");D=parseInt(I);O=parseInt(H+J*G*10);N=11;B=document.createElementNS("http://www.w3.org/2000/svg","path");move=[];move1=[];lineto=[];lineto1=[];move.push(D-N);move.push(O);lineto.push(D+N);lineto.push(O);move1.push(D);move1.push(O-N);lineto1.push(D);lineto1.push(O+N);B.setAttribute("d","M"+move.join(" ")+" L"+lineto.join(" ")+" M"+move1.join(" ")+" L"+lineto1.join(" "));B.setAttribute("stroke","black");B.setAttribute("stroke-width",2);gggg.appendChild(B)}else{R.setAttribute("stroke","black");R.setAttribute("r",8);R.setAttribute("fill","black");R.setAttribute("class","control")}}else{if(J<P){R.setAttribute("stroke","black");R.setAttribute("r",8);R.setAttribute("fill","black");R.setAttribute("class","control")}else{R.setAttribute("stroke","red");R.setAttribute("r",11);R.setAttribute("fill","white");R.setAttribute("class","shoucontrol");D=parseInt(I);O=parseInt(H+J*G*10);N=11;B=document.createElementNS("http://www.w3.org/2000/svg","path");move=[];move1=[];lineto=[];lineto1=[];move.push(D-N);move.push(O);lineto.push(D+N);lineto.push(O);move1.push(D);move1.push(O-N);lineto1.push(D);lineto1.push(O+N);B.setAttribute("d","M"+move.join(" ")+" L"+lineto.join(" ")+" M"+move1.join(" ")+" L"+lineto1.join(" "));B.setAttribute("stroke","black");B.setAttribute("stroke-width",2);gggg.appendChild(B)}}L.appendChild(R)}tianjiaShiZi();jilubianhua()}function tanchuzuhediancanshu(A){$("#zuhediandiv").window({title:"组合点参数",width:110,height:140,collapsible:false,minimizable:false,maximizable:false,closable:true,closed:false,zIndex:9999,draggable:true,resizable:false,shadow:false,inline:false,modal:false,});$("#zuhediandiv").window("move",{left:A.clientX,top:A.clientY,});document.getElementById("zuhediandiv").style.display="block";eee=getDuijioffset(A)}function createfuhaozu(){var A=document.createElementNS(SVG_NS,"g");A.setAttribute("class","fuhaozu");A.setAttribute("zujianju",2);var B=document.getElementById("fuhaoshu").value;A.setAttribute("fuhaozuxulie",B);var C=document.getElementById("zifujianju").value;for(var D=0;D<B.length;D++){gongjushape=document.createElementNS(SVG_NS,"text");gongjushape.setAttribute("x",eee.offsetX);gongjushape.setAttribute("y",parseInt(eee.offsetY)+C*10*D);gongjushape.setAttribute("font-family","Verdana");gongjushape.setAttribute("font-size","15pt");gongjushape.setAttribute("fill","black");gongjushape.setAttribute("text-anchor","start");gongjushape.setAttribute("type","comment");gongjushape.setAttribute("class","fuhao");gongjushape.innerHTML=B[D];gongjushape.setAttribute("id",gettimeid());A.appendChild(gongjushape)}document.getElementById("fuhaozudiv").style.display="none";$("#fuhaozudiv").window("close");svgg.appendChild(A);jilubianhua()}function createfuhaozuByAttrGrid(C,A,D,B){A.setAttribute("fuhaozuxulie",C);var E=parseInt(A.getAttribute("zujianju"));for(var F=0;F<C.length;F++){gongjushape=document.createElementNS(SVG_NS,"text");gongjushape.setAttribute("x",D);gongjushape.setAttribute("y",parseInt(B)+E*10*F);gongjushape.setAttribute("font-family","Verdana");gongjushape.setAttribute("font-size","15pt");gongjushape.setAttribute("fill","black");gongjushape.setAttribute("text-anchor","start");gongjushape.setAttribute("type","comment");gongjushape.setAttribute("class","fuhao");gongjushape.innerHTML=C[F];gongjushape.setAttribute("id",gettimeid());A.appendChild(gongjushape)}jilubianhua()}function tanchufuhaozucanshu(A){$("#fuhaozudiv").window({title:"符号组参数",width:200,height:90,collapsible:false,minimizable:false,maximizable:false,closable:true,closed:false,zIndex:9999,draggable:true,resizable:false,shadow:false,inline:false,modal:false,});$("#fuhaozudiv").window("move",{left:A.clientX,top:A.clientY,});document.getElementById("fuhaozudiv").style.display="block";eee=getDuijioffset(A)}function chanshengshiliangtu(){var N=document.getElementById("filecontent").innerHTML;console.log(N.split(" "));var O=N.indexOf("BEGIN");var C=N.substring(0,O);var I=C.substring(C.indexOf(" ")+1,C.indexOf("\n")).split(",");var E=N.substring(O+6,N.indexOf("END"));var T=E.replace(/\n/g," ").split(" ");console.log(T);var W;var P;var L=80;var V=80;var R=30;var J=0;var D=0;var Q=0;var A=0;for(var F=1;F<T.length-1;F=F+2){var B=T[F].split(",");var K=document.createElementNS("http://www.w3.org/2000/svg","g");K.setAttribute("class","zuhedian");K.setAttribute("zujianju",3);K.setAttribute("zujianjuall",3);K.setAttribute("zuhedianjianju",3);var U=L+parseInt(F/2)*R;var S=document.createElementNS(SVG_NS,"rect");S.setAttribute("x",U-8);S.setAttribute("width",16);S.setAttribute("stroke","black");S.setAttribute("stroke-width",1);S.setAttribute("fill","white");S.setAttribute("opacity",0);K.appendChild(S);for(var G=0;G<B.length;G++){W=document.createElementNS("http://www.w3.org/2000/svg","circle");W.setAttribute("stroke-width",1);W.setAttribute("cx",U);W.setAttribute("id",gettimeid()+parseInt(Math.random()*100));if(B.length==1){var H=B[G].toUpperCase().charCodeAt()-65;W.setAttribute("cy",V+H*R);W.setAttribute("stroke","red");W.setAttribute("r",11);W.setAttribute("fill","white");W.setAttribute("class","shoucontrol");svgg.appendChild(W);cx=parseInt(U);cy=parseInt(V+H*R);r=11;path1=document.createElementNS("http://www.w3.org/2000/svg","path");move=[];move1=[];lineto=[];lineto1=[];move.push(cx-r);move.push(cy);lineto.push(cx+r);lineto.push(cy);move1.push(cx);move1.push(cy-r);lineto1.push(cx);lineto1.push(cy+r);path1.setAttribute("d","M"+move.join(" ")+" L"+lineto.join(" ")+" M"+move1.join(" ")+" L"+lineto1.join(" "));path1.setAttribute("stroke","black");path1.setAttribute("stroke-width",2);console.log(path1.getAttribute("d"));gggg.appendChild(path1)}else{var H=B[G].toUpperCase().charCodeAt()-65;if(G==0){J=H;D=H}else{if(J>H){J=H}if(D<H){D=H}}S.setAttribute("y",J*R+V);S.setAttribute("height",(D-J)*R);if(G==B.length-1){W.setAttribute("cy",V+H*R);W.setAttribute("stroke","black");W.setAttribute("r",11);W.setAttribute("fill","white");W.setAttribute("class","shoucontrol");cx=parseInt(U);cy=parseInt(V+H*R);r=11;path1=document.createElementNS("http://www.w3.org/2000/svg","path");move=[];move1=[];lineto=[];lineto1=[];move.push(cx-r);move.push(cy);lineto.push(cx+r);lineto.push(cy);move1.push(cx);move1.push(cy-r);lineto1.push(cx);lineto1.push(cy+r);path1.setAttribute("d","M"+move.join(" ")+" L"+lineto.join(" ")+" M"+move1.join(" ")+" L"+lineto1.join(" "));path1.setAttribute("stroke","black");path1.setAttribute("stroke-width",2);console.log(path1.getAttribute("d"));A++;gggg.appendChild(path1)}else{W.setAttribute("cy",V+H*R);W.setAttribute("stroke","black");W.setAttribute("r",8);W.setAttribute("fill","black");W.setAttribute("class","control");Q++}K.appendChild(W)}}if(B.length!=1){P=document.createElementNS("http://www.w3.org/2000/svg","line");P.setAttribute("stroke-width",2);P.setAttribute("stroke","black");P.setAttribute("x1",U);P.setAttribute("y1",J*R+V);P.setAttribute("x2",U);P.setAttribute("y2",D*R+V);K.setAttribute("kongzhidiancount",Q);K.setAttribute("shoukongdiancount",A);K.appendChild(P);svgg.appendChild(K)}Q=0;A=0}var K=document.createElementNS(SVG_NS,"g");K.setAttribute("class","zuheline");K.setAttribute("zujianju",3);K.setAttribute("tfcproduct","yes");K.setAttribute("zujianjuall",3);K.setAttribute("linecount",I.length);K.setAttribute("linelong",parseInt(T.length/2)*R/10+R/10);var M;for(var F=0;F<I.length;F++){M=document.createElementNS(SVG_NS,"line");M.setAttribute("x1",L-R);M.setAttribute("y1",V+F*R);M.setAttribute("x2",L+parseInt(T.length/2)*R);M.setAttribute("y2",V+F*R);M.setAttribute("stroke","black");M.setAttribute("stroke-width",2);M.setAttribute("fill","none");M.setAttribute("class","zuheline");M.setAttribute("id",gettimeid());K.appendChild(M)}svgg.appendChild(K);var K=document.createElementNS(SVG_NS,"g");K.setAttribute("class","fuhaozu");K.setAttribute("zujianju",3);K.setAttribute("zujianjuall",3);K.setAttribute("fuhaozuxulie",I.join(""));for(var F=0;F<I.length;F++){gongjushape=document.createElementNS(SVG_NS,"text");gongjushape.setAttribute("x",L-R-20);gongjushape.setAttribute("y",V+F*R);gongjushape.setAttribute("font-family","Verdana");gongjushape.setAttribute("font-size","15pt");gongjushape.setAttribute("fill","black");gongjushape.setAttribute("text-anchor","start");gongjushape.setAttribute("type","comment");gongjushape.setAttribute("class","fuhao");gongjushape.innerHTML=I[F];gongjushape.setAttribute("id",gettimeid());K.appendChild(gongjushape)}svgg.appendChild(K);var K=document.createElementNS(SVG_NS,"g");K.setAttribute("class","fuhaozu");K.setAttribute("zujianju",3);K.setAttribute("zujianjuall",3);K.setAttribute("fuhaozuxulie",I.join(""));for(var F=0;F<I.length;F++){gongjushape=document.createElementNS(SVG_NS,"text");gongjushape.setAttribute("x",L+parseInt(T.length/2)*R+20);gongjushape.setAttribute("y",V+F*R);gongjushape.setAttribute("font-family","Verdana");gongjushape.setAttribute("font-size","15pt");gongjushape.setAttribute("fill","black");gongjushape.setAttribute("text-anchor","start");gongjushape.setAttribute("type","comment");gongjushape.setAttribute("class","fuhao");gongjushape.innerHTML=I[F];gongjushape.setAttribute("id",gettimeid());K.appendChild(gongjushape)}svgg.appendChild(K);jilubianhua()}function tianjialineonmousemove(A){A.onmouseenter=function(){A.setAttribute("stroke","aqua");A.setAttribute("stroke-width",5)};A.onmouseout=function(){A.setAttribute("stroke","black");A.setAttribute("stroke-width",2)}};