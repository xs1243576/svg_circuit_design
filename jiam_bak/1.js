var oldsvgghtml=[];var oldgggghtml=[];var currentsvgghtml="";var currentgggghtml="";var bushu=0;var tdarray=document.getElementsByTagName("td");var colorshow=document.getElementById("colorshow");var colorvalue=document.getElementById("colorvalue");var colorwindow=document.getElementById("colorwindow");var guanbi=document.getElementById("guanbi");var diantarget;var SVG_NS="http://www.w3.org/2000/svg";var rulerCursorX=document.getElementById("rulerCursorX");var rulerCursorY=document.getElementById("rulerCursorY");var rulerCursorX1=document.getElementById("rulerCursorX1");var rulerCursorY1=document.getElementById("rulerCursorY1");var gongjutype;var gongjushape=null;var scrolltop;var scrollleft;var eee;var lineh=document.createElementNS("http://www.w3.org/2000/svg","line");var linev=document.createElementNS("http://www.w3.org/2000/svg","line");var offx;var offy;var offx1;var offy1;var zuhedianjianju;var pathh;var cx;var cy;var r;var d;var move=[];var move1=[];var lineto=[];var lineto1=[];var circlearray=new Array();var colorline;var minx;var miny;var maxx;var maxy;var xarray;var yarray;var wanggewidth=10;var shapeinfo={hadamard:'<g createshape="hadamard"><line x1="10" y1="50" x2="30" y2="50" stroke="black" stroke-width="1" /><line x1="70" y1="50" x2="90" y2="50" stroke="black" stroke-width="1"/><rect x="30" y="30" width="40" height="40" fill="white" stroke="black" stroke-width="1" /><text x="50" y="60" font-family="Verdana" font-size="20pt" fill="black" text-anchor="middle">H</text><circle tishi="yes" cx="10" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="90" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /></g>',paulix:'<g createshape="paulix"><line x1="10" y1="50" x2="30" y2="50" stroke="black" stroke-width="1" /><line x1="70" y1="50" x2="90" y2="50" stroke="black" stroke-width="1" /><rect x="30" y="30" width="40" height="40" fill="white" stroke="black" stroke-width="1" /><text x="50" y="60" font-family="Verdana" font-size="20pt" fill="black" text-anchor="middle">X</text><circle tishi="yes" cx="10" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="90" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /></g>',pauliy:'<g createshape="pauliy"><line x1="10" y1="50" x2="30" y2="50" stroke="black" stroke-width="1" /><line x1="70" y1="50" x2="90" y2="50" stroke="black" stroke-width="1" /><rect x="30" y="30" width="40" height="40" fill="white" stroke="black" stroke-width="1" /><text x="50" y="60" font-family="Verdana" font-size="20pt" fill="black" text-anchor="middle">Y</text><circle tishi="yes" cx="10" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="90" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /></g>',pauliz:'<g createshape="pauliz"><line x1="10" y1="50" x2="30" y2="50" stroke="black" stroke-width="1" /><line x1="70" y1="50" x2="90" y2="50" stroke="black" stroke-width="1" /><rect x="30" y="30" width="40" height="40" fill="white" stroke="black" stroke-width="1" /><text x="50" y="60" font-family="Verdana" font-size="20pt" fill="black" text-anchor="middle">Z</text><circle tishi="yes" cx="10" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="90" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /></g>',XiangWeiMen:'<g createshape="XiangWeiMen"><line x1="10" y1="50" x2="30" y2="50" stroke="black" stroke-width="1" /><line x1="70" y1="50" x2="90" y2="50" stroke="black" stroke-width="1" /><rect x="30" y="30" width="40" height="40" fill="white" stroke="black" stroke-width="1" /><text x="50" y="60" font-family="Verdana" font-size="20pt" fill="black" text-anchor="middle">S</text><circle tishi="yes" cx="10" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="90" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /></g>',TMen:'<g createshape="TMen"><line x1="10" y1="50" x2="30" y2="50" stroke="black" stroke-width="1" /><line x1="70" y1="50" x2="90" y2="50" stroke="black" stroke-width="1" /><rect x="30" y="30" width="40" height="40" fill="white" stroke="black" stroke-width="1" /><text x="50" y="60" font-family="Verdana" font-size="20pt" fill="black" text-anchor="middle">T</text><circle tishi="yes" cx="10" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="90" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /></g>',shoukongfeimen:'<g createshape="shoukongfeimen"><circle cx="50" cy="30" r="3" stroke="black" stroke-width="1" fill="black" /><circle cx="50" cy="70" r="5" stroke="black" stroke-width="1" fill="none" /><line x1="30" y1="30" x2="70" y2="30" stroke="black" stroke-width="1" /><line x1="30" y1="70" x2="70" y2="70" stroke="black" stroke-width="1" /><line x1="50" y1="30" x2="50" y2="76" stroke="black" stroke-width="1" /><circle tishi="yes" cx="30" cy="30" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="70" cy="30" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="30" cy="70" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="70" cy="70" r="3" stroke="black" stroke-width="1" fill="black" /></g>',jiaohuanmen:'<g createshape="jiaohuanmen"><line x1="45" y1="25" x2="55" y2="35" stroke="black" stroke-width="1" /><line x1="45" y1="65" x2="55" y2="75" stroke="black" stroke-width="1" /><line x1="45" y1="35" x2="55" y2="25" stroke="black" stroke-width="1" /><line x1="45" y1="75" x2="55" y2="65" stroke="black" stroke-width="1" /><line x1="30" y1="30" x2="70" y2="30" stroke="black" stroke-width="1" /><line x1="30" y1="70" x2="70" y2="70" stroke="black" stroke-width="1" /><line x1="50" y1="30" x2="50" y2="70" stroke="black" stroke-width="1" /><circle tishi="yes" cx="30" cy="30" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="70" cy="30" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="30" cy="70" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="70" cy="70" r="3" stroke="black" stroke-width="1" fill="black" /></g>',shoukongZmen:'<g createshape="shoukongZmen"><circle cx="50" cy="30" r="3" stroke="black" stroke-width="1" fill="black" /><line x1="30" y1="30" x2="70" y2="30" stroke="black" stroke-width="1" /><line x1="30" y1="70" x2="40" y2="70" stroke="black" stroke-width="1" /><line x1="60" y1="70" x2="70" y2="70" stroke="black" stroke-width="1" /><line x1="50" y1="30" x2="50" y2="60" stroke="black" stroke-width="1" /><rect x="40" y="60" width="20" height="20" fill="white" stroke="black" stroke-width="1" /><text x="50" y="75" font-family="Verdana" font-size="10pt" fill="black" text-anchor="middle">Z</text><circle tishi="yes" cx="30" cy="30" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="70" cy="30" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="30" cy="70" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="70" cy="70" r="3" stroke="black" stroke-width="1" fill="black" /></g>',shoukongxiangweimen:'<g createshape="shoukongxiangweimen"><circle cx="50" cy="30" r="3" stroke="black" stroke-width="1" fill="black" /><line x1="30" y1="30" x2="70" y2="30" stroke="black" stroke-width="1" /><line x1="30" y1="70" x2="40" y2="70" stroke="black" stroke-width="1" /><line x1="60" y1="70" x2="70" y2="70" stroke="black" stroke-width="1" /><line x1="50" y1="30" x2="50" y2="60" stroke="black" stroke-width="1" /><rect x="40" y="60" width="20" height="20" fill="white" stroke="black" stroke-width="1" /><text x="50" y="75" font-family="Verdana" font-size="10pt" fill="black" text-anchor="middle">S</text><circle tishi="yes" cx="30" cy="30" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="70" cy="30" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="30" cy="70" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="70" cy="70" r="3" stroke="black" stroke-width="1" fill="black" /></g>',toffoli:'<g createshape="toffoli"><circle cx="50" cy="30" r="3" stroke="black" stroke-width="1" fill="black" /><circle cx="50" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /><line x1="30" y1="30" x2="70" y2="30" stroke="black" stroke-width="1" /><line x1="30" y1="50" x2="70" y2="50" stroke="black" stroke-width="1" /><line x1="30" y1="70" x2="70" y2="70" stroke="black" stroke-width="1" /><line x1="50" y1="30" x2="50" y2="75" stroke="black" stroke-width="1" /><circle cx="50" cy="70" r="5" stroke="black" stroke-width="1" fill="none" /><circle tishi="yes" cx="30" cy="30" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="70" cy="30" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="30" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="70" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="30" cy="70" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="70" cy="70" r="3" stroke="black" stroke-width="1" fill="black" /></g>',fredkinmen:'<g createshape="fredkinmen"><circle cx="50" cy="30" r="3" stroke="black" stroke-width="1" fill="black" /><line x1="30" y1="30" x2="70" y2="30" stroke="black" stroke-width="1" /><line x1="30" y1="50" x2="70" y2="50" stroke="black" stroke-width="1" /><line x1="30" y1="70" x2="70" y2="70" stroke="black" stroke-width="1" /><line x1="50" y1="30" x2="50" y2="70" stroke="black" stroke-width="1" /><line x1="45" y1="45" x2="55" y2="55" stroke="black" stroke-width="1" /><line x1="45" y1="65" x2="55" y2="75" stroke="black" stroke-width="1" /><line x1="45" y1="55" x2="55" y2="45" stroke="black" stroke-width="1" /><line x1="45" y1="75" x2="55" y2="65" stroke="black" stroke-width="1" /><circle tishi="yes" cx="30" cy="30" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="70" cy="30" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="30" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="70" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="30" cy="70" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="70" cy="70" r="3" stroke="black" stroke-width="1" fill="black" /></g>',celiangyunsuan:'<g createshape="celiangyunsuan"><line x1="20" y1="50" x2="40" y2="50" stroke="black" stroke-width="1" /><rect x="40" y="35" width="30" height="30" fill="white" stroke="black" stroke-width="1" /><line x1="55" y1="60" x2="61" y2="43" stroke="black" stroke-width="1" /><polygon points="59 41 63 44 64 37" fill="none" stroke="black" stroke-width="1" /><path d="M45,55 A10,10 0 0,1 65,55" fill="none" stroke="black" stroke-width="1"></path><circle tishi="yes" cx="20" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /></g>',jingdianbite:'<g createshape="jingdianbite"><line x1="20" y1="46" x2="80" y2="46" stroke="black" stroke-width="2" /><line x1="20" y1="54" x2="80" y2="54" stroke="black" stroke-width="2" /><circle tishi="yes" cx="20" cy="46" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="80" cy="46" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="20" cy="54" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="80" cy="54" r="3" stroke="black" stroke-width="1" fill="black" /></g>',nliangzibite:'<g createshape="nliangzibite"><line x1="20" y1="50" x2="80" y2="50" stroke="black" stroke-width="1" /><line x1="47" y1="55" x2="53" y2="45" stroke="black" stroke-width="1" /><text x="58" y="46" font-family="Verdana" font-size="10pt" fill="black" text-anchor="middle">n</text><circle tishi="yes" cx="20" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /><circle tishi="yes" cx="80" cy="50" r="3" stroke="black" stroke-width="1" fill="black" /></g>'};var gggg=document.createElementNS("http://www.w3.org/2000/svg","g");var pointt;var userid=null;var isgroupsvg=false;var svgorgroupsvg=null;var cannotsavetomysql=false;var polyline=null;var type=null;var isstroke=false;var txt=null;document.getElementById("body").style.height=window.innerHeight-35+"px";document.getElementById("body").style.width=window.innerWidth+"px";$("#shangyibu").linkbutton({text:"上一步",iconCls:"icon-undo",iconAlign:"left",});$("#xiayibu").linkbutton({text:"下一步",iconCls:"icon-redo",iconAlign:"left",});$("#huanyuan").linkbutton({text:"还原",iconCls:"icon-reload",iconAlign:"left",});$("#save").linkbutton({text:"保存到数据库",iconCls:"icon-save",iconAlign:"left",});$("#savelocal").linkbutton({text:"保存到本地",iconCls:"icon-save",iconAlign:"left",});$("#shanchu").linkbutton({text:"删除",disabled:true,iconCls:"icon-no",iconAlign:"left",});$("#qingkong").linkbutton({text:"清空",iconCls:"icon-clear",iconAlign:"left",});$("#svgcombo").combogrid({panelWidth:650,idField:"id",textField:"id",value:"查看自己量子电路作品",columns:[[{field:"id",title:"编号",width:120,},{field:"name",title:"作品名",width:120,},{field:"username",title:"作者",width:120,},{field:"time",title:"创建时间",width:120,},{field:"type",title:"权限",width:120,},]],onClickRow:function(B,A){var C=$("#svgcombo").combogrid("grid").datagrid("getSelected");$.post("servlet/Getsvgservlet",{aa:C.id,},function(D){console.log(D);isgroupsvg=false;svgorgroupsvg=C.id;svgg.innerHTML=D.svggcontent;gggg.innerHTML=D.ggggcontent})},onShowPanel:function(){if(userid==null){$("#svgcombo").combogrid("hidePanel");alert("请登录");return}else{$("#svgcombo").combogrid("grid").datagrid("reload","servlet/GetAllServlet?id="+userid)}},data:[{"id":1,"name":"蜡笔小新","username":"sdafads","imageurl":"fsdaf","time":"2014-10-1","type":1,},{"id":1,"name":"蜡笔小新","username":"sdafads","imageurl":"fsdaf","time":"2014-10-1","type":1,}],});$("#zuzuopin").combogrid({panelWidth:650,idField:"id",textField:"user",value:"组作品",columns:[[{field:"id",title:"组作品编号",width:120,},{field:"username",title:"组创建者",width:120,},{field:"svgname",title:"作品名",width:120,},{field:"time",title:"创建时间",width:120,},{field:"menber",title:"组成员",width:120,editor:{panelHeight:20,type:"combobox",options:{valueField:"value",textField:"text",panelHeight:40,}}},]],onShowPanel:function(){$("#zuzuopin").combogrid("grid").datagrid("reload","servlet/GetGroupInfoservlet?id="+userid)},onClickRow:function(B,A){var C=$("#zuzuopin").combogrid("grid").datagrid("getSelected");$.post("servlet/Getgroupsvgservlet",{aa:C.id,},function(F){console.log(F);isgroupsvg=true;svgorgroupsvg=C.id;var D=C.menber.substr(1,C.menber.length-2).split(",");var E=document.getElementById("yonghuming").innerHTML;if(E==C.username){alert("同步编辑开始");ws_init();svgg.innerHTML=F.svggcontent;gggg.innerHTML=F.ggggcontent;return}console.log(D[D.indexOf(E)+1]);if($.inArray(E,D)!=-1){if(D[D.indexOf(E)+1]==" 1"){alert("同步编辑开始");ws_init();ws_send=ws_send_copy}else{cannotsavetomysql=true;ws_init();ws_send=nullfunction;alert("不可以同步编辑，只可以观看")}}svgg.innerHTML=F.svggcontent;gggg.innerHTML=F.ggggcontent})},onCheck:function(B,A){console.log(B)},onUnselect:function(C,A){var B=$("#zuzuopin").combogrid("grid").datagrid("getEditor",{index:C,field:"menber"}).target;B.combobox("showPanel")},});var gridvisible=[{"value":"yes","text":"yes"},{"value":"no","text":"no"}];$("#all").combogrid({panelWidth:525,idField:"id",textField:"user",value:"查看所有量子电路作品",url:"servlet/GetAllPublicServlet",columns:[[{field:"id",title:"编号",width:120,},{field:"name",title:"作品名",width:120,},{field:"username",title:"作者",width:120,},{field:"time",title:"创建时间",width:120,},{field:"type",title:"权限",width:120,},]],onClickRow:function(C,A){var D=$("#all").combogrid("grid").datagrid("getSelected");var B=document.getElementById("yonghuming").innerHTML;if(B!=D.username){if(D.type=="公开只读"){cannotsavetomysql=true;alert("编辑后将不保存到数据库，但可以保存到本地")}}$.post("servlet/Getsvgservlet",{aa:D.id,},function(E){console.log(E);isgroupsvg=false;svgorgroupsvg=D.id;svgg.innerHTML=E.svggcontent;gggg.innerHTML=E.ggggcontent})},onShowPanel:function(){$("#all").combogrid("grid").datagrid("reload","servlet/GetAllPublicServlet")},});$("#gongju").window({title:"绘制工具",width:150,height:100,collapsible:true,minimizable:false,maximizable:false,closable:false,closed:false,zIndex:9999,draggable:true,resizable:false,shadow:false,inline:false,modal:false,});$("#gongju").window("move",{left:window.innerWidth-600,top:6,});$("#wiretools").window({title:"图形工具",width:145,height:95,collapsible:true,minimizable:false,maximizable:false,closable:false,closed:false,zIndex:9999,draggable:true,resizable:false,shadow:false,inline:false,modal:false,});$("#wiretools").window("move",{left:window.innerWidth-900,top:6,});var counttd=0;for(var x=0;x<16;x=x+3){for(var y=0;y<16;y=y+3){for(var z=0;z<16;z=z+3){tdarray[counttd].style.backgroundColor="#"+getcchar(x)+getcchar(x)+getcchar(y)+getcchar(y)+getcchar(z)+getcchar(z);counttd++}}}function getcchar(A){switch(A){case 12:return"C";break;case 15:return"F";break;default:return A;break}}$("#propertydiv").propertygrid({width:270,height:"auto",showGroup:true,scrollbarSize:0,columns:[[{field:"name",title:"Name",width:120,resizable:true},{field:"value",title:"Value",width:100,resizable:true}]],onClickRow:function(B,A){console.log(A.name+A.value);switch(A.name){case"stroke":case"fill":case"background":colorwindow.style.display="block";colorwindow.style.left=currentleftshu-150+"px";colorwindow.style.top=currentrightshu+"px";propertyindex=B;propertyname=A.name;break;default:break}},onAfterEdit:function(L,T,G){var H;var J;var Q;var X;var Z=true;if(diantarget.tagName=="g"&&T.name=="符号序列"){var P=diantarget.childNodes;for(var h=0;h<P.length;){H=parseInt(P[0].getAttribute("x"));J=parseInt(P[0].getAttribute("y"));if(Z){Q=H;X=J;Z=false}else{if(Q>H){Q=H}if(X>J){X=J}}diantarget.removeChild(P[0])}Z=true;createfuhaozuByAttrGrid(T.value,diantarget,Q,X);return}if(diantarget.tagName=="g"&&T.name=="组合线数"){var P=diantarget.childNodes;for(var b=0;b<P.length;){H=parseInt(P[0].getAttribute("x1"));J=parseInt(P[0].getAttribute("y1"));if(Z){Q=H;X=J;Z=false}else{if(Q>H){Q=H}if(X>J){X=J}}diantarget.removeChild(P[0])}Z=true;createzuhelineByAttrGrid(parseInt(T.value),diantarget,Q,X);return}if(diantarget.tagName=="g"&&T.name=="受控点数"){var P=diantarget.childNodes;var f=0;var U;for(var h=0;h<P.length;){if(P[0].tagName=="circle"){H=parseInt(P[0].getAttribute("cx"));J=parseInt(P[0].getAttribute("cy"));if(Z){Q=H;X=J;U=P[0].getAttribute("class");Z=false}else{if(Q>H){Q=H}if(X>J){X=J;U=P[0].getAttribute("class")}}}if(P[0].getAttribute("class")=="shoucontrol"){f++}diantarget.removeChild(P[0])}Z=true;for(var N=0;N<f;N++){gggg.removeChild(gggg.childNodes[0])}var D;if(U=="shoucontrol"){D=0}else{D=1}createzuhedianByAttrGrid(parseInt(diantarget.getAttribute("kongzhidiancount")),parseInt(T.value),diantarget,Q,X,D);return}if(diantarget.tagName=="g"&&T.name=="控制点数"){var P=diantarget.childNodes;var f=0;var U;for(var h=0;h<P.length;){if(P[0].tagName=="circle"){H=parseInt(P[0].getAttribute("cx"));J=parseInt(P[0].getAttribute("cy"));if(Z){Q=H;X=J;U=P[0].getAttribute("class");Z=false}else{if(Q>H){Q=H}if(X>J){X=J;U=P[0].getAttribute("class")}}}if(P[0].getAttribute("class")=="shoucontrol"){f++}diantarget.removeChild(P[0])}Z=true;for(var N=0;N<f;N++){gggg.removeChild(gggg.childNodes[0])}var D;if(U=="shoucontrol"){D=0}else{D=1}createzuhedianByAttrGrid(parseInt(T.value),parseInt(diantarget.getAttribute("shoukongdiancount")),diantarget,Q,X,D);return}if(diantarget.tagName=="g"&&T.name=="zuhedianjianju"){var B=0;var S=$(svgg).children("g");var F=0;var a=0;var V=true;for(var k=0;k<S.length;k++){if(S[k].getAttribute("class")=="fuhaozu"){var R=parseInt(S[k].childNodes[0].getAttribute("x"));if(B<R){B=R}}if(S[k].getAttribute("class")=="zuhedian"){if(V){F=parseInt(S[k].childNodes[1].getAttribute("cx"));a=parseInt(S[k].childNodes[1].getAttribute("cx"));V=false}else{var A=parseInt(S[k].childNodes[1].getAttribute("cx"));if(F>A){F=A}if(A>a){a=A}}}}g=$(svgg).children("circle");for(var h=0;h<g.length;h++){var A=parseInt(g[h].getAttribute("cx"));if(F>A){F=A}if(A>a){a=A}}var g;var W=parseInt(T.value);var Y;for(var N=0;N<S.length;N++){switch(S[N].getAttribute("class")){case"zuhedian":Y=parseInt(S[N].getAttribute("zuhedianjianju"));S[N].setAttribute("zuhedianjianju",W);g=$(S[N]).children("circle");var C=$(S[N]).children("line")[0];var M;for(var h=0;h<g.length;h++){M=(g[h].getAttribute("cx")-F)/(Y*10)*W*10+F;g[h].setAttribute("cx",M)}C.setAttribute("x1",(C.getAttribute("x1")-F)/(Y*10)*W*10+F);C.setAttribute("x2",(C.getAttribute("x2")-F)/(Y*10)*W*10+F);var O=$(S[N]).children("rect")[0];O.setAttribute("x",(O.getAttribute("x")-F)/(Y*10)*W*10+F);break;case"fuhaozu":if(S[N].childNodes[0].getAttribute("x")==B){g=S[N].childNodes;for(var h=0;h<g.length;h++){g[h].setAttribute("x",(a-F)/(Y*10)*W*10+W*10+F)}}break;default:break}}g=$(svgg).children("circle");var i;for(var h=0;h<g.length;h++){i=(g[h].getAttribute("cx")-F)/(Y*10)*W*10+F;g[h].setAttribute("cx",i)}for(var k=0;k<S.length;k++){if(S[k].getAttribute("class")=="zuheline"){var I=S[k].childNodes;for(var h=0;h<I.length;h++){I[h].setAttribute("x2",(a-F)/(Y*10)*W*10+W*10/2+F)}}}tianjiaShiZi();jilubianhua();return}if(diantarget.tagName=="g"&&T.name=="zujianju"){if(diantarget.getAttribute("zujianjuall")!=null){var e;var S=$(svgg).children("g");for(var k=0;k<S.length;k++){if(S[k].getAttribute("class")=="zuheline"){e=parseInt(S[k].childNodes[0].getAttribute("y1"))}}var g;var W=parseInt(T.value);var Y;var E;for(var N=0;N<S.length;N++){switch(S[N].getAttribute("class")){case"zuheline":S[N].setAttribute("zujianjuall",W);g=S[N].childNodes;for(var h=1;h<g.length;h++){g[h].setAttribute("y1",parseInt(g[0].getAttribute("y1"))+W*10*h);g[h].setAttribute("y2",parseInt(g[0].getAttribute("y2"))+W*10*h)}break;case"zuhedian":S[N].setAttribute("zujianjuall",W);Y=parseInt(S[N].getAttribute("zujianju"));g=$(S[N]).children("circle");var C=$(S[N]).children("line")[0];var M;for(var h=0;h<g.length;h++){M=(g[h].getAttribute("cy")-e)/(Y*10)*W*10+e;g[h].setAttribute("cy",M)}C.setAttribute("y1",(C.getAttribute("y1")-e)/(Y*10)*W*10+e);C.setAttribute("y2",(C.getAttribute("y2")-e)/(Y*10)*W*10+e);var O=$(S[N]).children("rect")[0];O.setAttribute("y",(O.getAttribute("y")-e)/(Y*10)*W*10+e);O.setAttribute("height",(g.length-1)*W*10);break;case"fuhaozu":g=S[N].childNodes;for(var h=1;h<g.length;h++){g[h].setAttribute("y",parseInt(g[0].getAttribute("y"))+W*10*h)}break;default:break}S[N].setAttribute("zujianju",W)}g=$(svgg).children("circle");var i;for(var h=0;h<g.length;h++){i=(g[h].getAttribute("cy")-e)/(Y*10)*W*10+e;g[h].setAttribute("cy",i)}}else{var g;var W=parseInt(T.value);var E;switch(diantarget.getAttribute("class")){case"zuheline":g=diantarget.childNodes;for(var h=1;h<g.length;h++){g[h].setAttribute("y1",parseInt(g[0].getAttribute("y1"))+W*10*h);g[h].setAttribute("y2",parseInt(g[0].getAttribute("y2"))+W*10*h)}break;case"zuhedian":g=$(diantarget).children("circle");var C=$(diantarget).children("line")[0];var m;for(var h=0;h<g.length;h++){if(g[h].getAttribute("cy")==C.getAttribute("y1")){E=g[h].getAttribute("cy");m=h;break}}for(var h=0;h<g.length;h++){if(h!=m){g[h].setAttribute("cy",parseInt(E)+W*10*h)}}C.setAttribute("y2",parseInt(E)+W*10*(g.length-1));var O=$(diantarget).children("rect")[0];O.setAttribute("height",(g.length-1)*W*10);break;case"fuhaozu":g=diantarget.childNodes;for(var h=1;h<g.length;h++){g[h].setAttribute("y",parseInt(g[0].getAttribute("y"))+W*10*h)}break;default:break}diantarget.setAttribute("zujianju",W)}tianjiaShiZi();jilubianhua();return}if(diantarget.tagName=="g"&&T.name=="font-size"){var g=diantarget.childNodes;for(var h=0;h<g.length;h++){g[h].setAttribute(T.name,T.value)}jilubianhua();return}if(diantarget.tagName=="g"){console.log("lllllll");var g=diantarget.childNodes;for(var h=0;h<g.length;h++){if(g[h].tagName!="text"){g[h].setAttribute(T.name,T.value)}}jilubianhua();return}var c=T.name;if(c=="stroke-width"||c=="font-size"||c=="cx"||c=="cy"||c=="rx"||c=="ry"||c=="r"){if(diantarget.tagName=="svg"){var l=diantarget.childNodes;for(var h=0;h<l.length;h++){if(l[h].tagName!="g"){l[h].setAttribute("stroke-width",T.value)}}}else{var P=svgg.childNodes;var K=diantarget.getAttribute("class");for(var h=0;h<P.length;h++){if(P[h].getAttribute("class")==K){P[h].setAttribute(T.name,T.value)}}}tianjiaShiZi();jilubianhua()}},});var wanggewidthh=10;var wanggewidthv=10;function createwangge(A,G,C){var H=A.childNodes;for(var E=0;E<H.length;){if(H[E].tagName!="g"){A.removeChild(H[E]);continue}E++}var D=document.createElementNS(SVG_NS,"rect");D.setAttribute("x",0);D.setAttribute("y",0);D.setAttribute("width",G);D.setAttribute("height",C);D.setAttribute("stroke","gray");D.setAttribute("stroke-width","1");D.setAttribute("fill","none");A.appendChild(D);for(var F=0;F<C;F=F+wanggewidthh){var B=document.createElementNS(SVG_NS,"line");B.setAttribute("x1",0);B.setAttribute("y1",F);B.setAttribute("x2",G);B.setAttribute("y2",F);B.setAttribute("stroke","#F3F3F3");B.setAttribute("stroke-width","1");B.setAttribute("class","h");B.setAttribute("stroke-dasharray","0,0");A.appendChild(B)}for(var F=0;F<G;F=F+wanggewidthv){var B=document.createElementNS(SVG_NS,"line");B.setAttribute("x1",F);B.setAttribute("y1",0);B.setAttribute("x2",F);B.setAttribute("y2",C);B.setAttribute("stroke","#F3F3F3");B.setAttribute("stroke-width","1");B.setAttribute("class","h");B.setAttribute("stroke-dasharray","0,0");A.appendChild(B)}}function createSVG(){var B=document.getElementById("canvas");var A=document.createElementNS(SVG_NS,"svg");var C=B.getAttribute("width");var D=B.getAttribute("height");A.setAttribute("width",C.substr(0,C.length-2));A.setAttribute("height",D.substring(0,D.length-2));A.setAttribute("viewBox","0 0 2000 1500");A.setAttribute("xmlns","http://www.w3.org/2000/svg");A.setAttribute("background","#FFFFFF");A.setAttribute("class","svg");A.setAttribute("gridvisible","yes");createwangge(A,C.substr(0,C.length-2),D.substring(0,D.length-2));document.getElementById("canvas").appendChild(A);return A}svg=createSVG();var svgg=document.createElementNS(SVG_NS,"g");svgg.setAttribute("id","svgcontent");svg.appendChild(svgg);function huizhibilichi(){var D=document.getElementById("rulerhc");var C=D.getContext("2d");C.beginPath();C.clearRect(0,0,D.width,D.height);C.lineWidth=1;for(var B=0;B<=2000;B=B+wanggewidthh){if(B/5%5==0){C.beginPath();C.moveTo(18+B,18);C.lineTo(18+B,5);C.closePath();C.stroke();C.fillStyle="blue";C.textBaseline="top";C.fillText(B,B+10,0)}else{C.beginPath();C.moveTo(18+B,18);C.lineTo(18+B,10);C.closePath();C.stroke()}}var A=document.getElementById("rulervc");var E=A.getContext("2d");E.beginPath();E.clearRect(0,0,A.width,A.height);E.lineWidth=1;for(var B=0;B<=1500;B=B+wanggewidthv){if(B/5%5==0){E.beginPath();E.moveTo(5,B);E.lineTo(18,B);E.closePath();E.stroke();E.fillStyle="blue";E.textBaseline="top";E.fillText(B,0,B-4)}else{E.beginPath();E.moveTo(10,B);E.lineTo(18,B);E.closePath();E.stroke()}}}huizhibilichi();function jixian(){lineh.setAttribute("x1",0);lineh.setAttribute("y1",0);lineh.setAttribute("x2",0);lineh.setAttribute("y2",1500);lineh.setAttribute("stroke","yellow");lineh.setAttribute("stroke-width",1);lineh.setAttribute("fill","none");svg.appendChild(lineh);linev.setAttribute("x1",0);linev.setAttribute("y1",0);linev.setAttribute("x2",2000);linev.setAttribute("y2",0);linev.setAttribute("stroke","yellow");linev.setAttribute("stroke-width",1);linev.setAttribute("fill","none");svg.appendChild(linev)}jixian();gggg.setAttribute("shizi","shizi");svg.appendChild(gggg);function jilubianhua(){currentsvgghtml=svgg.innerHTML;currentgggghtml=gggg.innerHTML;oldsvgghtml[bushu]=svgg.innerHTML;oldgggghtml[bushu]=gggg.innerHTML;bushu=oldsvgghtml.length;console.log("mmmmm");console.log(bushu);tongbushuju()}function handleFiles(B){svgg.innerHTML="";gggg.innerHTML="";if(B.length){var C=B[0];var A=new FileReader();A.onload=function(){document.getElementById("filecontent").innerHTML=this.result};A.readAsText(C)}setTimeout(chanshengshiliangtu,1000)}function gettargetDiv(A){if(A.tagName=="body"){return null}if(A.parentNode.tagName=="DIV"){return A.parentNode}else{return gettargetDiv(A.parentNode)}}function gettargetG(A){if(A.tagName=="svg"){return null}if(A.parentNode.tagName=="g"&&A.parentNode.parentNode.parentNode.tagName=="svg"){return A.parentNode}else{return gettargetG(A.parentNode)}}function tianjiaShiZi(){var C=$(svgg).children("circle");if(C==null||C==undefined){return}var A=gggg.childNodes;var D=0;for(var F=0;F<C.length;F++){if(C[F].getAttribute("class")=="shoucontrol"){cx=parseInt(C[F].getAttribute("cx"));cy=parseInt(C[F].getAttribute("cy"));r=parseInt(C[F].getAttribute("r"));move=[];move1=[];lineto=[];lineto1=[];move.push(cx-r);move.push(cy);lineto.push(cx+r);lineto.push(cy);move1.push(cx);move1.push(cy-r);lineto1.push(cx);lineto1.push(cy+r);A[D].setAttribute("d","M"+move.join(" ")+" L"+lineto.join(" ")+" M"+move1.join(" ")+" L"+lineto1.join(" "));D++}}C=$(svgg).children("g");if(C==null||C==undefined){return}var E;for(var F=0;F<C.length;F++){if(C[F].getAttribute("class")=="zuhedian"){E=$(C[F]).children("circle");for(var B=0;B<E.length;B++){if(E[B].getAttribute("class")=="shoucontrol"){cx=parseInt(E[B].getAttribute("cx"));cy=parseInt(E[B].getAttribute("cy"));r=parseInt(E[B].getAttribute("r"));move=[];move1=[];lineto=[];lineto1=[];move[0]=cx-r;move[1]=cy;lineto[0]=cx+r;lineto[1]=cy;move1[0]=cx;move1[1]=cy-r;lineto1[0]=cx;lineto1[1]=cy+r;A[D].setAttribute("d","M"+move.join(" ")+" L"+lineto.join(" ")+" M"+move1.join(" ")+" L"+lineto1.join(" "));D++}}}}}function showfuhaozuattr(A){var B=[];B.push({"name":"fill","value":diantarget.childNodes[0].getAttribute("fill"),"group":"fuhaozu","editor":{type:"text",options:{required:true,},},});B.push({"name":"font-size","value":diantarget.childNodes[0].getAttribute("font-size"),"group":"fuhaozu","editor":{type:"text",options:{required:true,},},});B.push({"name":"zujianju","value":diantarget.getAttribute("zujianju"),"group":"fuhaozu","editor":{type:"text",options:{required:true,},},});B.push({"name":"符号序列","value":diantarget.getAttribute("fuhaozuxulie"),"group":"fuhaozu","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showzuhelineattr(A){var B=[];B.push({"name":"stroke","value":diantarget.childNodes[0].getAttribute("stroke"),"group":"zuheline","editor":{type:"text",options:{required:true,},},});B.push({"name":"stroke-width","value":diantarget.childNodes[0].getAttribute("stroke-width"),"group":"zuheline","editor":{type:"text",options:{required:true,},},});B.push({"name":"zujianju","value":diantarget.getAttribute("zujianju"),"group":"zuheline","editor":{type:"text",options:{required:true,},},});B.push({"name":"组合线数","value":diantarget.getAttribute("linecount"),"group":"zuheline","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showzuhedianattr(A){var B=[];B.push({"name":"stroke","value":diantarget.childNodes[0].getAttribute("stroke"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"stroke-width","value":diantarget.childNodes[0].getAttribute("stroke-width"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"fill","value":diantarget.childNodes[0].getAttribute("fill"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"zujianju","value":diantarget.getAttribute("zujianju"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"zuhedianjianju","value":diantarget.getAttribute("zuhedianjianju"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"受控点数","value":diantarget.getAttribute("shoukongdiancount"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"控制点数","value":diantarget.getAttribute("kongzhidiancount"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showzuhedianattrsingle(A){var B=[];B.push({"name":"stroke","value":diantarget.childNodes[0].getAttribute("stroke"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"stroke-width","value":diantarget.childNodes[0].getAttribute("stroke-width"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"fill","value":diantarget.childNodes[0].getAttribute("fill"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"zujianju","value":diantarget.getAttribute("zujianju"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"受控点数","value":diantarget.getAttribute("shoukongdiancount"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});B.push({"name":"控制点数","value":diantarget.getAttribute("kongzhidiancount"),"group":"zuhedian","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showgattr(A){var B=[];B.push({"name":"stroke","value":$(diantarget).children("circle")[0].getAttribute("stroke"),"group":"g","editor":{type:"text",options:{required:true,},},});B.push({"name":"stroke-width","value":$(diantarget).children("circle")[0].getAttribute("stroke-width"),"group":"g","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showfuhaoattr(A){var B=[];B.push({"name":"fill","value":A.target.getAttribute("fill"),"group":"text","editor":{type:"text",options:{required:true,},},});B.push({"name":"font-size","value":A.target.getAttribute("font-size"),"group":"text","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showzhilineattr(A){console.log(A.target);var B=[];B.push({"name":"stroke","value":A.target.getAttribute("stroke"),"group":"line","editor":{type:"text",options:{required:true,},},});B.push({"name":"stroke-width","value":A.target.getAttribute("stroke-width"),"group":"line","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showshoucontrol(A){var B=[];B.push({"name":"stroke","value":A.target.getAttribute("stroke"),"group":"shoucontrol","editor":{type:"text",options:{required:true,},},});B.push({"name":"stroke-width","value":A.target.getAttribute("stroke-width"),"group":"shoucontrol","editor":{type:"text",options:{required:true,},},});B.push({"name":"fill","value":A.target.getAttribute("fill"),"group":"shoucontrol","editor":{type:"text",options:{required:true,},},});B.push({"name":"r","value":A.target.getAttribute("r"),"group":"shoucontrol","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showcontrol(A){var B=[];B.push({"name":"stroke","value":A.target.getAttribute("stroke"),"group":"control","editor":{type:"text",options:{required:true,},},});B.push({"name":"stroke-width","value":A.target.getAttribute("stroke-width"),"group":"control","editor":{type:"text",options:{required:true,},},});B.push({"name":"fill","value":A.target.getAttribute("fill"),"group":"control","editor":{type:"text",options:{required:true,},},});B.push({"name":"r","value":A.target.getAttribute("r"),"group":"control","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",B)}function showsvattr(B){var C=[];C.push({"name":"stroke","value":svg.childNodes[2].getAttribute("stroke"),"group":"svg","editor":{type:"text",options:{required:true,},},});C.push({"name":"stroke-width","value":svg.childNodes[2].getAttribute("stroke-width"),"group":"svg","editor":{type:"text",options:{required:true,},},});C.push({"name":"background","value":svg.getAttribute("background"),"group":"svg","editor":{type:"text",options:{required:true,},},});var A=[{"value":"yes","text":"yes"},{"value":"no","text":"no"}];C.push({"name":"gridvisible","value":svg.getAttribute("gridvisible"),"group":"svg","editor":{panelHeight:20,type:"combobox",options:{data:A,valueField:"value",textField:"text",panelHeight:40,onChange:function(I,F){if(I=="no"){var G=svg.childNodes;for(var H=0;H<G.length;H++){if(G[H].tagName=="line"){G[H].setAttribute("visibility","hidden")}}}else{var G=svg.childNodes;for(var H=0;H<G.length;H++){if(G[H].tagName=="line"){G[H].setAttribute("visibility","shown")}}}},},},});var D=svg.childNodes[2].getAttribute("stroke-dasharray").split(",")[0];if(D=="0"){D="line"}else{D="dot"}var E=[{"value":"line","text":"line"},{"value":"dot","text":"dot"}];C.push({"name":"gridstyle","value":D,"group":"svg","editor":{type:"combobox",options:{data:E,valueField:"value",textField:"text",panelHeight:40,onChange:function(I,F){if(I=="line"){var G=svg.childNodes;for(var H=0;H<G.length;H++){if(G[H].tagName=="line"){G[H].setAttribute("stroke-dasharray","0,0")}}}else{var G=svg.childNodes;for(var H=0;H<G.length;H++){if(G[H].tagName=="line"){G[H].setAttribute("stroke-dasharray","2,2")}}}},},},});$("#propertydiv").propertygrid("loadData",C)}var dataObj;function getgroupmenber(A){$.post("servlet/GetGroupMenberservlet",{id:A,},function(B){console.log(B);dataObj=JSON.stringify(B);console.log(dataObj)});return dataObj}function pushsvgcombo(){}function getDuijioffset(A){var B={offsetX:0,offsetY:0};var D=A.offsetX;var C=A.offsetY;if(D%wanggewidthh>wanggewidthh/2){D=Math.floor(D/wanggewidthh)*wanggewidthh+wanggewidthh}else{D=Math.floor(D/wanggewidthh)*wanggewidthh}if(C%wanggewidthv>wanggewidthv/2){C=Math.floor(C/wanggewidthv)*wanggewidthv+wanggewidthv}else{C=Math.floor(C/wanggewidthv)*wanggewidthv}B.offsetX=D;B.offsetY=C;return B}function getviewxy(A,E,C){var B=A.childNodes;for(var D=0;D<B.length;D++){switch(B[D].tagName){case"line":E.push(parseInt(B[D].getAttribute("x1")));E.push(parseInt(B[D].getAttribute("x2")));C.push(parseInt(B[D].getAttribute("y1")));C.push(parseInt(B[D].getAttribute("y2")));break;case"text":E.push(parseInt(B[D].getAttribute("x")));C.push(parseInt(B[D].getAttribute("y")));break;case"circle":E.push(parseInt(B[D].getAttribute("cx")));C.push(parseInt(B[D].getAttribute("cy")));break;default:break}}}function save(){if(userid==null){alert("请登录");return}if(cannotsavetomysql==true){alert("不能保存到数据库,可以保存到本地");return}if(svgorgroupsvg!=null){save1();return}$("#svgname1").window({title:"保存",width:230,height:100,collapsible:false,minimizable:false,maximizable:false,closable:true,closed:false,zIndex:9999,draggable:true,resizable:false,shadow:false,inline:false,modal:true,onclose:function(){document.getElementById("svgname1").style.display="none";$("#svgname1").window("close")}});$("#svgname1").window("move",{left:window.innerWidth/2,top:window.innerHeight/2,});document.getElementById("svgname1").style.display="block"}function save1(){var C=svgg.childNodes;xarray=[];yarray=[];for(var F=0;F<C.length;F++){switch(C[F].tagName){case"line":xarray.push(parseInt(C[F].getAttribute("x1")));xarray.push(parseInt(C[F].getAttribute("x2")));yarray.push(parseInt(C[F].getAttribute("y1")));yarray.push(parseInt(C[F].getAttribute("y2")));break;case"text":xarray.push(parseInt(C[F].getAttribute("x")));yarray.push(parseInt(C[F].getAttribute("y")));break;case"circle":xarray.push(parseInt(C[F].getAttribute("cx")));yarray.push(parseInt(C[F].getAttribute("cy")));break;case"g":getviewxy(C[F],xarray,yarray);break;default:break}}xarray=xarray.sort(sortNumber);yarray=yarray.sort(sortNumber);console.log(xarray);console.log(yarray);minx=parseInt(xarray[0])-40;miny=parseInt(yarray[0])-40;minx=minx==0?minx:0;miny=miny==0?miny:0;maxx=parseInt(xarray[xarray.length-1])+50;maxy=parseInt(yarray[yarray.length-1])+50;var A=document.createElementNS(SVG_NS,"svg");A.setAttribute("viewBox",minx+" "+miny+" "+maxx+" "+maxy);A.setAttribute("xmlns","http://www.w3.org/2000/svg");A.setAttribute("width","100px");A.setAttribute("height","100px");$(A).append(svgg.outerHTML);$(A).append(gggg.outerHTML);var E=A.outerHTML;var D=svgg.innerHTML;var G=gggg.innerHTML;var B=document.getElementById("svgname").value;if(svgorgroupsvg==null){$.post("servlet/SaveServlet",{aa:E,bb:D,cc:G,dd:userid,ee:B},function(H){if(H.msg=="yes"){alert("保存成功")}})}else{console.log(svgorgroupsvg);$.post("servlet/Savesvgorgroupsvgservlet",{aa:E,bb:D,cc:G,dd:svgorgroupsvg,ee:isgroupsvg},function(H){if(H.msg=="yes"){alert("保存成功")}isgroupsvg=false;svgorgroupsvg=null;svgg.innerHTML="";gggg.innerHTML=""})}document.getElementById("svgname1").style.display="none";if(svgorgroupsvg==null){$("#svgname1").window("close")}}function tongbushuju(){console.log("tongbu");ws_send()}var ws;function ws_init(){var target="ws://svg:8080/tongbu";if("WebSocket" in window){ws=new WebSocket(target)}else{if("MozWebSocket" in window){ws=new MozWebSocket(target)}else{alert("WebSocket is not supported by this browser.");return}}ws.onopen=function(){alert("webSocket通道建立成功！！！")};ws.onmessage=function(event){eval("var msg="+event.data+";");if(msg.aa=="0"){$.post("servlet/Gengxinsvgservlet",{cc:1,id:userid},function(data){svgg.innerHTML=data.svggcontent;gggg.innerHTML=data.ggggcontent})}}}function ws_send(){if(ws==undefined){return}var A=svgg.innerHTML;var B=gggg.innerHTML;$.post("servlet/Gengxinsvgservlet",{aa:A,bb:B,cc:0,id:userid},function(D){if(D.msg=="yes"){console.log("ppppp");var C="{aa:0}";ws.send(C)}})}function nullfunction(){}function ws_send_copy(){if(ws==undefined){return}var A=svgg.innerHTML;var B=gggg.innerHTML;$.post("servlet/Gengxinsvgservlet",{aa:A,bb:B,cc:0,id:userid},function(D){if(D.msg=="yes"){console.log("ppppp");var C="{aa:0}";ws.send(C)}})}function tanchuTiShiKuang(){alert("请用矩形框选择范围");gongjutype="rectimage";gongjushape=null}function isInRect(C){var D=parseInt(gongjushape.getAttribute("x"));var E=parseInt(gongjushape.getAttribute("y"));var F=parseInt(gongjushape.getAttribute("width"))+parseInt(D);var G=parseInt(gongjushape.getAttribute("height"))+parseInt(E);switch(C.tagName){case"line":var I=parseInt(C.getAttribute("x1"));var H=parseInt(C.getAttribute("x2"));var B=parseInt(C.getAttribute("y1"));var A=parseInt(C.getAttribute("y2"));if(I>=D&&H<=F&&B>=E&&A<=G){return true}else{return false}break;case"text":var I=parseInt(C.getAttribute("x"));var B=parseInt(C.getAttribute("y"));if(I>=D&&I<=F&&B>=E&&B<=G){return true}else{return false}break;case"circle":var I=parseInt(C.getAttribute("cx"));var B=parseInt(C.getAttribute("cy"));if(I>=D&&I<=F&&B>=E&&B<=G){return true}else{return false}break;default:break}}function getviewxy1(C,F,D,A){var B=C.childNodes;for(var E=0;E<B.length;E++){switch(B[E].tagName){case"line":if(isInRect(B[E])){$(A).append(B[E].outerHTML);F.push(parseInt(B[E].getAttribute("x1")));F.push(parseInt(B[E].getAttribute("x2")));D.push(parseInt(B[E].getAttribute("y1")));D.push(parseInt(B[E].getAttribute("y2")))}break;case"text":if(isInRect(B[E])){$(A).append(B[E].outerHTML);F.push(parseInt(B[E].getAttribute("x")));D.push(parseInt(B[E].getAttribute("y")))}break;case"circle":if(isInRect(B[E])){$(A).append(B[E].outerHTML);F.push(parseInt(B[E].getAttribute("cx")));D.push(parseInt(B[E].getAttribute("cy")))}break;default:break}}}function savetolocal(){var L=document.createElementNS(SVG_NS,"g");var D=svgg.childNodes;xarray=[];yarray=[];for(var F=0;F<D.length;F++){switch(D[F].tagName){case"line":if(isInRect(D[F])){$(L).append(D[F].outerHTML);xarray.push(parseInt(D[F].getAttribute("x1")));xarray.push(parseInt(D[F].getAttribute("x2")));yarray.push(parseInt(D[F].getAttribute("y1")));yarray.push(parseInt(D[F].getAttribute("y2")))}break;case"text":if(isInRect(D[F])){$(L).append(D[F].outerHTML);xarray.push(parseInt(D[F].getAttribute("x")));yarray.push(parseInt(D[F].getAttribute("y")))}break;case"circle":if(isInRect(D[F])){$(L).append(D[F].outerHTML);xarray.push(parseInt(D[F].getAttribute("cx")));yarray.push(parseInt(D[F].getAttribute("cy")))}break;case"g":getviewxy1(D[F],xarray,yarray,L);break;default:break}}var D=gggg.childNodes;var B=parseInt(gongjushape.getAttribute("x"));var C=parseInt(gongjushape.getAttribute("y"));var E=parseInt(gongjushape.getAttribute("width"))+parseInt(B);var J=parseInt(gongjushape.getAttribute("height"))+parseInt(C);for(var F=0;F<D.length;F++){var A=D[F].getAttribute("d").split(" ");var I=A[1]-(A[1]-A[0].substr(1,A[0].length-1))/2;var G=A[3]-(A[3]-A[2].substr(1,A[2].length-1))/2;if(I>=B&&I<=E&&G>=C&&G<=J){$(L).append(D[F].outerHTML)}}xarray=xarray.sort(sortNumber);yarray=yarray.sort(sortNumber);console.log(xarray);console.log(yarray);minx=parseInt(xarray[0])-40;miny=parseInt(yarray[0])-40;minx=minx==0?minx:0;miny=miny==0?miny:0;maxx=parseInt(xarray[xarray.length-1])+50;maxy=parseInt(yarray[yarray.length-1])+50;var H=document.createElementNS(SVG_NS,"svg");H.setAttribute("viewBox",minx+" "+miny+" "+maxx+" "+maxy);H.setAttribute("xmlns","http://www.w3.org/2000/svg");H.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");$(H).append(L.outerHTML);var K='<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE svg>'+H.outerHTML;shengchongImage(K);svgg.removeChild(gongjushape)}function shengchongImage(B){canvg(ccc,B);var A=document.getElementById("svgcanvas").toDataURL("image/png");$("#canvgimage").window({title:"生成图片",width:230,height:230,collapsible:false,minimizable:false,maximizable:false,closable:true,closed:false,zIndex:9999,draggable:true,resizable:true,shadow:false,inline:false,modal:true,onclose:function(){document.getElementById("canvgimage").style.display="none";$("#canvgimage").window("close")}});$("#canvgimage").window("move",{left:window.innerWidth/2,top:window.innerHeight/2,});console.log(A);document.getElementById("canvgimage").style.display="block"}function sortNumber(B,A){return B-A}function gettimeid(){var A=new Date();return"svg"+A.getTime()}function getPosition(B){B=B||window.event;var A={x:0,y:0};if(B.clientX||B.clientY){A.x=B.offsetX;A.y=B.offsetY}else{A.x=B.clientX+document.body.scrollLeft-document.body.clientLeft;A.y=B.clientY+document.documentElement.scrollTop}return A}function getxy(A){switch(A){case"rect":return"x:y";break;case"text":return"x:y";break;case"circle":return"cx:cy";break;case"ellipse":return"cx:cy";break;case"polygon":return"points";break;case"polyline":return"points";break;case"line":return"x1:y1:x2:y2";break;case"path":return"ML";break;default:break}}function initialg(J){for(var D=0;D<J.childNodes.length;D++){var I=J.childNodes[D];if(I.childNodes.length!=0&&I.tagName!="text"){initialg(I)}else{switch(getxy(J.childNodes[D].tagName)){case"x:y":if(I.tagName=="text"){var F=I.getAttribute("transform");if(F!=undefined&&F!=null){var B=F.indexOf("(");var N=F.substr(B+1,F.length-2-B);var E=N.split(",");E[0]=E[0]-0;E[1]=E[1]-offx;E[2]=E[2]-offy;I.setAttribute("transform","rotate("+E.join(",")+")")}}I.setAttribute("x",I.getAttribute("x")-offx);I.setAttribute("y",I.getAttribute("y")-offy);break;case"cx:cy":console.log(I.getAttribute("cy")+"ddddd");I.setAttribute("cx",I.getAttribute("cx")-offx);I.setAttribute("cy",I.getAttribute("cy")-offy);break;case"points":if(I.getAttribute("points").indexOf(",")!=-1){var L=I.getAttribute("points").split(" ");var M=L[0].split(",");var O=L[1].split(",");M[0]=M[0]-offx;M[1]=M[1]-offy;O[0]=O[0]-offx;O[1]=O[1]-offy;L[0]=M.join(",");L[1]=O.join(",");I.setAttribute("points",L.join(" "))}else{var M=I.getAttribute("points").split(" ");for(var C=0;C<M.length;C++){M[C]=M[C]-offx;C++;M[C]=M[C]-offy}I.setAttribute("points",M.join(" "))}break;case"x1:y1:x2:y2":I.setAttribute("x1",I.getAttribute("x1")-offx);I.setAttribute("y1",I.getAttribute("y1")-offy);I.setAttribute("x2",I.getAttribute("x2")-offx);I.setAttribute("y2",I.getAttribute("y2")-offy);break;case"ML":var K=I.getAttribute("d");var Q="";if(K.indexOf("A")!=-1){if(K.indexOf(" ")==1){var A=K.split(" ");var P=A.length;A[1]=A[1]-offx;A[2]=A[2]-offy;A[P-2]=A[P-2]-offx;A[P-1]=A[P-1]-offy;Q=A.join(" ");I.setAttribute("d",Q);continue}else{var A=K.split(" ");var H=A[0].substr(1,A[0].length-1).split(",");var G=A[A.length-1].split(",");H[0]=H[0]-offx;H[1]=H[1]-offy;G[0]=G[0]-offx;G[1]=G[1]-offy;Q="M"+H.join(",");for(var C=1;C<A.length-1;C++){Q=Q+" "+A[C]}Q=Q+" "+G.join(",");I.setAttribute("d",Q);continue}}if(K.indexOf(" ")==1&&K.indexOf(",")==-1){var H=K.split(" ");H[1]=H[1]-offx;H[2]=H[2]-offy;Q=H.join(" ");I.setAttribute("d",Q);continue}if(K.indexOf(" ")==1){var A=K.replace(/\ L/g,"#L").split("#");console.log(K.replace(/\ L/g,"#L"));var H=null;for(var C=0;C<A.length;C++){H=A[C].split(" ");H[1]=H[1]-offx;H[2]=H[2]-offy;console.log(A);console.log(H+"pppp");Q=Q+H.join(" ")+" "}I.setAttribute("d",Q.substr(0,Q.length-1))}else{var A=K.substr(1,K.length-1).split(" ");var H=A[0].split(",");H[0]=H[0]-offx;H[1]=H[1]-offy;console.log(A);console.log(H);Q="M"+H.join(",")+" "+A[1];if(A.length==3){Q=Q+A[2]}I.setAttribute("d",Q)}break;default:break}}}}function enableshanchuButton(){$("#shanchu").linkbutton("enable")}function disableshanchuButton(){$("#shanchu").linkbutton("disable")}function create(D,A){var H=shapeinfo[D].indexOf(">");var L=shapeinfo[D].substr(3,H-3);var J=shapeinfo[D].substr(H+1,shapeinfo[D].length-5-H);var C=document.createElementNS(SVG_NS,"g");C.setAttribute("createtype",D);var E=L.replace(/\" /g,'"!').split("!");var G;var I;while(E.length){G=E.shift().split("=");D=G[0];I=C.getAttribute(D)||G[1];if(I!=undefined){I=I.substr(1,I.length-2)}else{I=""}if(D!=""){C.setAttribute(D,I)}}$(C).html(J);$(svgg).append(C);var B=$(C).find("circle")[0];console.log(B);var F=A.offsetX;var K=A.offsetY;console.log(F+"eeee");if(F%wanggewidth>wanggewidth/2){F=Math.floor(F/wanggewidth)*wanggewidth+wanggewidth}else{F=Math.floor(F/wanggewidth)*wanggewidth}if(K%wanggewidth>wanggewidth/2){K=Math.floor(K/wanggewidth)*wanggewidth+wanggewidth}else{K=Math.floor(K/wanggewidth)*wanggewidth}offx=B.getAttribute("cx")-F;offy=B.getAttribute("cy")-K;hideshowciecle(C,"hidden");initialg(C);C.setAttribute("id",gettimeid())}function hideshowciecle(A,C){var B=A.childNodes;for(var D=0;D<B.length;D++){if(B[D].tagName=="g"){hideshowciecle(B[D],C)}else{if(B[D].tagName=="circle"&&B[D].getAttribute("tishi")=="yes"){B[D].style.visibility=C}}}}function moveg(J,O,C){for(var D=0;D<J.childNodes.length;D++){var I=J.childNodes[D];if(I.childNodes.length!=0&&I.tagName!="text"){moveg(I)}else{switch(getxy(J.childNodes[D].tagName)){case"x:y":if(I.tagName=="text"){var F=I.getAttribute("transform");if(F!=undefined&&F!=null){var B=F.indexOf("(");var N=F.substr(B+1,F.length-2-B);var E=N.split(",");E[0]=E[0]-0;E[1]=E[1]-offx+O;E[2]=E[2]-offy+C;I.setAttribute("transform","rotate("+E.join(",")+")")}}I.setAttribute("x",I.getAttribute("x")-offx+O);I.setAttribute("y",I.getAttribute("y")-offy+C);break;case"cx:cy":I.setAttribute("cx",I.getAttribute("cx")-offx+O);I.setAttribute("cy",I.getAttribute("cy")-offy+C);break;case"points":if(I.getAttribute("points").indexOf(",")!=-1){var L=I.getAttribute("points").split(" ");var M=L[0].split(",");var Q=L[1].split(",");M[0]=M[0]-offx+O;M[1]=M[1]-offy+C;Q[0]=Q[0]-offx+O;Q[1]=Q[1]-offy+C;L[0]=M.join(",");L[1]=Q.join(",");I.setAttribute("points",L.join(" "))}else{var M=I.getAttribute("points").split(" ");for(var P=0;P<M.length;P++){M[P]=M[P]-offx+O;P++;M[P]=M[P]-offy+C}I.setAttribute("points",M.join(" "))}break;case"x1:y1:x2:y2":I.setAttribute("x1",I.getAttribute("x1")-offx+O);I.setAttribute("y1",I.getAttribute("y1")-offy+C);I.setAttribute("x2",I.getAttribute("x2")-offx+O);I.setAttribute("y2",I.getAttribute("y2")-offy+C);break;case"ML":var K=I.getAttribute("d");var S="";if(K.indexOf("A")!=-1){if(K.indexOf(" ")==1){var A=K.split(" ");var R=A.length;A[1]=A[1]-offx+O;A[2]=A[2]-offy+C;A[R-2]=A[R-2]-offx+O;A[R-1]=A[R-1]-offy+C;S=A.join(" ");I.setAttribute("d",S);continue}else{var A=K.split(" ");var H=A[0].substr(1,A[0].length-1).split(",");var G=A[A.length-1].split(",");H[0]=H[0]-offx+O;H[1]=H[1]-offy+C;G[0]=G[0]-offx+O;G[1]=G[1]-offy+C;S="M"+H.join(",");for(var P=1;P<A.length-1;P++){S=S+" "+A[P]}S=S+" "+G.join(",");I.setAttribute("d",S);continue}}if(K.indexOf(" ")==1&&K.indexOf(",")==-1){var H=K.split(" ");H[1]=H[1]-offx+O;H[2]=H[2]-offy+C;S=H.join(" ");I.setAttribute("d",S);continue}if(K.indexOf(" ")==1){var A=K.replace(/\ L/g,"#L").split("#");console.log(K.replace(/\ L/g,"#L"));var H=null;for(var P=0;P<A.length;P++){H=A[P].split(" ");H[1]=H[1]-offx+O;H[2]=H[2]-offy+C;S=S+H.join(" ")+" "}I.setAttribute("d",S.substr(0,S.length-1))}else{var A=K.substr(1,K.length-1).split(" ");var H=A[0].split(",");H[0]=H[0]-offx+O;H[1]=H[1]-offy+C;S="M"+H.join(",")+" "+A[1];I.setAttribute("d",S)}break;default:break}}}}function createzuheline(){var E=document.getElementById("linecount").value;var B=parseInt(document.getElementById("linelong").value);var C=parseInt(document.getElementById("jianjuline").value);var A=document.createElementNS(SVG_NS,"g");A.setAttribute("class","zuheline");A.setAttribute("zujianju",C);A.setAttribute("linecount",E);A.setAttribute("linelong",B);var D;for(var F=0;F<E;F++){D=document.createElementNS(SVG_NS,"line");D.setAttribute("x1",eee.offsetX);D.setAttribute("y1",eee.offsetY+F*C*10);D.setAttribute("x2",eee.offsetX+B*10);D.setAttribute("y2",eee.offsetY+F*C*10);D.setAttribute("stroke","black");D.setAttribute("stroke-width",2);D.setAttribute("fill","none");D.setAttribute("class","zuheline");D.setAttribute("id",gettimeid());A.appendChild(D)}document.getElementById("zuhelinediv").style.display="none";$("#zuhelinediv").window("close");svgg.appendChild(A);jilubianhua()}function createzuhelineByAttrGrid(B,H,D,C){var G=B;var F=parseInt(H.getAttribute("linelong"));var I=parseInt(H.getAttribute("zujianju"));H.setAttribute("linecount",G);var A;for(var E=0;E<G;E++){A=document.createElementNS(SVG_NS,"line");A.setAttribute("x1",D);A.setAttribute("y1",C+E*I*10);A.setAttribute("x2",D+F*10);A.setAttribute("y2",C+E*I*10);A.setAttribute("stroke","black");A.setAttribute("stroke-width",2);A.setAttribute("fill","none");A.setAttribute("class","zuheline");A.setAttribute("id",gettimeid());H.appendChild(A)}jilubianhua()}function tanchuzuhelinecanshu(A){$("#zuhelinediv").window({title:"组合线参数",width:110,height:140,collapsible:false,minimizable:false,maximizable:false,closable:true,closed:false,zIndex:9999,draggable:true,resizable:false,shadow:false,inline:false,modal:false,onClose:function(){},});$("#zuhelinediv").window("move",{left:A.clientX,top:A.clientY,});document.getElementById("zuhelinediv").style.display="block";eee=getDuijioffset(A)}function createzuhedian(){var D=parseInt(document.getElementById("kongzhidiancount").value);var H=parseInt(document.getElementById("shoukongdiancount").value);var F=D+H;var B=parseInt(document.getElementById("jianjudian").value);zuhedianjianju=B;var L=document.createElementNS(SVG_NS,"g");L.setAttribute("class","zuhedian");L.setAttribute("zujianju",zuhedianjianju);L.setAttribute("issingle","yes");L.setAttribute("kongzhidiancount",D);L.setAttribute("shoukongdiancount",H);var C=document.createElementNS(SVG_NS,"line");C.setAttribute("x1",eee.offsetX);C.setAttribute("y1",eee.offsetY);C.setAttribute("x2",eee.offsetX);C.setAttribute("y2",eee.offsetY+(F-1)*B*10);C.setAttribute("stroke","black");C.setAttribute("stroke-width",2);C.setAttribute("fill","none");L.appendChild(C);var E=document.createElementNS(SVG_NS,"rect");E.setAttribute("x",eee.offsetX-8);E.setAttribute("y",eee.offsetY);E.setAttribute("width",16);E.setAttribute("height",(F-1)*B*10);E.setAttribute("stroke","black");E.setAttribute("stroke-width",1);E.setAttribute("fill","white");E.setAttribute("opacity",0);L.appendChild(E);var I;var G;var A;var M;var K;for(var J=0;J<F;J++){K=document.createElementNS("http://www.w3.org/2000/svg","circle");K.setAttribute("cx",eee.offsetX);K.setAttribute("cy",eee.offsetY+J*B*10);K.setAttribute("stroke-width",1);K.setAttribute("id",gettimeid()+parseInt(Math.random()*100));if(J<D){K.setAttribute("stroke","black");K.setAttribute("r",8);K.setAttribute("fill","black");K.setAttribute("class","control")}else{K.setAttribute("stroke","red");K.setAttribute("r",11);K.setAttribute("fill","white");K.setAttribute("class","shoucontrol");I=parseInt(eee.offsetX);G=parseInt(eee.offsetY+J*B*10);A=11;M=document.createElementNS("http://www.w3.org/2000/svg","path");move=[];move1=[];lineto=[];lineto1=[];move.push(I-A);move.push(G);lineto.push(I+A);lineto.push(G);move1.push(I);move1.push(G-A);lineto1.push(I);lineto1.push(G+A);M.setAttribute("d","M"+move.join(" ")+" L"+lineto.join(" ")+" M"+move1.join(" ")+" L"+lineto1.join(" "));M.setAttribute("stroke","black");M.setAttribute("stroke-width",2);console.log(M.getAttribute("d"));gggg.appendChild(M)}L.appendChild(K)}document.getElementById("zuhediandiv").style.display="none";$("#zuhediandiv").window("close");svgg.appendChild(L);jilubianhua()}function createzuhedianByAttrGrid(M,C,L,I,H,A){var P=M;var Q=C;var F=P+Q;var G=parseInt(L.getAttribute("zujianju"));L.setAttribute("kongzhidiancount",P);L.setAttribute("shoukongdiancount",Q);var E=document.createElementNS(SVG_NS,"line");E.setAttribute("x1",I);E.setAttribute("y1",H);E.setAttribute("x2",I);E.setAttribute("y2",H+(F-1)*G*10);E.setAttribute("stroke","black");E.setAttribute("stroke-width",2);E.setAttribute("fill","none");L.appendChild(E);var K=document.createElementNS(SVG_NS,"rect");K.setAttribute("x",I-8);K.setAttribute("y",H);K.setAttribute("width",16);K.setAttribute("height",(F-1)*G*10);K.setAttribute("stroke","black");K.setAttribute("stroke-width",1);K.setAttribute("fill","white");K.setAttribute("opacity",0);L.appendChild(K);var D;var O;var N;var B;var R;for(var J=0;J<F;J++){R=document.createElementNS("http://www.w3.org/2000/svg","circle");R.setAttribute("cx",I);R.setAttribute("cy",H+J*G*10);R.setAttribute("stroke-width",1);R.setAttribute("id",gettimeid()+parseInt(Math.random()*100));if(A==0){if(J<C){R.setAttribute("stroke","red");R.setAttribute("r",11);R.setAttribute("fill","white");R.setAttribute("class","shoucontrol");D=parseInt(I);O=parseInt(H+J*G*10);N=11;B=document.createElementNS("http://www.w3.org/2000/svg","path");move=[];move1=[];lineto=[];lineto1=[];move.push(D-N);move.push(O);lineto.push(D+N);lineto.push(O);move1.push(D);move1.push(O-N);lineto1.push(D);lineto1.push(O+N);B.setAttribute("d","M"+move.join(" ")+" L"+lineto.join(" ")+" M"+move1.join(" ")+" L"+lineto1.join(" "));B.setAttribute("stroke","black");B.setAttribute("stroke-width",2);gggg.appendChild(B)}else{R.setAttribute("stroke","black");R.setAttribute("r",8);R.setAttribute("fill","black");R.setAttribute("class","control")}}else{if(J<P){R.setAttribute("stroke","black");R.setAttribute("r",8);R.setAttribute("fill","black");R.setAttribute("class","control")}else{R.setAttribute("stroke","red");R.setAttribute("r",11);R.setAttribute("fill","white");R.setAttribute("class","shoucontrol");D=parseInt(I);O=parseInt(H+J*G*10);N=11;B=document.createElementNS("http://www.w3.org/2000/svg","path");move=[];move1=[];lineto=[];lineto1=[];move.push(D-N);move.push(O);lineto.push(D+N);lineto.push(O);move1.push(D);move1.push(O-N);lineto1.push(D);lineto1.push(O+N);B.setAttribute("d","M"+move.join(" ")+" L"+lineto.join(" ")+" M"+move1.join(" ")+" L"+lineto1.join(" "));B.setAttribute("stroke","black");B.setAttribute("stroke-width",2);gggg.appendChild(B)}}L.appendChild(R)}tianjiaShiZi();jilubianhua()}function tanchuzuhediancanshu(A){$("#zuhediandiv").window({title:"组合点参数",width:110,height:140,collapsible:false,minimizable:false,maximizable:false,closable:true,closed:false,zIndex:9999,draggable:true,resizable:false,shadow:false,inline:false,modal:false,});$("#zuhediandiv").window("move",{left:A.clientX,top:A.clientY,});document.getElementById("zuhediandiv").style.display="block";eee=getDuijioffset(A)}function createfuhaozu(){var A=document.createElementNS(SVG_NS,"g");A.setAttribute("class","fuhaozu");A.setAttribute("zujianju",2);var B=document.getElementById("fuhaoshu").value;A.setAttribute("fuhaozuxulie",B);var C=document.getElementById("zifujianju").value;for(var D=0;D<B.length;D++){gongjushape=document.createElementNS(SVG_NS,"text");gongjushape.setAttribute("x",eee.offsetX);gongjushape.setAttribute("y",parseInt(eee.offsetY)+C*10*D);gongjushape.setAttribute("font-family","Verdana");gongjushape.setAttribute("font-size","15pt");gongjushape.setAttribute("fill","black");gongjushape.setAttribute("text-anchor","start");gongjushape.setAttribute("type","comment");gongjushape.setAttribute("class","fuhao");gongjushape.innerHTML=B[D];gongjushape.setAttribute("id",gettimeid());A.appendChild(gongjushape)}document.getElementById("fuhaozudiv").style.display="none";$("#fuhaozudiv").window("close");svgg.appendChild(A);jilubianhua()}function createfuhaozuByAttrGrid(C,A,D,B){A.setAttribute("fuhaozuxulie",C);var E=parseInt(A.getAttribute("zujianju"));for(var F=0;F<C.length;F++){gongjushape=document.createElementNS(SVG_NS,"text");gongjushape.setAttribute("x",D);gongjushape.setAttribute("y",parseInt(B)+E*10*F);gongjushape.setAttribute("font-family","Verdana");gongjushape.setAttribute("font-size","15pt");gongjushape.setAttribute("fill","black");gongjushape.setAttribute("text-anchor","start");gongjushape.setAttribute("type","comment");gongjushape.setAttribute("class","fuhao");gongjushape.innerHTML=C[F];gongjushape.setAttribute("id",gettimeid());A.appendChild(gongjushape)}jilubianhua()}function tanchufuhaozucanshu(A){$("#fuhaozudiv").window({title:"符号组参数",width:200,height:90,collapsible:false,minimizable:false,maximizable:false,closable:true,closed:false,zIndex:9999,draggable:true,resizable:false,shadow:false,inline:false,modal:false,});$("#fuhaozudiv").window("move",{left:A.clientX,top:A.clientY,});document.getElementById("fuhaozudiv").style.display="block";eee=getDuijioffset(A)}function chanshengshiliangtu(){var N=document.getElementById("filecontent").innerHTML;console.log(N.split(" "));var O=N.indexOf("BEGIN");var C=N.substring(0,O);var I=C.substring(C.indexOf(" ")+1,C.indexOf("\n")).split(",");var E=N.substring(O+6,N.indexOf("END"));var T=E.replace(/\n/g," ").split(" ");console.log(T);var W;var P;var L=80;var V=80;var R=30;var J=0;var D=0;var Q=0;var A=0;for(var F=1;F<T.length-1;F=F+2){var B=T[F].split(",");var K=document.createElementNS("http://www.w3.org/2000/svg","g");K.setAttribute("class","zuhedian");K.setAttribute("zujianju",3);K.setAttribute("zujianjuall",3);K.setAttribute("zuhedianjianju",3);var U=L+parseInt(F/2)*R;var S=document.createElementNS(SVG_NS,"rect");S.setAttribute("x",U-8);S.setAttribute("width",16);S.setAttribute("stroke","black");S.setAttribute("stroke-width",1);S.setAttribute("fill","white");S.setAttribute("opacity",0);K.appendChild(S);for(var G=0;G<B.length;G++){W=document.createElementNS("http://www.w3.org/2000/svg","circle");W.setAttribute("stroke-width",1);W.setAttribute("cx",U);W.setAttribute("id",gettimeid()+parseInt(Math.random()*100));if(B.length==1){var H=B[G].toUpperCase().charCodeAt()-65;W.setAttribute("cy",V+H*R);W.setAttribute("stroke","red");W.setAttribute("r",11);W.setAttribute("fill","white");W.setAttribute("class","shoucontrol");svgg.appendChild(W);cx=parseInt(U);cy=parseInt(V+H*R);r=11;path1=document.createElementNS("http://www.w3.org/2000/svg","path");move=[];move1=[];lineto=[];lineto1=[];move.push(cx-r);move.push(cy);lineto.push(cx+r);lineto.push(cy);move1.push(cx);move1.push(cy-r);lineto1.push(cx);lineto1.push(cy+r);path1.setAttribute("d","M"+move.join(" ")+" L"+lineto.join(" ")+" M"+move1.join(" ")+" L"+lineto1.join(" "));path1.setAttribute("stroke","black");path1.setAttribute("stroke-width",2);console.log(path1.getAttribute("d"));gggg.appendChild(path1)}else{var H=B[G].toUpperCase().charCodeAt()-65;if(G==0){J=H;D=H}else{if(J>H){J=H}if(D<H){D=H}}S.setAttribute("y",J*R+V);S.setAttribute("height",(D-J)*R);if(G==B.length-1){W.setAttribute("cy",V+H*R);W.setAttribute("stroke","red");W.setAttribute("r",11);W.setAttribute("fill","white");W.setAttribute("class","shoucontrol");cx=parseInt(U);cy=parseInt(V+H*R);r=11;path1=document.createElementNS("http://www.w3.org/2000/svg","path");move=[];move1=[];lineto=[];lineto1=[];move.push(cx-r);move.push(cy);lineto.push(cx+r);lineto.push(cy);move1.push(cx);move1.push(cy-r);lineto1.push(cx);lineto1.push(cy+r);path1.setAttribute("d","M"+move.join(" ")+" L"+lineto.join(" ")+" M"+move1.join(" ")+" L"+lineto1.join(" "));path1.setAttribute("stroke","black");path1.setAttribute("stroke-width",2);console.log(path1.getAttribute("d"));A++;gggg.appendChild(path1)}else{W.setAttribute("cy",V+H*R);W.setAttribute("stroke","black");W.setAttribute("r",8);W.setAttribute("fill","black");W.setAttribute("class","control");Q++}K.appendChild(W)}}if(B.length!=1){P=document.createElementNS("http://www.w3.org/2000/svg","line");P.setAttribute("stroke-width",2);P.setAttribute("stroke","black");P.setAttribute("x1",U);P.setAttribute("y1",J*R+V);P.setAttribute("x2",U);P.setAttribute("y2",D*R+V);K.setAttribute("kongzhidiancount",Q);K.setAttribute("shoukongdiancount",A);K.appendChild(P);svgg.appendChild(K)}Q=0;A=0}var K=document.createElementNS(SVG_NS,"g");K.setAttribute("class","zuheline");K.setAttribute("zujianju",3);K.setAttribute("tfcproduct","yes");K.setAttribute("zujianjuall",3);K.setAttribute("linecount",I.length);K.setAttribute("linelong",parseInt(T.length/2)*R/10+R/10);var M;for(var F=0;F<I.length;F++){M=document.createElementNS(SVG_NS,"line");M.setAttribute("x1",L-R);M.setAttribute("y1",V+F*R);M.setAttribute("x2",L+parseInt(T.length/2)*R);M.setAttribute("y2",V+F*R);M.setAttribute("stroke","black");M.setAttribute("stroke-width",2);M.setAttribute("fill","none");M.setAttribute("class","zuheline");M.setAttribute("id",gettimeid());K.appendChild(M)}svgg.appendChild(K);var K=document.createElementNS(SVG_NS,"g");K.setAttribute("class","fuhaozu");K.setAttribute("zujianju",3);K.setAttribute("zujianjuall",3);K.setAttribute("fuhaozuxulie",I.join(""));for(var F=0;F<I.length;F++){gongjushape=document.createElementNS(SVG_NS,"text");gongjushape.setAttribute("x",L-R-20);gongjushape.setAttribute("y",V+F*R);gongjushape.setAttribute("font-family","Verdana");gongjushape.setAttribute("font-size","15pt");gongjushape.setAttribute("fill","black");gongjushape.setAttribute("text-anchor","start");gongjushape.setAttribute("type","comment");gongjushape.setAttribute("class","fuhao");gongjushape.innerHTML=I[F];gongjushape.setAttribute("id",gettimeid());K.appendChild(gongjushape)}svgg.appendChild(K);var K=document.createElementNS(SVG_NS,"g");K.setAttribute("class","fuhaozu");K.setAttribute("zujianju",3);K.setAttribute("zujianjuall",3);K.setAttribute("fuhaozuxulie",I.join(""));for(var F=0;F<I.length;F++){gongjushape=document.createElementNS(SVG_NS,"text");gongjushape.setAttribute("x",L+parseInt(T.length/2)*R+20);gongjushape.setAttribute("y",V+F*R);gongjushape.setAttribute("font-family","Verdana");gongjushape.setAttribute("font-size","15pt");gongjushape.setAttribute("fill","black");gongjushape.setAttribute("text-anchor","start");gongjushape.setAttribute("type","comment");gongjushape.setAttribute("class","fuhao");gongjushape.innerHTML=I[F];gongjushape.setAttribute("id",gettimeid());K.appendChild(gongjushape)}svgg.appendChild(K);jilubianhua()}function tianjialineonmousemove(A){A.onmouseenter=function(){A.setAttribute("stroke","aqua");A.setAttribute("stroke-width",5)};A.onmouseout=function(){A.setAttribute("stroke","black");A.setAttribute("stroke-width",2)}}document.getElementById("shangyibu").onclick=function(A){if(oldsvgghtml.length!=0){bushu--;if(bushu==-1){alert("最后一步");bushu++}else{if(bushu==oldsvgghtml.length-1){bushu--}svgg.innerHTML=oldsvgghtml[bushu];gggg.innerHTML=oldgggghtml[bushu]}}};document.getElementById("xiayibu").onclick=function(A){if(oldsvgghtml.length!=0){bushu++;if(bushu==oldsvgghtml.length+1){alert("最后一步");bushu--}else{console.log(bushu);if(bushu==oldsvgghtml.length){alert("最后一步");return}svgg.innerHTML=oldsvgghtml[bushu];gggg.innerHTML=oldgggghtml[bushu]}}};document.getElementById("huanyuan").onclick=function(A){svgg.innerHTML=currentsvgghtml;gggg.innerHTML=currentgggghtml;bushu=oldsvgghtml.length};document.getElementById("tuichu").onclick=function(e){$.post("servlet/Logoutservlet",{},function(data){data=eval("("+data+")");if(data.msg=="yes"){document.getElementById("zhuce").style.display="block";document.getElementById("denglu").style.display="block";userid=null;document.getElementById("yonghuming").style.display="none";document.getElementById("tuichu").style.display="none"}else{alert(data.msg)}})};document.getElementById("zhu").onclick=function(A){var C=document.getElementById("username").value;var B=document.getElementById("password").value;$.post("servlet/ZhuceServlet",{username:C,password:B},function(D){if(D.msg=="yes"){$("#registerandgo").window("close");document.getElementById("btn").style.display="none";userid=D.user.id;document.getElementById("yonghuming").innerHTML=D.user.username;document.getElementById("yonghuming").style.display="block";document.getElementById("tuichu").style.display="block";document.getElementById("zhuce").style.display="none";document.getElementById("denglu").style.display="none"}else{alert(D.msg)}})};document.getElementById("deng").onclick=function(A){var C=document.getElementById("username").value;var B=document.getElementById("password").value;$.post("servlet/DengluServlet",{username:C,password:B},function(D){if(D.msg=="yes"){$("#registerandgo").window("close");document.getElementById("btn1").style.display="none";document.getElementById("zhuce").style.display="none";document.getElementById("denglu").style.display="none";userid=D.user.id;document.getElementById("yonghuming").innerHTML=D.user.username;document.getElementById("yonghuming").style.display="block";document.getElementById("tuichu").style.display="block"}else{alert(D.msg)}})};document.getElementById("zhuce").onclick=function(A){console.log(document.getElementById("registerandgo"));console.log($("#registerandgo"));$("#registerandgo").dialog({title:"注册",width:300,height:180,modal:true,iconCls:"icon-lockstart",buttons:"#btn",onClose:function(){document.getElementById("registerandgo").style.display="none";document.getElementById("btn").style.display="none"},});document.getElementById("registerandgo").style.display="block";document.getElementById("btn").style.display="block";$("#registerandgo").window("center")};document.getElementById("denglu").onclick=function(A){$("#registerandgo").dialog({title:"登录",width:300,height:180,modal:true,iconCls:"icon-lock",buttons:"#btn1",onClose:function(){document.getElementById("registerandgo").style.display="none";document.getElementById("btn1").style.display="none"},});document.getElementById("registerandgo").style.display="block";document.getElementById("btn1").style.display="block";$("#registerandgo").window("center")};document.getElementById("quanxianguanli").onclick=function(A){if(userid==null){alert("请登录");return}$("#gridd").window({title:"权限管理",width:620,height:620,modal:true,iconCls:"icon-lock",onClose:function(){document.getElementById("gridd").style.display="none"},});document.getElementById("gridd").style.display="block";$("#quanxiandatagrid").datagrid({width:600,height:600,columns:[[{field:"id",title:"编号",width:120,},{field:"name",title:"作品名",width:120,},{field:"username",title:"作者",width:120,},{field:"time",title:"创建时间",width:120,},{field:"type",title:"权限",width:120,},]],onClickRow:function(C,B){$.post("servlet/Modifyservlet",{svgid:B.id,id:userid,type:B.type},function(D){$("#quanxiandatagrid").datagrid("reload","servlet/Getselfservlet?id="+userid)})},});$("#gridd").window("move",{left:window.innerWidth/2-300,top:window.innerHeight/2-300,});$("#quanxiandatagrid").datagrid("reload","servlet/Getselfservlet?id="+userid)};document.getElementById("tianjiagroup").onclick=function(A){$("#gridd1").window({title:"分组管理",width:650,height:515,modal:true,iconCls:"icon-lock",onClose:function(){document.getElementById("gridd1").style.display="none";document.getElementById("tbgroup").style.display="none"},});document.getElementById("gridd1").style.display="block";document.getElementById("tbgroup").style.display="block";$("#groupgrid").datagrid({width:650,height:480,toolbar:"#tbgroup",columns:[[{field:"id",title:"组作品编号",width:120,},{field:"username",title:"组创建者",width:120,},{field:"svgname",title:"作品名",width:120,},{field:"time",title:"创建时间",width:120,},{field:"menber",title:"组成员",width:120,editor:{panelHeight:20,type:"combobox",options:{valueField:"value",textField:"text",panelHeight:40,}}},]],onClickRow:function(D,B){$("#groupgrid").datagrid("beginEdit",D);var C=$("#groupgrid").datagrid("getEditor",{index:D,field:"menber"}).target;C.combobox("loadData",B.menber);C.combobox("showPanel")},});$("#gridd1").window("move",{left:window.innerWidth/2-500,top:window.innerHeight/2-300,});$("#groupgrid").datagrid("reload","servlet/GetGroupInfoservlet?id="+userid)};document.getElementById("groupQueDing").onclick=function(A){var D=document.getElementById("zuopinname").value;var C=$("#groupmenber").combogrid("grid").datagrid("getRows");if(D==""||C.length==0){alert("请将数据填完整");$("#groupOperator").window("close");return}var B=[];for(var E=0;E<C.length;E++){B.push({"id":C[E].id,"username":C[E].username,"type":C[E].type,})}$.post("servlet/SaveGroupservlet",{aa:userid,bb:D,cc:JSON.stringify(B),},function(F){if(F.msg=="yes"){alert("保存成功");document.getElementById("groupOperator").style.display="none";document.getElementById("groupQueDing").style.display="none";$("#groupOperator").window("close");$("#groupgrid").datagrid("reload","servlet/GetGroupInfoservlet?id="+userid)}})};var rowindex1=null;document.getElementById("menberadd").onclick=function(A){console.log($("#allmenber").combogrid("getValue"));console.log(document.getElementById("menberquanxian").checked);var B=$("#allmenber").combogrid("getValue");var D=document.getElementById("menberquanxian").checked;var C=$("#allmenber").combogrid("grid").datagrid("getSelected").id;$("#groupmenber").combogrid("grid").datagrid("insertRow",{index:0,row:{id:C,username:B,type:D,},})};var rowindex=null;document.getElementById("menbershanchu").onclick=function(A){if(rowindex!=null){$("#groupmenber").combogrid("grid").datagrid("deleteRow",rowindex);$("#groupmenber").combogrid("setValue","");rowindex=null}};document.getElementById("addgroup").onclick=function(A){$("#groupmenber").combogrid({panelWidth:160,panelHeight:160,idField:"username",textField:"username",value:"组成员",columns:[[{field:"id",title:"id",width:40,},{field:"username",title:"成员名",width:40,},{field:"type",title:"权限",width:80,},]],onSelect:function(B){console.log(B);rowindex=B},onShowPanel:function(){},});$("#allmenber").combogrid({width:100,panelWidth:80,panelHeight:100,idField:"username",textField:"username",value:"其他成员",columns:[[{field:"id",title:"id",width:40,},{field:"username",title:"成员名",width:40,}]],onSelect:function(B){console.log(B);rowindex1=B},onShowPanel:function(){$("#allmenber").combogrid("grid").datagrid("reload","servlet/Getallusernameservlet")},});$("#groupOperator").window({title:"组参数设置",width:500,height:200,modal:false,iconCls:"icon-lock",onClose:function(){document.getElementById("groupOperator").style.display="none";document.getElementById("groupQueDing").style.display="none"},});document.getElementById("groupQueDing").style.display="block";document.getElementById("groupOperator").style.display="block";$("#groupOperator").window("move",{left:window.innerWidth/2-500,top:window.innerHeight/2-300,})};document.getElementById("groupmodify1").onclick=function(A){var E=document.getElementById("zuopinname").value;var D=$("#groupmenber").combogrid("grid").datagrid("getRows");if(E==""||D.length==0){alert("请将数据填完整");$("#groupOperator").window("close");return}var B=[];for(var F=0;F<D.length;F++){B.push({"id":D[F].id,"username":D[F].username,"type":D[F].type,})}var C=$("#groupgrid").datagrid("getSelected");$.post("servlet/MdifyGroupservlet",{aa:userid,bb:E,cc:JSON.stringify(B),dd:C.id},function(G){if(G.msg=="yes"){alert("保存成功");document.getElementById("groupOperator").style.display="none";document.getElementById("groupQueDing").style.display="none";$("#groupOperator").window("close");$("#groupgrid").datagrid("reload","servlet/GetGroupInfoservlet?id="+userid)}})};document.getElementById("modifygroup").onclick=function(A){var B=$("#groupgrid").datagrid("getSelected");if(B==null){alert("请选中行");return}document.getElementById("zuopinname").value=B.svgname;$("#groupmenber").combogrid({panelWidth:160,panelHeight:160,idField:"username",textField:"username",value:"组成员",columns:[[{field:"id",title:"id",width:40,},{field:"username",title:"成员名",width:40,},{field:"type",title:"权限",width:80,},]],onSelect:function(C){console.log(C);rowindex=C},onShowPanel:function(){},});$("#groupmenber").combogrid("grid").datagrid("reload","servlet/GetGroupMenberservlet?id="+B.id);$("#allmenber").combogrid({width:100,panelWidth:80,panelHeight:100,idField:"username",textField:"username",value:"其他成员",columns:[[{field:"id",title:"id",width:40,},{field:"username",title:"成员名",width:40,}]],onSelect:function(C){console.log(C);rowindex1=C},onShowPanel:function(){$("#allmenber").combogrid("grid").datagrid("reload","servlet/Getallusernameservlet")},});$("#groupOperator").window({title:"组参数设置",width:500,height:200,modal:false,iconCls:"icon-lock",onClose:function(){document.getElementById("groupOperator").style.display="none";document.getElementById("groupmodify1").style.display="block"},});document.getElementById("groupmodify1").style.display="block";document.getElementById("groupOperator").style.display="block";$("#groupOperator").window("move",{left:window.innerWidth/2-500,top:window.innerHeight/2-300,})};document.getElementById("removegroup").onclick=function(A){var B=$("#groupgrid").datagrid("getSelected");$.post("servlet/Deletegroupservlet",{aa:B.id,},function(C){if(C.msg=="yes"){alert("删除成功");$("#groupgrid").datagrid("reload","servlet/GetGroupInfoservlet?id="+userid)}})};guanbi.onclick=function(A){colorwindow.style.display="none"};var colorzhi;var propertyindex;var propertyname;document.getElementById("colortable").onclick=function(B){colorwindow.style.display="none";colorzhi=B.target.style.backgroundColor;var D=svg.childNodes;if(propertyname=="background"){svg.setAttribute("background",colorzhi);svg.style.background=colorzhi;return}if(diantarget.tagName=="svg"){var D=diantarget.childNodes;for(var F=0;F<D.length;F++){if(D[F].tagName!="g"){D[F].setAttribute("stroke",colorzhi)}}}if(diantarget.tagName=="g"){var E=diantarget.childNodes;for(var F=0;F<E.length;F++){E[F].setAttribute(propertyname,colorzhi)}jilubianhua()}var C=diantarget.getAttribute("class");if(C==""||undefined==C){if(diantarget!=null&&diantarget!=undefined&&diantarget.tagName!="g"){if(propertyname=="stroke"){isstroke=true}diantarget.setAttribute(propertyname,colorzhi);jilubianhua();return}}if(diantarget!=null&&diantarget!=undefined&&diantarget.tagName!="svg"){var A=svgg.childNodes;var G=diantarget.getAttribute("class");for(var F=0;F<A.length;F++){if(A[F].getAttribute("class")==G){A[F].setAttribute(propertyname,colorzhi)}}jilubianhua()}$("#propertydiv").datagrid("updateRow",{index:propertyindex,row:{name:propertyname,value:colorzhi}})};document.getElementById("gongju").onclick=function(A){console.log(A.target.id);switch(A.target.id){case"pingline":gongjutype="pingline";break;case"shuline":gongjutype="shuline";break;case"shoucontrol":gongjutype="shoucontrol";break;case"control":gongjutype="control";break;case"fuhao":gongjutype="fuhao";break;default:break}gongjushape=null};document.getElementById("wiretools").onclick=function(A){console.log(A.target.getAttribute("id"));console.log(type);console.log(svg);polyline=null;switch(A.target.getAttribute("id")){case"wire":type="zheline";break;case"continuexieline":type="continuexieline";break;case"quxian":type="quxian";break;case"text":type="text";break;case"pencil":type="pencil";break;case"rect":type="rect";break;case"polygon":type="polygon";break;case"ellipse":type="ellipse";break;default:break}};document.getElementById("create-shape").onclick=function(A){var B=gettargetDiv(A.target);if(B==null){return}switch(B.id){case"hadamard":gongjutype="hadamard";break;case"paulix":gongjutype="paulix";break;case"pauliy":gongjutype="pauliy";break;case"pauliz":gongjutype="pauliz";break;case"XiangWeiMen":gongjutype="XiangWeiMen";break;case"TMen":gongjutype="TMen";break;case"shoukongfeimen":gongjutype="shoukongfeimen";break;case"jiaohuanmen":gongjutype="jiaohuanmen";break;case"shoukongZmen":gongjutype="shoukongZmen";break;case"shoukongxiangweimen":gongjutype="shoukongxiangweimen";break;case"toffoli":gongjutype="toffoli";break;case"fredkinmen":gongjutype="fredkinmen";break;case"celiangyunsuan":gongjutype="celiangyunsuan";break;case"jingdianbite":gongjutype="jingdianbite";break;case"nliangzibite":gongjutype="nliangzibite";break;case"zuheline":gongjutype="zuheline";break;case"zuhedian":gongjutype="zuhedian";break;case"fuhaozu":gongjutype="fuhaozu";break;default:break}gongjushape=null};document.getElementById("quedingzuheline").onclick=function(A){createzuheline()};document.getElementById("quedingzuhedian").onclick=function(A){createzuhedian()};document.getElementById("quedingfuhaozu").onclick=function(A){createfuhaozu()};svg.onclick=function(B){switch(gongjutype){case"hadamard":case"paulix":case"pauliy":case"pauliz":case"XiangWeiMen":case"TMen":case"shoukongfeimen":case"jiaohuanmen":case"shoukongZmen":case"shoukongxiangweimen":case"toffoli":case"fredkinmen":case"celiangyunsuan":case"jingdianbite":case"nliangzibite":create(gongjutype,B);jilubianhua();break;case"pingline":if(gongjushape==null){eee=getDuijioffset(B);gongjushape=document.createElementNS("http://www.w3.org/2000/svg","line");gongjushape.setAttribute("x1",eee.offsetX);gongjushape.setAttribute("y1",eee.offsetY);gongjushape.setAttribute("y2",eee.offsetY);gongjushape.setAttribute("stroke","black");gongjushape.setAttribute("stroke-width",2);gongjushape.setAttribute("fill","none");gongjushape.setAttribute("class","pingline");gongjushape.setAttribute("id",gettimeid())}else{gongjushape=null;jilubianhua()}break;case"shuline":if(gongjushape==null){eee=getDuijioffset(B);gongjushape=document.createElementNS("http://www.w3.org/2000/svg","line");gongjushape.setAttribute("x1",eee.offsetX);gongjushape.setAttribute("y1",eee.offsetY);gongjushape.setAttribute("x2",eee.offsetX);gongjushape.setAttribute("stroke","black");gongjushape.setAttribute("stroke-width",2);gongjushape.setAttribute("fill","none");gongjushape.setAttribute("class","shuline");gongjushape.setAttribute("id",gettimeid())}else{jilubianhua();gongjushape=null}break;case"shoucontrol":eee=getDuijioffset(B);gongjushape=document.createElementNS("http://www.w3.org/2000/svg","circle");gongjushape.setAttribute("cx",eee.offsetX);gongjushape.setAttribute("cy",eee.offsetY);gongjushape.setAttribute("stroke","red");gongjushape.setAttribute("stroke-width",1);gongjushape.setAttribute("r",11);gongjushape.setAttribute("fill","white");gongjushape.setAttribute("class","shoucontrol");gongjushape.setAttribute("id",gettimeid());svgg.appendChild(gongjushape);var E=parseInt(eee.offsetX);var A=parseInt(eee.offsetY);var C=11;var D=document.createElementNS("http://www.w3.org/2000/svg","path");move=[];move1=[];lineto=[];lineto1=[];move.push(E-C);move.push(A);lineto.push(E+C);lineto.push(A);move1.push(E);move1.push(A-C);lineto1.push(E);lineto1.push(A+C);D.setAttribute("d","M"+move.join(" ")+" L"+lineto.join(" ")+" M"+move1.join(" ")+" L"+lineto1.join(" "));D.setAttribute("stroke","black");D.setAttribute("stroke-width",2);console.log(D.getAttribute("d"));gggg.appendChild(D);jilubianhua();break;case"control":eee=getDuijioffset(B);gongjushape=document.createElementNS("http://www.w3.org/2000/svg","circle");gongjushape.setAttribute("cx",eee.offsetX);gongjushape.setAttribute("cy",eee.offsetY);gongjushape.setAttribute("stroke","black");gongjushape.setAttribute("stroke-width",1);gongjushape.setAttribute("r",8);gongjushape.setAttribute("fill","black");gongjushape.setAttribute("class","control");gongjushape.setAttribute("id",gettimeid());svgg.appendChild(gongjushape);jilubianhua();break;case"fuhao":eee=getDuijioffset(B);gongjushape=document.createElementNS(SVG_NS,"text");gongjushape.setAttribute("x",eee.offsetX);gongjushape.setAttribute("y",eee.offsetY);gongjushape.setAttribute("font-family","Verdana");gongjushape.setAttribute("font-size","10pt");gongjushape.setAttribute("fill","black");gongjushape.setAttribute("text-anchor","start");gongjushape.setAttribute("type","comment");gongjushape.innerHTML="Text";gongjushape.setAttribute("class","fuhao");gongjushape.setAttribute("id",gettimeid());svgg.appendChild(gongjushape);jilubianhua();break;case"zuheline":tanchuzuhelinecanshu(B);break;case"zuhedian":tanchuzuhediancanshu(B);break;case"fuhaozu":tanchufuhaozucanshu(B);break;case"rectimage":console.log("rectimage");if(gongjushape==null){eee=getDuijioffset(B);gongjushape=document.createElementNS(SVG_NS,"rect");gongjushape.setAttribute("x",eee.offsetX);gongjushape.setAttribute("y",eee.offsetY);gongjushape.setAttribute("width",0);gongjushape.setAttribute("height",0);gongjushape.setAttribute("fill","none");gongjushape.setAttribute("stroke","aqua");gongjushape.setAttribute("stroke-width",2);gongjushape.setAttribute("id",gettimeid());svgg.appendChild(gongjushape)}else{}break;default:break}};document.getElementById("savelocal").onclick=function(A){tanchuTiShiKuang(A)};document.getElementById("chenghui").onclick=function(A){var B=document.getElementById("filecontent").textContent;if(B!=""){chanshengshiliangtu()}};document.getElementById("savetosql").onclick=function(A){var B=document.getElementById("svgname").value;if(B==""){document.getElementById("svgname1").style.display="none";$("#svgname1").window("close");return}else{save1()}};document.getElementById("canvas").onclick=function(A){disableshanchuButton();pointt=getDuijioffset(A);if(A.target.tagName=="line"&&A.target.parentNode.tagName=="svg"){showsvattr(A);diantarget=svg;return}if(A.target.tagName=="g"&&A.target.id=="svgcontent"){showsvattr(A);diantarget=svg;return}if(A.target.tagName=="svg"){showsvattr(A);diantarget=svg;return}if(A.target.getAttribute("createshape")!=null){diantarget=A.target;showgattr(A);shannode=A.target;enableshanchuButton();return}if(A.target.parentNode.getAttribute("createshape")!=null){diantarget=A.target.parentNode;showgattr(A);shannode=A.target.parentNode;enableshanchuButton();return}console.log("ppppp");console.log(A.target.parentNode);if(A.target.parentNode.tagName=="g"&&A.target.parentNode.getAttribute("class")=="fuhaozu"){diantarget=A.target.parentNode;showfuhaozuattr(A);shannode=A.target.parentNode;enableshanchuButton();return}if(A.target.parentNode.tagName=="g"&&A.target.parentNode.getAttribute("class")=="zuheline"){diantarget=A.target.parentNode;shannode=A.target.parentNode;showzuhelineattr(A);enableshanchuButton();return}if(A.target.parentNode.tagName=="g"&&A.target.parentNode.getAttribute("class")=="zuhedian"){diantarget=A.target.parentNode;shannode=A.target.parentNode;if(A.target.parentNode.getAttribute("issingle")=="yes"){showzuhedianattrsingle(A)}else{showzuhedianattr(A)}enableshanchuButton();return}var B=A.target.getAttribute("class");console.log(B);if(B==undefined||B==null){return}shannode=A.target;switch(B){case"pingline":case"shuline":showzhilineattr(A);break;case"shoucontrol":showshoucontrol(A);break;case"control":showcontrol(A);break;case"fuhao":showfuhaoattr(A);break;default:break}console.log(A.target);diantarget=A.target;enableshanchuButton()};document.getElementById("save").onclick=function(A){save()};document.getElementById("shanchu").onclick=function(A){console.log(diantarget);if(diantarget!=null&&diantarget.tagName!="svg"){svgg.removeChild(diantarget)}if(diantarget.getAttribute("class")=="zuhedian"){var B=$(diantarget).children("circle");for(var C=0;C<B.length;C++){if(B[C].getAttribute("class")=="shoucontrol"){gggg.removeChild(gggg.childNodes[0])}}tianjiaShiZi()}if(diantarget.getAttribute("class")=="shoucontrol"){gggg.removeChild(gggg.childNodes[0]);tianjiaShiZi()}jilubianhua()};document.getElementById("qingkong").onclick=function(A){svgg.innerHTML="";gggg.innerHTML=""};document.getElementById("colortable").onmousemove=function(A){var D=A.clientX-colorwindow.style.left.substr(0,colorwindow.style.left.length-2);var E=A.clientY-18-colorwindow.style.top.substr(0,colorwindow.style.top.length-2);var C=Math.floor(D/10);var B=Math.floor(E/10);colorshow.style.backgroundColor=tdarray[B*18+C].style.backgroundColor;colorvalue.value=tdarray[B*18+C].style.backgroundColor};var currentleftshu;var currentrightshu;document.getElementById("body").onmousemove=function(A){A=A||window.event;currentleftshu=A.clientX;currentrightshu=A.clientY};document.getElementById("canvas").onmousemove=function(A){scrolltop=parseInt(document.getElementById("workarea").scrollTop);scrollleft=parseInt(document.getElementById("workarea").scrollLeft);rulerCursorX.style.left=18+A.offsetX-scrollleft+"px";rulerCursorY.style.top=18+A.offsetY-scrolltop+"px";rulerCursorX1.style.left=A.offsetX-scrollleft+"px";rulerCursorY1.style.top=A.offsetY-scrolltop+"px";rulerCursorX.innerHTML=A.offsetX;rulerCursorY.innerHTML=A.offsetY;var B=getDuijioffset(A);lineh.setAttribute("x1",B.offsetX);lineh.setAttribute("y1",0);lineh.setAttribute("x2",B.offsetX);lineh.setAttribute("y2",1500);linev.setAttribute("x1",0);linev.setAttribute("y1",B.offsetY);linev.setAttribute("x2",2000);linev.setAttribute("y2",B.offsetY);switch(gongjutype){case"shuline":if(gongjushape!=null){eee=getDuijioffset(A);gongjushape.setAttribute("y2",eee.offsetY);svgg.appendChild(gongjushape)}break;case"pingline":if(gongjushape!=null){eee=getDuijioffset(A);gongjushape.setAttribute("x2",eee.offsetX);svgg.appendChild(gongjushape)}break;case"rectimage":if(gongjushape!=null){eee=getDuijioffset(A);gongjushape.setAttribute("width",eee.offsetX-gongjushape.getAttribute("x"));gongjushape.setAttribute("height",eee.offsetY-gongjushape.getAttribute("y"))}break;default:break}};svg.onmousedown=function(O){console.log("down");var Z=gettargetG(O.target);if(Z!=null||Z!=undefined){switch(Z.getAttribute("createshape")){case"hadamard":case"paulix":case"pauliy":case"pauliz":case"XiangWeiMen":case"TMen":case"shoukongfeimen":case"jiaohuanmen":case"shoukongZmen":case"shoukongxiangweimen":case"toffoli":case"fredkinmen":case"celiangyunsuan":case"jingdianbite":case"nliangzibite":var E=$(Z).find("circle")[0];var M;M=getDuijioffset(O);var W=parseInt(E.getAttribute("cx")-M.offsetX);var D=parseInt(E.getAttribute("cy")-M.offsetY);document.onmousemove=function(j){M=getDuijioffset(j);offx=E.getAttribute("cx")-M.offsetX;offy=E.getAttribute("cy")-M.offsetY;console.log(offx);console.log(offy);moveg(Z,W,D)};document.onmouseup=function(j){document.onmousemove=null;document.onmouseup=null;jilubianhua()};return;break;default:break}}if(O.target.parentNode.getAttribute("class")=="fuhaozu"){var X=O.target.parentNode.childNodes;var Y=X[0];var N=getDuijioffset(O);var W=parseInt(Y.getAttribute("x")-N.offsetX);var D=parseInt(Y.getAttribute("y")-N.offsetY);document.onmousemove=function(k){N=getDuijioffset(k);offx=Y.getAttribute("x")-N.offsetX;offy=Y.getAttribute("y")-N.offsetY;for(var l=0;l<X.length;l++){X[l].setAttribute("x",X[l].getAttribute("x")-offx+W);X[l].setAttribute("y",X[l].getAttribute("y")-offy+D)}};document.onmouseup=function(j){document.onmousemove=null;document.onmouseup=null;tianjiaShiZi();jilubianhua()};return}if(O.target.parentNode.getAttribute("class")=="zuheline"&&O.target.parentNode.getAttribute("tfcproduct")=="yes"){var X=O.target.parentNode.childNodes;var Y=X[0];var N=getDuijioffset(O);var W=parseInt(Y.getAttribute("x1")-N.offsetX);var D=parseInt(Y.getAttribute("y1")-N.offsetY);document.onmousemove=function(k){N=getDuijioffset(k);offx=Y.getAttribute("x1")-N.offsetX;offy=Y.getAttribute("y1")-N.offsetY;for(var t=0;t<X.length;t++){X[t].setAttribute("x1",X[t].getAttribute("x1")-offx+W);X[t].setAttribute("y1",X[t].getAttribute("y1")-offy+D);X[t].setAttribute("x2",X[t].getAttribute("x2")-offx+W);X[t].setAttribute("y2",X[t].getAttribute("y2")-offy+D)}var s=$(svgg).children("g");for(var m=0;m<s.length;m++){if(s[m].getAttribute("class")=="zuhedian"){var o=s[m].childNodes;for(var t=0;t<o.length;t++){if(o[t].tagName=="line"){o[t].setAttribute("x1",o[t].getAttribute("x1")-offx+W);o[t].setAttribute("y1",o[t].getAttribute("y1")-offy+D);o[t].setAttribute("x2",o[t].getAttribute("x2")-offx+W);o[t].setAttribute("y2",o[t].getAttribute("y2")-offy+D)}else{if(o[t].tagName=="circle"){o[t].setAttribute("cx",o[t].getAttribute("cx")-offx+W);o[t].setAttribute("cy",o[t].getAttribute("cy")-offy+D)}else{o[t].setAttribute("x",o[t].getAttribute("x")-offx+W);o[t].setAttribute("y",o[t].getAttribute("y")-offy+D)}}}}else{var o=s[m].childNodes;for(var t=0;t<X.length;t++){o[t].setAttribute("x",o[t].getAttribute("x")-offx+W);o[t].setAttribute("y",o[t].getAttribute("y")-offy+D)}}}var q=$(svgg).children("circle");for(var n=0;n<q.length;n++){q[n].setAttribute("cx",parseInt(q[n].getAttribute("cx"))-offx+W);q[n].setAttribute("cy",parseInt(q[n].getAttribute("cy"))-offy+D)}tianjiaShiZi()};document.onmouseup=function(j){document.onmousemove=null;document.onmouseup=null;jilubianhua()};return}if(O.target.parentNode.getAttribute("class")=="zuheline"){var X=O.target.parentNode.childNodes;var Y=X[0];var N=getDuijioffset(O);var W=parseInt(Y.getAttribute("x1")-N.offsetX);var D=parseInt(Y.getAttribute("y1")-N.offsetY);document.onmousemove=function(k){N=getDuijioffset(k);offx=Y.getAttribute("x1")-N.offsetX;offy=Y.getAttribute("y1")-N.offsetY;for(var l=0;l<X.length;l++){X[l].setAttribute("x1",X[l].getAttribute("x1")-offx+W);X[l].setAttribute("y1",X[l].getAttribute("y1")-offy+D);X[l].setAttribute("x2",X[l].getAttribute("x2")-offx+W);X[l].setAttribute("y2",X[l].getAttribute("y2")-offy+D)}};document.onmouseup=function(j){document.onmousemove=null;document.onmouseup=null;jilubianhua()};return}if(O.target.parentNode.getAttribute("class")=="zuhedian"){console.log(O.target);if(O.target.tagName=="line"||O.target.tagName=="rect"){var X=O.target.parentNode.childNodes;var Y=$(O.target.parentNode).children("line")[0];var N=getDuijioffset(O);var W=parseInt(Y.getAttribute("x1")-N.offsetX);var D=parseInt(Y.getAttribute("y1")-N.offsetY);document.onmousemove=function(k){N=getDuijioffset(k);offx=Y.getAttribute("x1")-N.offsetX;offy=Y.getAttribute("y1")-N.offsetY;for(var l=0;l<X.length;l++){if(X[l].tagName=="line"){X[l].setAttribute("x1",X[l].getAttribute("x1")-offx+W);X[l].setAttribute("y1",X[l].getAttribute("y1")-offy+D);X[l].setAttribute("x2",X[l].getAttribute("x2")-offx+W);X[l].setAttribute("y2",X[l].getAttribute("y2")-offy+D)}else{if(X[l].tagName=="circle"){X[l].setAttribute("cx",X[l].getAttribute("cx")-offx+W);X[l].setAttribute("cy",X[l].getAttribute("cy")-offy+D)}else{X[l].setAttribute("x",X[l].getAttribute("x")-offx+W);X[l].setAttribute("y",X[l].getAttribute("y")-offy+D)}}}tianjiaShiZi()};document.onmouseup=function(j){document.onmousemove=null;document.onmouseup=null;jilubianhua()};return}if(O.target.tagName=="circle"){zuhedianjianju=O.target.parentNode.getAttribute("zujianju");var J=$(O.target.parentNode).children("line")[0];var V=$(O.target.parentNode).children("rect")[0];var B=J.getAttribute("y1");var F=J.getAttribute("y2");var I;if(B>F){I=B;B=F;F=I}J.setAttribute("y1",B);J.setAttribute("y2",F);var g;if(B==O.target.getAttribute("cy")){g="y1"}else{g="y2"}if(B<O.target.getAttribute("cy")&&O.target.getAttribute("cy")<F){var h;var b=O.target;document.onmousemove=function(j){h=getDuijioffset(j);b.setAttribute("cy",h.offsetY);if(B>h.offsetY){J.setAttribute("y1",h.offsetY);V.setAttribute("height",V.getAttribute("y")-h.offsetY+parseInt(V.getAttribute("height")));V.setAttribute("y",h.offsetY)}if(F<h.offsetY){J.setAttribute("y2",h.offsetY);V.setAttribute("height",h.offsetY-V.getAttribute("y"))}if(B<h.offsetY&&h.offsetY<F){J.setAttribute("y1",B);J.setAttribute("y2",F)}tianjiaShiZi()};document.onmouseup=function(j){document.onmousemove=null;document.onmouseup=null;jilubianhua()};return}var C=$(O.target.parentNode).children("circle");var a=[];var i=[];var H=[];var G;var L;for(var A=C.length-1;A>=0;A--){if(C[A].getAttribute("cy")==B){G=C[A]}else{if(C[A].getAttribute("cy")==F){L=C[A]}else{a.push(C[A]);i.push(C[A].getAttribute("cy"));H.push(true)}}}var T;var R;if(O.target.getAttribute("id")==G.getAttribute("id")){T=L}else{T=G}R=T.getAttribute("cy");var E=O.target;var N;if(B==O.target.getAttribute("cy")){document.onmousemove=function(m){N=getDuijioffset(m);for(var p=0;p<i.length;p++){if(R>=N.offsetY){if(i[p]<N.offsetY){a[p].setAttribute("cy",N.offsetY)}else{a[p].setAttribute("cy",i[p])}}if(R<N.offsetY){var o=N.offsetY-R;var q=Math.floor(o/(zuhedianjianju*10));console.log("aaaa");console.log(zuhedianjianju);for(var n=0;n<=H.length;n++){if(q>0&&q<=H.length){H[q-1]=false;a[q-1].setAttribute("cy",parseInt(R)+zuhedianjianju*10*q);for(var l=q;l<H.length;l++){H[l]=true}}}if(q==0){for(var l=0;l<H.length;l++){H[l]=true}}if(H[p]==1){a[p].setAttribute("cy",N.offsetY)}}}J.setAttribute(g,N.offsetY);E.setAttribute("cy",N.offsetY);tianjiaShiZi()};document.onmouseup=function(j){document.onmousemove=null;document.onmouseup=null}}else{document.onmousemove=function(m){N=getDuijioffset(m);console.log("kkkk");console.log(a[0]);console.log(G);console.log(T);console.log(E);for(var p=0;p<i.length;p++){if(R<=N.offsetY){if(i[p]>=N.offsetY){a[p].setAttribute("cy",N.offsetY)}else{a[p].setAttribute("cy",i[p])}}if(R>N.offsetY){var o=R-N.offsetY;var q=Math.floor(o/(zuhedianjianju*10));console.log("aaaa");console.log(zuhedianjianju);for(var n=0;n<=H.length;n++){if(q>0&&q<=H.length){H[q-1]=false;a[q-1].setAttribute("cy",parseInt(R)-zuhedianjianju*10*q);for(var l=q;l<H.length;l++){H[l]=true}}}if(q==0){for(var l=0;l<H.length;l++){H[l]=true}}if(H[p]==1){a[p].setAttribute("cy",N.offsetY)}}}J.setAttribute(g,N.offsetY);E.setAttribute("cy",N.offsetY);tianjiaShiZi()};document.onmouseup=function(j){document.onmousemove=null;document.onmouseup=null}}var c=$(O.target.parentNode).children("line")[0];var U=c.getAttribute("y1");var f=c.getAttribute("y2");var S;if(U>f){S=U;U=f;f=S}J.setAttribute("y1",U);J.setAttribute("y2",f);jilubianhua()}return}var Q=O.target.getAttribute("class");var P=O.target;var K;console.log("oooooo");console.log(Q);switch(Q){case"pingline":K=getDuijioffset(O);offx1=parseInt(P.getAttribute("x1")-K.offsetX);offy1=parseInt(P.getAttribute("y1")-K.offsetY);document.onmousemove=function(j){K=getDuijioffset(j);offx=P.getAttribute("x1")-K.offsetX;offy=P.getAttribute("y1")-K.offsetY;P.setAttribute("x1",K.offsetX+offx1);P.setAttribute("y1",K.offsetY+offy1);P.setAttribute("x2",P.getAttribute("x2")-offx+offx1);P.setAttribute("y2",P.getAttribute("y2")-offy+offy1)};jilubianhua();break;case"shuline":K=getDuijioffset(O);offx1=parseInt(P.getAttribute("x1")-K.offsetX);offy1=parseInt(P.getAttribute("y1")-K.offsetY);document.onmousemove=function(j){K=getDuijioffset(j);offx=P.getAttribute("x1")-K.offsetX;offy=P.getAttribute("y1")-K.offsetY;P.setAttribute("x1",K.offsetX+offx1);P.setAttribute("y1",K.offsetY+offy1);P.setAttribute("x2",P.getAttribute("x2")-offx+offx1);P.setAttribute("y2",P.getAttribute("y2")-offy+offy1)};jilubianhua();break;case"shoucontrol":case"control":document.onmousemove=function(j){K=getDuijioffset(j);P.setAttribute("cx",K.offsetX);P.setAttribute("cy",K.offsetY);tianjiaShiZi()};jilubianhua();break;case"fuhao":document.onmousemove=function(j){K=getDuijioffset(j);P.setAttribute("x",K.offsetX);P.setAttribute("y",K.offsetY)};jilubianhua();break;default:break}document.onmouseup=function(j){document.onmousemove=null;document.onmouseup=null;if(P!=null&&P.tagName!="svg"){}}};document.getElementById("canvas").onmousedown=function(B){if(B.button==2){if(gongjushape!=null&&gongjushape.tagName=="rect"){savetolocal();gongjutype=null;gongjushape=null;return}if(gongjutype!=null){jilubianhua()}gongjutype=null;if(gongjushape!=null){if(gongjushape.getAttribute("class")=="pingline"||gongjushape.getAttribute("class")=="shuline"){}}if(gongjushape!=null){if(gongjushape.getAttribute("class")=="pingline"||gongjushape.getAttribute("class")=="shuline"){}}gongjushape=null;if(circlearray.length!=0){for(var A=1;A<circlearray.length;A++){svgg.removeChild(circlearray[A]);console.log(circlearray[A])}circlearray[0].setAttribute("stroke",colorline);circlearray.length=0}}};svg.ondblclick=function(A){if(A.target.tagName=="text"&&A.target.parentNode.getAttribute("createtype")!=null){console.log("llllllll");var K=A.target;$("#dialog1").dialog({title:"输入框",width:200,height:70,modal:false,onClose:function(){var L=document.getElementById("wenzi").value;if(L!=""){K.innerHTML=L;jilubianhua()}},});document.getElementById("dialog1").style.display="block";$("#dialog1").window("move",{left:A.clientX,top:A.clientY,})}var B=A.target.getAttribute("class");if(B==undefined||B==null){return}if(A.target.tagName=="line"&&A.target.parentNode.getAttribute("class")=="zuheline"){var H=A.target;colorline=A.target.getAttribute("stroke");if(circlearray.length!=0){for(var F=1;F<circlearray.length;F++){svgg.removeChild(circlearray[F]);console.log(circlearray[F])}circlearray[0].setAttribute("stroke",colorline);circlearray.length=0}H.setAttribute("stroke","aqua");var G=H.getAttribute("x1");var C=H.getAttribute("y1");var D=H.getAttribute("x2");var E=H.getAttribute("y2");var J=document.createElementNS("http://www.w3.org/2000/svg","circle");var I=document.createElementNS("http://www.w3.org/2000/svg","circle");J.setAttribute("cx",G);J.setAttribute("cy",C);J.setAttribute("r",5);J.setAttribute("stroke","red");J.setAttribute("stroke-width",1);J.setAttribute("fill","red");I.setAttribute("cx",D);I.setAttribute("cy",E);I.setAttribute("r",5);I.setAttribute("stroke","red");I.setAttribute("stroke-width",1);I.setAttribute("fill","red");circlearray.push(H);circlearray.push(J);circlearray.push(I);J.onmousedown=function(M){var N;var L;document.onmousemove=function(O){N=getDuijioffset(O);J.setAttribute("cx",N.offsetX);L=H.parentNode.childNodes;for(var P=0;P<L.length;P++){L[P].setAttribute("x1",N.offsetX)}};document.onmouseup=function(O){document.onmousemove=null;document.onmouseup=null;jilubianhua()}};I.onmousedown=function(L){var M;document.onmousemove=function(N){M=getDuijioffset(N);I.setAttribute("cx",M.offsetX);childnode=H.parentNode.childNodes;for(var O=0;O<childnode.length;O++){childnode[O].setAttribute("x2",M.offsetX)}};document.onmouseup=function(N){document.onmousemove=null;document.onmouseup=null;jilubianhua()}};svgg.appendChild(J);svgg.appendChild(I);return}if(B=="pingline"){var H=A.target;colorline=A.target.getAttribute("stroke");if(circlearray.length!=0){for(var F=1;F<circlearray.length;F++){svgg.removeChild(circlearray[F]);console.log(circlearray[F])}circlearray[0].setAttribute("stroke",colorline);circlearray.length=0}H.setAttribute("stroke","aqua");var G=H.getAttribute("x1");var C=H.getAttribute("y1");var D=H.getAttribute("x2");var E=H.getAttribute("y2");var J=document.createElementNS("http://www.w3.org/2000/svg","circle");var I=document.createElementNS("http://www.w3.org/2000/svg","circle");J.setAttribute("cx",G);J.setAttribute("cy",C);J.setAttribute("r",5);J.setAttribute("stroke","red");J.setAttribute("stroke-width",1);J.setAttribute("fill","red");I.setAttribute("cx",D);I.setAttribute("cy",E);I.setAttribute("r",5);I.setAttribute("stroke","red");I.setAttribute("stroke-width",1);I.setAttribute("fill","red");circlearray.push(H);circlearray.push(J);circlearray.push(I);J.onmousedown=function(L){var M;document.onmousemove=function(N){M=getDuijioffset(N);H.setAttribute("x1",M.offsetX);J.setAttribute("cx",M.offsetX)};document.onmouseup=function(N){document.onmousemove=null;document.onmouseup=null;jilubianhua()}};I.onmousedown=function(L){var M;document.onmousemove=function(N){M=getDuijioffset(N);H.setAttribute("x2",M.offsetX);I.setAttribute("cx",M.offsetX)};document.onmouseup=function(N){document.onmousemove=null;document.onmouseup=null;jilubianhua()}};svgg.appendChild(J);svgg.appendChild(I)}if(B=="shuline"){var H=A.target;colorline=A.target.getAttribute("stroke");if(circlearray.length!=0){for(var F=1;F<circlearray.length;F++){svgg.removeChild(circlearray[F]);console.log(circlearray[F])}circlearray[0].setAttribute("stroke",colorline);circlearray.length=0}H.setAttribute("stroke","aqua");var G=H.getAttribute("x1");var C=H.getAttribute("y1");var D=H.getAttribute("x2");var E=H.getAttribute("y2");var J=document.createElementNS("http://www.w3.org/2000/svg","circle");var I=document.createElementNS("http://www.w3.org/2000/svg","circle");J.setAttribute("cx",G);J.setAttribute("cy",C);J.setAttribute("r",5);J.setAttribute("stroke","red");J.setAttribute("stroke-width",1);J.setAttribute("fill","red");I.setAttribute("cx",D);I.setAttribute("cy",E);I.setAttribute("r",5);I.setAttribute("stroke","red");I.setAttribute("stroke-width",1);I.setAttribute("fill","red");circlearray.push(H);circlearray.push(J);circlearray.push(I);J.onmousedown=function(L){var M;document.onmousemove=function(N){M=getDuijioffset(N);H.setAttribute("y1",M.offsetY);J.setAttribute("cy",M.offsetY)};document.onmouseup=function(N){document.onmousemove=null;document.onmouseup=null;jilubianhua()}};I.onmousedown=function(L){var M;document.onmousemove=function(N){M=getDuijioffset(N);H.setAttribute("y2",M.offsetY);I.setAttribute("cy",M.offsetY)};document.onmouseup=function(N){document.onmousemove=null;document.onmouseup=null;jilubianhua()}};svgg.appendChild(J);svgg.appendChild(I)}if(A.target.tagName=="text"){var K=A.target;$("#dialog1").dialog({title:"输入框",width:200,height:70,modal:false,onClose:function(){var L=document.getElementById("wenzi").value;if(L!=""){K.innerHTML=L;jilubianhua()}},});document.getElementById("dialog1").style.display="block";$("#dialog1").window("move",{left:A.clientX,top:A.clientY,})}};svgg.onmousemove=function(A){var B=A.target;if(B.tagName=="circle"&&B.parentNode.tagName=="g"&&B.parentNode.getAttribute("class")=="zuhedian"){$(B.parentNode).children("line")[0].setAttribute("stroke","aqua");$(B.parentNode).children("line")[0].setAttribute("stroke-width",10)}var C=B.tagName;if((C=="rect"||C=="circle"||C=="line"||C=="text"||C=="polygon"||C=="path")&&B.parentNode.getAttribute("createshape")!=null){hideshowciecle(B.parentNode,"visible")}};svgg.onmouseout=function(A){var B=A.target;if(B.tagName=="circle"&&B.parentNode.tagName=="g"&&B.parentNode.getAttribute("class")=="zuhedian"){$(B.parentNode).children("line")[0].setAttribute("stroke","black");$(B.parentNode).children("line")[0].setAttribute("stroke-width",2)}var C=B.tagName;if((C=="rect"||C=="circle"||C=="line"||C=="text"||C=="polygon"||C=="path")&&B.parentNode.getAttribute("createshape")!=null){hideshowciecle(B.parentNode,"hidden")}};(function(){var O="http://www.w3.org/2000/svg";function U(Ae,Ad,Af){var Ac=Ae.childNodes;for(var Ag=0;Ag<Ac.length;Ag++){if(Ac[Ag].tagName=="g"){U(Ac[Ag],Ad,Af)}else{if(Ac[Ag].tagName!="text"){Ac[Ag].setAttribute(Ad,Af)}if(Ac[Ag].tagName=="text"){Ac[Ag].setAttribute("fill",Af)}}}}var b={1:'<g create="1" c_partid="part_netLabel_VCC" c_etype="pinpart"><circle c_pindot="true" class="pindot" stroke-width="1" cx="400" cy="310" r="1" fill="#4F4F4F" stroke="none"/><text x="390" y="298" font-family="Times New Roman" font-size="9pt" fill="#000080" text-anchor="start">VCC</text><polyline points="400,300 400,310" stroke="#000000" stroke-width="1px" fill="none" /><polyline points="395,300 405,300" stroke="#000000" stroke-width="1px" fill="none" /></g>',2:'<g create="2" eelibtitle="SIP11"><rect id="gge1" x="410" y="296" rx="1" ry="1" width="15" height="7" stroke="#000000" stroke-width="1" fill="none" c_shapetype="line"  /><g id="gge2"><circle c_pindot="true" class="pindot" cx="400" cy="300" r="2" fill="#4F4F4F" stroke="none" /><path d="M400,300 h10" fill="none" stroke="#000000" stroke-width="1"/><text x="413" y="303" font-family="Verdana" font-size="7pt" fill="#800000" text-anchor="start" display="none"  >1</text><text x="404" y="299" font-family="Verdana" font-size="7pt" fill="#800000" text-anchor="end" display="none"  >1</text><circle cx="407" cy="300" r="3" stroke="#000000" fill="none" stroke-width="1" display="none" /><path d="M 410 303 L 413 300 L 410 297" fill="none" stroke="#000000" stroke-width="1"  display="none" /></g></g>',3:'<g create="3" viewBox="353 248 94 94" eelibtitle="HDR2X2" c_origin="400,300" c_para="package`HDR2X2`catid`20`nameDisplay`0`name`HDR2X2`pre`P?`" ><rect id="gge1" x="380" y="280"   width="40" height="30" stroke="#000000" stroke-width="1" fill="none" c_shapetype="line"  /><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="1" c_origin="360,290" id="gge2" c_rotation="180"><circle c_pindot="true" class="pindot" cx="360" cy="290" r="2" fill="#4F4F4F" stroke="none" /><path d="M360,290 h20" fill="none" stroke="#000000" stroke-width="1"/><text x="383" y="293" font-family="Verdana" font-size="7pt" fill="#800000" text-anchor="start"   >1</text><text x="374" y="289" font-family="Verdana" font-size="7pt" fill="#800000" text-anchor="end" display="none"  >1</text><circle cx="377" cy="290" r="3" stroke="#000000" fill="none" stroke-width="1" display="none" /><path d="M 380 293 L 383 290 L 380 287" fill="none" stroke="#000000" stroke-width="1"  display="none" /></g><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="2" c_origin="440,290" id="gge3" c_rotation="0"><circle c_pindot="true" class="pindot" cx="440" cy="290" r="2" fill="#4F4F4F" stroke="none" /><path d="M440,290 h-20" fill="none" stroke="#000000" stroke-width="1"/><text x="417" y="293" font-family="Verdana" font-size="7pt" fill="#800000" text-anchor="end"   >2</text><text x="426" y="289" font-family="Verdana" font-size="7pt" fill="#800000" text-anchor="start" display="none"  >2</text><circle cx="423" cy="290" r="3" stroke="#000000" fill="none" stroke-width="1" display="none" /><path d="M 420 287 L 417 290 L 420 293" fill="none" stroke="#000000" stroke-width="1"  display="none" /></g><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="3" c_origin="360,300" id="gge4" c_rotation="180"><circle c_pindot="true" class="pindot" cx="360" cy="300" r="2" fill="#4F4F4F" stroke="none" /><path d="M360,300 h20" fill="none" stroke="#000000" stroke-width="1"/><text x="383" y="303" font-family="Verdana" font-size="7pt" fill="#800000" text-anchor="start"   >3</text><text x="374" y="299" font-family="Verdana" font-size="7pt" fill="#800000" text-anchor="end" display="none"  >3</text><circle cx="377" cy="300" r="3" stroke="#000000" fill="none" stroke-width="1" display="none" /><path d="M 380 303 L 383 300 L 380 297" fill="none" stroke="#000000" stroke-width="1"  display="none" /></g><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="4" c_origin="440,300" id="gge5" c_rotation="0"><circle c_pindot="true" class="pindot" cx="440" cy="300" r="2" fill="#4F4F4F" stroke="none" /><path d="M440,300 h-20" fill="none" stroke="#000000" stroke-width="1"/><text x="417" y="303" font-family="Verdana" font-size="7pt" fill="#800000" text-anchor="end"   >4</text><text x="426" y="299" font-family="Verdana" font-size="7pt" fill="#800000" text-anchor="start" display="none"  >4</text><circle cx="423" cy="300" r="3" stroke="#000000" fill="none" stroke-width="1" display="none" /><path d="M 420 297 L 417 300 L 420 303" fill="none" stroke="#000000" stroke-width="1"  display="none" /></g></g>',4:'<g create="4" viewBox="373 273 54 54" eelibtitle="Capacitor(US)" c_origin="400,300" c_para="package`C1`name`Capacitor`pre`C?`nameAlias`Value(F)`Value(F)`1u`" ><polyline points="398 308 398 292" stroke="#000000" id="gge1" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="1" c_origin="380,280" id="gge2" c_rotation="180"><circle c_pindot="true" class="pindot" cx="380" cy="300" r="2" fill="#4F4F4F" stroke="none" /><path d="M390,300 h -10" fill="none" stroke="#000" stroke-width="1"/><text x="394" y="300" font-family="Verdana" font-size="7pt" fill="#800" text-anchor="start" display="none"  >1</text><text x="386" y="296" font-family="Verdana" font-size="7pt" fill="#800" text-anchor="end" display="none"  >1</text><circle cx="367" cy="280" r="3" stroke="#000" fill="none" stroke-width="1" display="none" /><path d="M 370 283 L 373 280 L 370 277" fill="none" stroke="#000" stroke-width="1"  display="none" /></g><polyline points="410 300 402 300" stroke="#000000" id="gge3" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><polyline points="402 292 402 308" stroke="#000000" id="gge4" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="2" c_origin="390,280" id="gge5" c_rotation="0"><circle c_pindot="true" class="pindot" cx="420" cy="300" r="2" fill="#4F4F4F" stroke="none" /><path d="M410,300 h 10" fill="none" stroke="#000" stroke-width="1"/><text x="406" y="300" font-family="Verdana" font-size="7pt" fill="#800" text-anchor="end" display="none"  >2</text><text x="414" y="296" font-family="Verdana" font-size="7pt" fill="#800" text-anchor="start" display="none"  >2</text><circle cx="403" cy="280" r="3" stroke="#000" fill="none" stroke-width="1" display="none" /><path d="M 400 277 L 397 280 L 400 283" fill="none" stroke="#000" stroke-width="1"  display="none" /></g><polyline points="398 300 390 300" stroke="#000000" id="gge7" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /></g>',5:'<g create="5" viewBox="364 254 72 72" eelibtitle="LM337" c_para="package`TO220`name`LM337`pre`U?`spicePre`X`nameAlias`Model`Model`LM337`"><g id="gge5"><circle c_pindot="true" class="pindot" cx="370" cy="300" r="2" fill="#4F4F4F" stroke="none" /><path d="M370,300 h5" fill="none" stroke="#000000" stroke-width="1"/><text x="375.6666666666667" y="303" font-family="Verdana" font-size="7pt" fill="#8D2323" text-anchor="start"   >IN</text><text x="369" y="299" font-family="Verdana" font-size="7pt" fill="#8D2323" text-anchor="end" display="none"  >2</text><circle cx="372" cy="300" r="3" stroke="#000000" fill="none" stroke-width="1" display="none" /><path d="M 375 303 L 378 300 L 375 297" fill="none" stroke="#000000" stroke-width="1"  display="none" /></g><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="3" c_origin="430,300" id="gge7" c_rotation="0"><circle c_pindot="true" class="pindot" cx="430" cy="300" r="2" fill="#4F4F4F" stroke="none" /><path d="M430,300 h-5" fill="none" stroke="#000000" stroke-width="1"/><text x="425.3366666666667" y="302.8366666666667" font-family="Verdana" font-size="7pt" fill="#8D2323" text-anchor="end"   >OUT</text><text x="431" y="299" font-family="Verdana" font-size="7pt" fill="#8D2323" text-anchor="start" display="none"  >3</text><circle cx="428" cy="300" r="3" stroke="#000000" fill="none" stroke-width="1" display="none" /><path d="M 425 297 L 422 300 L 425 303" fill="none" stroke="#000000" stroke-width="1"  display="none" /></g><rect id="gge11" x="375" y="280" rx=".2" ry=".2" width="50" height="31" stroke="#000000" stroke-width="2" fill="none" c_shapetype="line"  /><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="2" c_origin="400,270" id="gge12" c_rotation="90"><circle c_pindot="true" class="pindot" cx="400" cy="270" r="2" fill="#4F4F4F" stroke="none" /><path d="M 400 270 v10" fill="none" stroke="#000000" stroke-width="1"/><text x="403" y="282" font-family="Verdana" font-size="7pt" fill="#000000" text-anchor="end"  transform="rotate(270,403,282)" >ADJ</text><text x="399" y="275" font-family="Verdana" font-size="7pt" fill="#000000" text-anchor="start" display="none" transform="rotate(270,399,275)" >1</text><circle cx="400" cy="277" r="3" stroke="#000000" fill="none" stroke-width="1" display="none" /><path d="M 397 280 L 400 283 L 403 280" fill="none" stroke="#000000" stroke-width="1"  display="none" /></g></g>',6:'<g create="6" viewBox="373 273 54 54" eelibtitle="Electrolytic Capacitor(US)" c_origin="400,300" c_para="package`CP_8X13MM`name`Capacitor`pre`C?`nameAlias`Value(F)`Value(F)`1u`" ><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="1" c_origin="400,280" id="gge5" c_rotation="270"><circle c_pindot="true" class="pindot" cx="400" cy="280" r="2" fill="#4F4F4F" stroke="none" /><path d="M 400 280 v 17" fill="none" stroke="#000000" stroke-width="1"/><text x="403" y="300" font-family="Verdana" font-size="7pt" fill="#8D2323" text-anchor="end" display="none" transform="rotate(270,403,300)" >1</text><text x="399" y="291" font-family="Verdana" font-size="7pt" fill="#8D2323" text-anchor="start" display="none" transform="rotate(270,399,291)" >1</text><circle cx="400" cy="300" r="3" stroke="#000000" fill="none" stroke-width="1" display="none" /><path d="M 403 297 L 400 294 L 397 297" fill="none" stroke="#000000" stroke-width="1"  display="none" /></g><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="2" c_origin="400,320" id="gge6" c_rotation="90"><circle c_pindot="true" class="pindot" cx="400" cy="320" r="2" fill="#4F4F4F" stroke="none" /><path d="M 400 320 v -19" fill="none" stroke="#000000" stroke-width="1"/><text x="403" y="298" font-family="Verdana" font-size="7pt" fill="#8D2323" text-anchor="start" display="none" transform="rotate(270,403,298)" >2</text><text x="399" y="307" font-family="Verdana" font-size="7pt" fill="#8D2323" text-anchor="end" display="none" transform="rotate(270,399,307)" >2</text><circle cx="400" cy="298" r="3" stroke="#000000" fill="none" stroke-width="1" display="none" /><path d="M 397 301 L 400 304 L 403 301" fill="none" stroke="#000000" stroke-width="1"  display="none" /></g><polyline points="390 297 410 297" stroke="#000000" id="gge7" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><path d="M 400 301 A 16.0836 16.0836 0 0 1 410 304" id="gge8" c_shapetype="line"  stroke="#000000" stroke-width="1" c_helper_type="arc1" fill="none" /><path d="M 390 304 A 16.2917 16.2917 0 0 1 400 301" id="gge9" c_shapetype="line"  stroke="#000000" stroke-width="1" c_helper_type="arc1" fill="none" /></g>',7:'<g create="7" viewBox="374 272.333984375 52 52" eelibtitle="Inductor(US)" c_origin="400,300" c_para="package`INDUCTOR-1206`name`Inductor`pre`L?`nameAlias`Value(H)`Value(H)`1m`" ><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="2" c_origin="420,300" id="gge9" c_rotation="0"><circle c_pindot="true" class="pindot" cx="420" cy="300" r="2" fill="#4F4F4F" stroke="none" /><path d="M420,300 h-3" fill="none" stroke="#000" stroke-width="1"/><text x="413" y="300" font-family="Verdana" font-size="7pt" fill="#800" text-anchor="end" display="none"  >2</text><text x="421" y="296" font-family="Verdana" font-size="7pt" fill="#800" text-anchor="start" display="none"  >P$2</text><circle cx="420" cy="300" r="3" stroke="#000" fill="none" stroke-width="1" display="none" /><path d="M 417 297 L 414 300 L 417 303" fill="none" stroke="#000" stroke-width="1"  display="none" /></g><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="1" c_origin="380,300" id="gge10" c_rotation="180"><circle c_pindot="true" class="pindot" cx="380" cy="300" r="2" fill="#4F4F4F" stroke="none" /><path d="M380,300 h3" fill="none" stroke="#000" stroke-width="1"/><text x="387" y="300" font-family="Verdana" font-size="7pt" fill="#800" text-anchor="start" display="none"  >1</text><text x="379" y="296" font-family="Verdana" font-size="7pt" fill="#800" text-anchor="end" display="none"  >P$1</text><circle cx="380" cy="300" r="3" stroke="#000" fill="none" stroke-width="1" display="none" /><path d="M 383 303 L 386 300 L 383 297" fill="none" stroke="#000" stroke-width="1"  display="none" /></g><path d="M383.117,299.932 A4,3.9 0 1,1 391.082,299.936" id="gge12" c_shapetype="line"  stroke="#000000" stroke-width="1" c_helper_type="arc1" fill="none" /><path d="M391.6,299.929 A4,3.9 0 1,1 399.565,299.934" id="gge13" c_shapetype="line"  stroke="#000000" stroke-width="1" c_helper_type="arc1" fill="none" /><path d="M400.067,299.929 A4,3.9 0 1,1 408.032,299.934" id="gge14" c_shapetype="line"  stroke="#000000" stroke-width="1" c_helper_type="arc1" fill="none" /><path d="M408.7,299.931 A4,3.9 0 1,1 416.665,299.936" id="gge15" c_shapetype="line"  stroke="#000000" stroke-width="1" c_helper_type="arc1" fill="none" /></g>',8:'<g create="8" viewBox="373.66400146484375 264.9960021972656 52.6719970703125 52.6719970703125" eelibtitle="Potentiometer(US)" c_origin="400,300" c_para="package`TRIM_POT_PTH`name`Potentiometer`pre`R?`spicePre`X`nameAlias`Value(Ω)`Value(Ω)`100k`Model`Potentiometer`K(%)`50`" ><polyline points="390 300 392 296" stroke="#000000" id="gge1" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><polyline points="392 296 394 304" stroke="#000000" id="gge2" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><polyline points="394 304 397 296" stroke="#000000" id="gge3" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><polyline points="397 296 399 304" stroke="#000000" id="gge4" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><polyline points="399 304 401 296" stroke="#000000" id="gge5" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><polyline points="401 296 404 304" stroke="#000000" id="gge6" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><polyline points="404 304 406 296" stroke="#000000" id="gge7" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><polyline points="406 296 409 304" stroke="#000000" id="gge8" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><polyline points="409 304 410 300" stroke="#8D2323" id="gge9" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><polyline points="400 290 400 294" stroke="#8D2323" id="gge12" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="1" c_origin="380,300" id="gge14" c_rotation="180"><circle c_pindot="true" class="pindot" cx="380" cy="300" r="2" fill="#4F4F4F" stroke="none" /><path d="M380,300 h10" fill="none" stroke="#8D2323" stroke-width="1"/><text x="394" y="303" font-family="Verdana" font-size="7pt" fill="#8D2323" text-anchor="start" display="none"  >1</text><text x="386" y="299" font-family="Verdana" font-size="7pt" fill="#8D2323" text-anchor="end" display="none"  >1</text><circle cx="387" cy="300" r="3" stroke="#8D2323" fill="none" stroke-width="1" display="none" /><path d="M 390 303 L 393 300 L 390 297" fill="none" stroke="#8D2323" stroke-width="1"  display="none" /></g><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="2" c_origin="420,300" id="gge15" c_rotation="0"><circle c_pindot="true" class="pindot" cx="420" cy="300" r="2" fill="#4F4F4F" stroke="none" /><path d="M420,300 h-10" fill="none" stroke="#8D2323" stroke-width="1"/><text x="407" y="303" font-family="Verdana" font-size="7pt" fill="#8D2323" text-anchor="end" display="none"  >2</text><text x="414" y="299" font-family="Verdana" font-size="7pt" fill="#8D2323" text-anchor="start" display="none"  >3</text><circle cx="413" cy="300" r="3" stroke="#8D2323" fill="none" stroke-width="1" display="none" /><path d="M 410 297 L 407 300 L 410 303" fill="none" stroke="#8D2323" stroke-width="1"  display="none" /></g><polygon points="398 290 400 294 402 290" stroke="#880000" id="gge16" stroke-width="1" c_shapetype="line"  fill="#880000" stroke-linecap="round" /><ellipse cx="411" cy="297" rx="1" ry="1" id="gge17" stroke="#A00000" stroke-width="1" fill="none" c_shapetype="line"  /><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="3" c_origin="400,280" id="gge18" c_rotation="90"><circle c_pindot="true" class="pindot" cx="400" cy="280" r="2" fill="#4F4F4F" stroke="none" /><path d="M400,280 v10" fill="none" stroke="#880000" stroke-width="1"/><text x="403" y="292" font-family="Verdana" font-size="7pt" fill="#0000FF" text-anchor="end" display="none" transform="rotate(270,403,292)" >3</text><text x="399" y="285" font-family="Verdana" font-size="7pt" fill="#0000FF" text-anchor="start" display="none" transform="rotate(270,399,285)" >2</text><circle cx="400" cy="287" r="3" stroke="#880000" fill="none" stroke-width="1" display="none" /><path d="M 397 290 L 400 293 L 403 290" fill="none" stroke="#880000" stroke-width="1"  display="none" /></g></g>',9:'<g create="9" viewBox="373 273 54 54" eelibtitle="Resistor(US)" c_origin="400,300" c_para="package`R3`name`Resistor`pre`R?`nameAlias`Value(Ω)`Value(Ω)`1k`" ><polyline points="415 300 412 305" stroke="#A00000" id="gge1" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><polyline points="407 295 402 305" stroke="#A00000" id="gge2" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><polyline points="412 305 407 295" stroke="#A00000" id="gge3" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="2" c_origin="420,300" id="gge4" c_rotation="0"><circle c_pindot="true" class="pindot" cx="420" cy="300" r="2" fill="#4F4F4F" stroke="none" /><path d="M 420 300 h -5" fill="none" stroke="#800" stroke-width="1"/><text x="411" y="300" font-family="Verdana" font-size="7pt" fill="#800" text-anchor="end" display="none"  >2</text><text x="419" y="296" font-family="Verdana" font-size="7pt" fill="#800" text-anchor="start" display="none"  >2</text><circle cx="418" cy="300" r="3" stroke="#800" fill="none" stroke-width="1" display="none" /><path d="M 415 297 L 412 300 L 415 303" fill="none" stroke="#800" stroke-width="1"  display="none" /></g><polyline points="393 305 388 295" stroke="#A00000" id="gge5" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><polyline points="402 305 398 295" stroke="#A00000" id="gge6" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><polyline points="398 295 393 305" stroke="#A00000" id="gge7" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><polyline points="388 295 385 300" stroke="#A00000" id="gge8" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="1" c_origin="380,300" id="gge9" c_rotation="180"><circle c_pindot="true" class="pindot" cx="380" cy="300" r="2" fill="#4F4F4F" stroke="none" /><path d="M 380 300 h 5" fill="none" stroke="#800" stroke-width="1"/><text x="389" y="300" font-family="Verdana" font-size="7pt" fill="#800" text-anchor="start" display="none"  >1</text><text x="381" y="296" font-family="Verdana" font-size="7pt" fill="#800" text-anchor="end" display="none"  >1</text><circle cx="382" cy="300" r="3" stroke="#800" fill="none" stroke-width="1" display="none" /><path d="M 385 303 L 388 300 L 385 297" fill="none" stroke="#800" stroke-width="1"  display="none" /></g></g>',10:'<g create="10" viewBox="393 293 44 44" eelibtitle="Resistor 45 Deg(US)" c_origin="400,300" c_para="package`R3`name`Resistor`pre`R?`nameAlias`Value(Ω)`Value(Ω)`1k`" ><polyline points="400 300 404.05 304.3 409.5 302.5 406.55 313.45 417 309.8 413.25 320.349 423.6 316.45 421.05 326.95 425.45 325.9 430 330" stroke="#880000" id="gge12" stroke-width="1" c_shapetype="line"  fill="none" stroke-linecap="round" /><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="1" c_origin="400,300" id="gge13" c_rotation="180"><circle c_pindot="true" class="pindot" cx="400" cy="300" r="2" fill="#4F4F4F" stroke="none" /><path d="M 400 300 h 0" fill="none" stroke="#880000" stroke-width="1"/><text x="402" y="303" font-family="Verdana" font-size="7pt" fill="#0000FF" text-anchor="start" display="none"  >1</text><text x="395" y="299" font-family="Verdana" font-size="7pt" fill="#0000FF" text-anchor="end" display="none"  >1</text><circle cx="397" cy="300" r="3" stroke="#880000" fill="none" stroke-width="1" display="none" /><path d="M 400 303 L 403 300 L 400 297" fill="none" stroke="#880000" stroke-width="1"  display="none" /></g><g c_partid="part_pin" c_etype="pinpart" c_shapetype="group" c_show="show"  c_elec="0" c_spicepin="2" c_origin="430,330" id="gge14" c_rotation="0"><circle c_pindot="true" class="pindot" cx="430" cy="330" r="2" fill="#4F4F4F" stroke="none" /><path d="M430,330 h0" fill="none" stroke="#880000" stroke-width="1"/><text x="428" y="333" font-family="Verdana" font-size="7pt" fill="#0000FF" text-anchor="end" display="none"  >2</text><text x="435" y="329" font-family="Verdana" font-size="7pt" fill="#0000FF" text-anchor="start" display="none"  >2</text><circle cx="433" cy="330" r="3" stroke="#880000" fill="none" stroke-width="1" display="none" /><path d="M 430 327 L 427 330 L 430 333" fill="none" stroke="#880000" stroke-width="1"  display="none" /></g></g>',gnd2:'<g create="gnd2" c_origin="610,500" id="gge41"><circle c_pindot="true" class="pindot" cx="610" cy="500" r="4.00004" fill="#4F4F4F" stroke="none" id="gge42"></circle><text c_note="note_name" x="601.5" y="488" font-family="Times New Roman" font-size="9pt" fill="#000080" text-anchor="start" display="none" id="gge43">GND</text><polyline points="610 510 610 500" stroke="#000000" stroke-width="1" fill="none" id="gge44"></polyline><polyline points="600 510 620 510 610 516 600 510" stroke="#000000" stroke-width="1" fill="none" id="gge45"></polyline></g>',netlabel:'<g create="netlabel" c_origin="240,480" id="gge50"><circle c_pindot="true" class="pindot" cx="240" cy="480" r="4.00004" fill="#ff0000" stroke="none" id="gge51"></circle><text x=242 " y="477.5 " font-family="Times New Roman " font-size="7pt " fill="#000080 " text-anchor="start " id="gge52 ">netLabel1</text></g>',gnd:'<g create="gnd" c_partid="part_netLabel_gnD" c_etype="pinpart" c_origin="630,700" id="gge53" c_shapetype="group" class=""><circle c_pindot="true" class="pindot" cx="630" cy="700" r="4.00004" fill="#4F4F4F" stroke="none" id="gge54"></circle><text x="619" y="687" font-family="Times New Roman" font-size="9pt" fill="#000080" text-anchor="start" display="none" id="gge55">GND</text><polyline points="630 710 630 700" stroke="#000000" stroke-width="1" fill="none" id="gge56"></polyline><polyline points="620 710 639 710" stroke="#000000" stroke-width="1" fill="none" id="gge57"></polyline><polyline points="624 712 637 712" stroke="#000000" stroke-width="1" fill="none" id="gge58"></polyline><polyline points="626 714 633 714" stroke="#000000" stroke-width="1" fill="none" id="gge59"></polyline><polyline points="629 716 631 716" stroke="#000000" stroke-width="1" fill="none" id="gge60"></polyline></g>',netport:'<g create="netport" c_partid="part_netLabel_netPort" c_etype="pinpart" c_origin="480,810" id="gge69" c_shapetype="group" class="active"><circle c_pindot="true" class="pindot" cx="480" cy="810" r="4.00004" fill="#ff0000" stroke="none" id="gge70"></circle><text x="458.5" y="815" font-family="Times New Roman" font-size="8pt" fill="#0000FF" text-anchor="end" id="gge71">label1</text><polyline points="460 804.75 460 815.5 474.25 815.5 480 810 474.75 804.75 459.75 804.75" stroke="#430AFF" stroke-width="1" fill="#FFF7F8" id="gge72"></polyline></g>',vcc2:'<g create="vcc2" c_partid="part_netLabel_VCC" c_etype="pinpart" c_origin="390,280" id="gge73" c_shapetype="group" class=""><circle c_pindot="true" class="pindot" cx="390" cy="280" r="4.00004" fill="#4F4F4F" stroke="none" id="gge74"></circle><text x="380" y="268" font-family="Times New Roman" font-size="9pt" fill="#000080" text-anchor="start" id="gge75">VCC</text><polyline points="390 270 390 280" stroke="#0000ff" stroke-width="1" fill="none" id="gge76"></polyline><polyline points="385 270 395 270" stroke="#0000ff" stroke-width="1" fill="none" id="gge77"></polyline></g>',vcc:'<g create="vcc" c_partid="part_netLabel_+5V" c_etype="pinpart" c_origin="260,310" id="gge78" c_shapetype="group"><circle c_pindot="true" class="pindot" cx="260" cy="310" r="4.00004" fill="#4F4F4F" stroke="none" id="gge79"></circle><text x="250" y="298" font-family="Times New Roman" font-size="9pt" fill="#000080" text-anchor="start" id="gge80">+5V</text><polyline points="260 300 260 310" stroke="#0000ff" stroke-width="1" fill="none" id="gge81"></polyline><polyline points="255 300 265 300" stroke="#0000ff" stroke-width="1" fill="none" id="gge82"></polyline></g>',x:'<g create="x" c_partid="part_no_connect_flag" c_origin="440,350" id="gge83" c_shapetype="group" c_etype="pinpart"><path d="M 436 346 L 446 356 M 446 346 L 436 356" stroke="black" fill="none" stroke-width="2" style="shape-rendering:auto;" id="gge84"></path></g>',volprobe:'<g create="volprobe" c_partid="part_netLabel_volProbe" c_etype="pinpart" c_origin="510,290" id="gge85" c_shapetype="group" class=""><circle c_pindot="true" class="pindot" cx="510" cy="290" r="4.00004" fill="#ff0000" stroke="none" id="gge86"></circle><text x="526" y="300" font-family="Times New Roman" font-size="9pt" fill="#0000FF" text-anchor="start" id="gge87">volProbe1</text><polyline points="510.5 290.5 519.75 300 519.75 305 520.5 299.75 524.75 297.75" stroke="#000000" stroke-width="1" fill="none" id="gge88"></polyline></g>',groupUngroup:'<g create="groupUngroup" c_partid="part_pin" c_show="show" c_elec="0" c_spicepin="1" c_origin="420,470" id="gge89" c_shapetype="group" c_etype="pinpart" class="active"><circle c_pindot="true" class="pindot" cx="420" cy="470" r="4.00004" fill="#4F4F4F" stroke="none" id="gge90"></circle><path d="M 420 470 h -20" fill="none" stroke="#880000" stroke-width="1" id="gge91"></path><text x="398" y="473" font-family="Verdana" font-size="7pt" fill="#0000FF" text-anchor="end" c_pinname="1" id="gge92">1</text><text x="405" y="469" font-family="Verdana" font-size="7pt" fill="#0000FF" text-anchor="start" c_pinnumber="1" id="gge93">1</text><circle cx="403" cy="470" r="3" fill="none" stroke="#880000" stroke-width="1" display="none" id="gge94"></circle><path d="M 400 467 L 397 470 L 400 473" fill="none" stroke="#880000" stroke-width="1" display="none" id="gge95"></path></g>',arrow:'<g create="arrow" c_partid="part_arrowhead" c_origin="640,470" id="gge30" c_shapetype="group" c_etype="pinpart" class="active"><path d="M 640 470 L 636 462 L 648 470 L 636 478 Z " fill="#333333" stroke="none" style="shape-rendering:auto;" id="gge31"></path></g>',text:'<g create="text" c_partid="part_annotation" c_origin="730,350" id="gge32" c_shapetype="group" c_etype="pinpart" class="active"><text x="730" y="350" font-family="Verdana" font-size="9pt" fill="#0000FF" text-anchor="start" type="comment" id="gge33">Text</text></g>'};var i=document.getElementById("canvas");var g=false;function A(Ac){if(Ac.tagName=="svg"||Ac.tagName=="line"||Ac.tagName=="rect"){return null}if(Ac.tagName=="g"&&Ac.parentNode.parentNode.tagName=="svg"){console.log(Ac);return Ac}else{return A(Ac.parentNode)}}i.addEventListener("click",function(Ac){var Ad=A(Ac.target);console.log(Ad);if(Ad!=null){l(Ad,"visible")}});var X=10;function C(){var Ac=document.createElementNS(O,"svg");var Ad=i.getAttribute("width");var Ae=i.getAttribute("height");Ac.setAttribute("width",Ad.substr(0,Ad.length-2));Ac.setAttribute("height",Ae.substring(0,Ae.length-2));Ac.setAttribute("viewBox","0 0 1300 700");Ac.setAttribute("xmlns","http://www.w3.org/2000/svg");Ac.setAttribute("background","#FFFFFF");Ac.setAttribute("gridvisible","yes");createwangge(Ac,Ad.substr(0,Ad.length-2),Ae.substring(0,Ae.length-2));document.getElementById("canvas").appendChild(Ac);return Ac}function v(Ac){if(Ac.target.parentNode.parentNode.tagName=="svg"){return Ac.target.parentNode.parentNode}else{if(Ac.target.parentNode.tagName=="svg"){return Ac.target.parentNode}else{if(Ac.target.tagName=="svg"){return Ac.target}else{return null}}}}function I(Ac){if(Ac==null||Ac.parentNode==null){return}if(Ac.parentNode.tagName=="g"&&Ac.parentNode.parentNode.parentNode.tagName=="svg"){return Ac.parentNode}else{return I(Ac.parentNode)}}i.addEventListener("click",function(Ac){var Ad=Ac.target.getAttribute("create");diantarget=Ac.target;if(Ad==undefined||Ad==null){var Ae=I(Ac.target);if(Ae==null){return}Ad=Ae.getAttribute("create");diantarget=I(Ac.target)}switch(Ad){case"image":M(Ac);break;case"polyline":case"line":case"polygon":case"rect":case"xieline":case"zheline":case"continuexieline":case"quxian":case"pencil":console.log("line");p(Ac);break;case"text":q(Ac);break;case"ellipse":e(Ac);break;case"gnd2":case"netlabel":case"gnd":case"netport":case"vcc2":case"vcc":case"volprobe":case"groupUngroup":case"arrow":case"x":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"10":n(diantarget);break;default:break}});function n(Ac){var Ad=[];Ad.push({"name":"stroke","value":Ac.childNodes[0].getAttribute("stroke"),"group":"原件","editor":{type:"text",options:{required:true,},},});Ad.push({"name":"stroke-width","value":Ac.childNodes[0].getAttribute("stroke-width"),"group":"原件","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",Ad)}function e(Ac){var Ad=[];Ad.push({"name":"cx","value":Ac.target.getAttribute("cx"),"group":"ellipse","editor":{type:"text",options:{required:true,},},});Ad.push({"name":"cy","value":Ac.target.getAttribute("cy"),"group":"ellipse","editor":{type:"text",options:{required:true,},},});Ad.push({"name":"rx","value":Ac.target.getAttribute("rx"),"group":"ellipse","editor":{type:"text",options:{required:true,},},});Ad.push({"name":"ry","value":Ac.target.getAttribute("ry"),"group":"ellipse","editor":{type:"text",options:{required:true,},},});Ad.push({"name":"stroke-width","value":Ac.target.getAttribute("stroke-width"),"group":"ellipse","editor":{type:"text",options:{required:true,},},});Ad.push({"name":"fill","value":Ac.target.getAttribute("fill"),"group":"ellipse","editor":{type:"text",options:{required:true,},},});Ad.push({"name":"stroke","value":Ac.target.getAttribute("stroke"),"group":"ellipse","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",Ad)}function q(Ac){var Ad=[];Ad.push({"name":"x","value":Ac.target.getAttribute("x"),"group":"text","editor":{type:"text",options:{required:true,},},});Ad.push({"name":"y","value":Ac.target.getAttribute("y"),"group":"text","editor":{type:"text",options:{required:true,},},});Ad.push({"name":"fill","value":Ac.target.getAttribute("fill"),"group":"text","editor":{type:"text",options:{required:true,},},});Ad.push({"name":"font-size","value":Ac.target.getAttribute("font-size"),"group":"text","editor":{type:"text",options:{required:true,},},});var Ae=[{"value":"verdana","text":"verdana"},{"value":"arial","text":"arial"}];Ad.push({"name":"font-family","value":Ac.target.getAttribute("font-family"),"group":"text","editor":{panelHeight:20,type:"combobox",options:{data:Ae,valueField:"value",textField:"text",panelHeight:40,onChange:function(Ag,Af){diantarget.setAttribute("font-family",Ag)},},},});$("#propertydiv").propertygrid("loadData",Ad)}function p(Ac){var Ad=[];Ad.push({"name":"stroke","value":Ac.target.getAttribute("stroke"),"group":"line","editor":{type:"text",options:{required:true,},},});Ad.push({"name":"stroke-width","value":Ac.target.getAttribute("stroke-width"),"group":"line","editor":{type:"text",options:{required:true,},},});Ad.push({"name":"fill","value":Ac.target.getAttribute("fill"),"group":"line","editor":{type:"text",options:{required:true,},},});$("#propertydiv").propertygrid("loadData",Ad)}function M(Ad){var Ae=[];Ae.push({"name":"width","value":Ad.target.getAttribute("width"),"group":"image","editor":{type:"text",options:{required:true,},},});Ae.push({"name":"height","value":Ad.target.getAttribute("height"),"group":"image","editor":{type:"text",options:{required:true,},},});var Ac=[{"value":"0","text":"0"},{"value":"90","text":"90"},{"value":"180","text":"180"},{"value":"270","text":"270"}];var Af=Ad.target.getAttribute("transform").split(",");Ae.push({"name":"orientation","value":Af[0].substring(Af[0].indexOf("(")+1,Af[0].length),"group":"image","editor":{panelHeight:20,type:"combobox",options:{data:Ac,valueField:"value",textField:"text",panelHeight:80,onChange:function(Ah,Ag){Af[0]="rotate("+Ah;console.log(Af.join(","));Ad.target.setAttribute("transform",Af.join(","))},},},});$("#propertydiv").propertygrid("loadData",Ae)}function Y(Ad){var Ae=[];Ae.push({"name":"width","value":svg.getAttribute("width"),"group":"svg","editor":"text",});Ae.push({"name":"height","value":svg.getAttribute("height"),"group":"svg","editor":"text",});Ae.push({"name":"background","value":svg.getAttribute("background"),"group":"svg","editor":{type:"text",options:{required:true,},},});var Ac=[{"value":"yes","text":"yes"},{"value":"no","text":"no"}];Ae.push({"name":"gridvisible","value":svg.getAttribute("gridvisible"),"group":"svg","editor":{panelHeight:20,type:"combobox",options:{data:Ac,valueField:"value",textField:"text",panelHeight:40,onChange:function(Ak,Ah){if(Ak=="no"){var Ai=svg.childNodes;for(var Aj=0;Aj<Ai.length;Aj++){if(Ai[Aj].tagName=="line"){Ai[Aj].setAttribute("visibility","hidden")}}}else{var Ai=svg.childNodes;for(var Aj=0;Aj<Ai.length;Aj++){if(Ai[Aj].tagName=="line"){Ai[Aj].setAttribute("visibility","shown")}}}},},},});Ae.push({"name":"gridcolor","value":svg.childNodes[2].getAttribute("stroke"),"group":"svg","editor":{type:"text",options:{required:true,},},});var Af=svg.childNodes[2].getAttribute("stroke-dasharray").split(",")[0];if(Af=="0"){Af="line"}else{Af="dot"}var Ag=[{"value":"line","text":"line"},{"value":"dot","text":"dot"}];Ae.push({"name":"gridstyle","value":Af,"group":"svg","editor":{type:"combobox",options:{data:Ag,valueField:"value",textField:"text",panelHeight:40,onChange:function(Ak,Ah){if(Ak=="line"){var Ai=svg.childNodes;for(var Aj=0;Aj<Ai.length;Aj++){if(Ai[Aj].tagName=="line"){Ai[Aj].setAttribute("stroke-dasharray","0,0")}}}else{var Ai=svg.childNodes;for(var Aj=0;Aj<Ai.length;Aj++){if(Ai[Aj].tagName=="line"){Ai[Aj].setAttribute("stroke-dasharray","2,2")}}}},},},});Ae.push({"name":"gridsize","value":X,"group":"svg","editor":"text",});$("#propertydiv").propertygrid("loadData",Ae)}function Z(Ah,Ai){var Ai=Ai;var Ae={};var Af;var Ad;var Ac;for(var Ag=0;Ag<Ah.childNodes.length;Ag++){var Af=Ah.childNodes[Ag].attributes;var Ac=Ah.childNodes[Ag].attributes.length;for(var Aj in Af){if(Ac>0){Ad=Af[Aj].name;Ai.push({"name":Ad,"value":Ah.childNodes[Ag].getAttribute(Ad),"group":Ah.childNodes[Ag].tagName,"editor":"text",});Ae={};Ac--}}if(Ah.childNodes[Ag].tagName=="text"){Ai.push({"name":"content","value":$(Ah.childNodes[Ag]).html(),"group":Ah.childNodes[Ag].tagName,"editor":"text",})}if(Ah.childNodes[Ag].childNodes.length>0&&Ah.childNodes[Ag].tagName!="text"){Z(Ah.childNodes[Ag],Ai)}}}i.addEventListener("mousedown",function(Ac){if(Ac.button==2){type=null;return}else{if(Ac.button==0){}else{if(Ac.button==1){}}}});function Ab(Al){for(var Af=0;Af<Al.childNodes.length;Af++){var Ak=Al.childNodes[Af];if(Ak.childNodes.length!=0&&Ak.tagName!="text"){Ab(Ak)}else{switch(f(Al.childNodes[Af].tagName)){case"x:y":if(Ak.tagName=="text"){var Ah=Ak.getAttribute("transform");if(Ah!=undefined&&Ah!=null){var Ad=Ah.indexOf("(");var Ap=Ah.substr(Ad+1,Ah.length-2-Ad);var Ag=Ap.split(",");Ag[0]=Ag[0]-0;Ag[1]=Ag[1]-W;Ag[2]=Ag[2]-P;Ak.setAttribute("transform","rotate("+Ag.join(",")+")")}}Ak.setAttribute("x",Ak.getAttribute("x")-W);Ak.setAttribute("y",Ak.getAttribute("y")-P);break;case"cx:cy":Ak.setAttribute("cx",Ak.getAttribute("cx")-W);Ak.setAttribute("cy",Ak.getAttribute("cy")-P);break;case"points":if(Ak.getAttribute("points").indexOf(",")!=-1){var An=Ak.getAttribute("points").split(" ");var Ao=An[0].split(",");var Aq=An[1].split(",");Ao[0]=Ao[0]-W;Ao[1]=Ao[1]-P;Aq[0]=Aq[0]-W;Aq[1]=Aq[1]-P;An[0]=Ao.join(",");An[1]=Aq.join(",");Ak.setAttribute("points",An.join(" "))}else{var Ao=Ak.getAttribute("points").split(" ");for(var Ae=0;Ae<Ao.length;Ae++){Ao[Ae]=Ao[Ae]-W;Ae++;Ao[Ae]=Ao[Ae]-P}Ak.setAttribute("points",Ao.join(" "))}break;case"x1:y1:x2:y2":Ak.setAttribute("x1",Ak.getAttribute("x1")-W);Ak.setAttribute("y1",Ak.getAttribute("y1")-P);Ak.setAttribute("x2",Ak.getAttribute("x2")-W);Ak.setAttribute("y2",Ak.getAttribute("y2")-P);break;case"ML":var Am=Ak.getAttribute("d");var As="";if(Am.indexOf("A")!=-1){if(Am.indexOf(" ")==1){var Ac=Am.split(" ");var Ar=Ac.length;Ac[1]=Ac[1]-W;Ac[2]=Ac[2]-P;Ac[Ar-2]=Ac[Ar-2]-W;Ac[Ar-1]=Ac[Ar-1]-P;As=Ac.join(" ");Ak.setAttribute("d",As);continue}else{var Ac=Am.split(" ");var Aj=Ac[0].substr(1,Ac[0].length-1).split(",");var Ai=Ac[Ac.length-1].split(",");Aj[0]=Aj[0]-W;Aj[1]=Aj[1]-P;Ai[0]=Ai[0]-W;Ai[1]=Ai[1]-P;As="M"+Aj.join(",");for(var Ae=1;Ae<Ac.length-1;Ae++){As=As+" "+Ac[Ae]}As=As+" "+Ai.join(",");Ak.setAttribute("d",As);continue}}if(Am.indexOf(" ")==1&&Am.indexOf(",")==-1){var Aj=Am.split(" ");Aj[1]=Aj[1]-W;Aj[2]=Aj[2]-P;As=Aj.join(" ");Ak.setAttribute("d",As);continue}if(Am.indexOf(" ")==1){var Ac=Am.replace(/\ L/g,"#L").split("#");console.log(Am.replace(/\ L/g,"#L"));var Aj=null;for(var Ae=0;Ae<Ac.length;Ae++){Aj=Ac[Ae].split(" ");Aj[1]=Aj[1]-W;Aj[2]=Aj[2]-P;As=As+Aj.join(" ")+" "}Ak.setAttribute("d",As.substr(0,As.length-1))}else{var Ac=Am.substr(1,Am.length-1).split(" ");var Aj=Ac[0].split(",");Aj[0]=Aj[0]-W;Aj[1]=Aj[1]-P;As="M"+Aj.join(",")+" "+Ac[1];Ak.setAttribute("d",As)}break;default:break}}}}var V=null;var W;var P;var s;var R;var S;function l(Ac,Ae){var Ad=Ac.childNodes;for(var Af=0;Af<Ad.length;Af++){if(Ad[Af].tagName=="g"){l(Ad[Af],Ae)}else{if(Ad[Af].tagName=="circle"){Ad[Af].style.visibility=Ae}}}}function j(Af,Ac){var Aj=b[Af].indexOf(">");var Am=b[Af].substr(3,Aj-5);var Ak=b[Af].substr(Aj+1,b[Af].length-5-Aj);var Ag=Am.replace(/\" /g,'"!').split("!");var Ai;var Ae=document.createElementNS(O,"g");s=B(Ac);$(Ae).html(Ak);$(svgg).append(Ae);while(Ag.length){Ai=Ag.shift().split("=");Af=Ai[0];value=Ae.getAttribute(Af)||Ai[1];if(value!=undefined){value=value.substr(1,value.length-2)}else{value=""}if(Af!=""){Ae.setAttribute(Af,value)}}var Ad=$(Ae).find("circle")[0];console.log(Ad);var Ah=Ac.offsetX;var Al=Ac.offsetY;console.log(Ah+"eeee");if(Ah%X>X/2){Ah=Math.floor(Ah/X)*X+X}else{Ah=Math.floor(Ah/X)*X}if(Al%X>X/2){Al=Math.floor(Al/X)*X+X}else{Al=Math.floor(Al/X)*X}W=Ad.getAttribute("cx")-Ah;P=Ad.getAttribute("cy")-Al;l(Ae,"hidden");D(Ae);Ae.setAttribute("id",E());console.log(svg);Ae.onmouseenter=function(An){l(Ae,"visible")};Ae.onmouseout=function(An){l(Ae,"hidden")}}function F(Ac){var Ad={offsetX:0,offsetY:0};var Af=Ac.offsetX;var Ae=Ac.offsetY;if(Af%X>X/2){Af=Math.floor(Af/X)*X+X}else{Af=Math.floor(Af/X)*X}if(Ae%X>X/2){Ae=Math.floor(Ae/X)*X+X}else{Ae=Math.floor(Ae/X)*X}Ad.offsetX=Af;Ad.offsetY=Ae;return Ad}function t(Ac){if(Ac.childNodes[0].childNodes.length!=0&&Ac.tagName!="text"){t(Ac.childNodes[0])}else{return Ac.childNodes[0]}}function D(Al){for(var Af=0;Af<Al.childNodes.length;Af++){var Ak=Al.childNodes[Af];if(Ak.childNodes.length!=0&&Ak.tagName!="text"){D(Ak)}else{switch(f(Al.childNodes[Af].tagName)){case"x:y":if(Ak.tagName=="text"){var Ah=Ak.getAttribute("transform");if(Ah!=undefined&&Ah!=null){var Ad=Ah.indexOf("(");var Ap=Ah.substr(Ad+1,Ah.length-2-Ad);var Ag=Ap.split(",");Ag[0]=Ag[0]-0;Ag[1]=Ag[1]-W;Ag[2]=Ag[2]-P;Ak.setAttribute("transform","rotate("+Ag.join(",")+")")}}Ak.setAttribute("x",Ak.getAttribute("x")-W);Ak.setAttribute("y",Ak.getAttribute("y")-P);break;case"cx:cy":console.log(Ak.getAttribute("cy")+"ddddd");Ak.setAttribute("cx",Ak.getAttribute("cx")-W);Ak.setAttribute("cy",Ak.getAttribute("cy")-P);break;case"points":if(Ak.getAttribute("points").indexOf(",")!=-1){var An=Ak.getAttribute("points").split(" ");var Ao=An[0].split(",");var Aq=An[1].split(",");Ao[0]=Ao[0]-W;Ao[1]=Ao[1]-P;Aq[0]=Aq[0]-W;Aq[1]=Aq[1]-P;An[0]=Ao.join(",");An[1]=Aq.join(",");Ak.setAttribute("points",An.join(" "))}else{var Ao=Ak.getAttribute("points").split(" ");for(var Ae=0;Ae<Ao.length;Ae++){Ao[Ae]=Ao[Ae]-W;Ae++;Ao[Ae]=Ao[Ae]-P}Ak.setAttribute("points",Ao.join(" "))}break;case"x1:y1:x2:y2":Ak.setAttribute("x1",Ak.getAttribute("x1")-W);Ak.setAttribute("y1",Ak.getAttribute("y1")-P);Ak.setAttribute("x2",Ak.getAttribute("x2")-W);Ak.setAttribute("y2",Ak.getAttribute("y2")-P);break;case"ML":var Am=Ak.getAttribute("d");var As="";if(Am.indexOf("A")!=-1){if(Am.indexOf(" ")==1){var Ac=Am.split(" ");var Ar=Ac.length;Ac[1]=Ac[1]-W;Ac[2]=Ac[2]-P;Ac[Ar-2]=Ac[Ar-2]-W;Ac[Ar-1]=Ac[Ar-1]-P;As=Ac.join(" ");Ak.setAttribute("d",As);continue}else{var Ac=Am.split(" ");var Aj=Ac[0].substr(1,Ac[0].length-1).split(",");var Ai=Ac[Ac.length-1].split(",");Aj[0]=Aj[0]-W;Aj[1]=Aj[1]-P;Ai[0]=Ai[0]-W;Ai[1]=Ai[1]-P;As="M"+Aj.join(",");for(var Ae=1;Ae<Ac.length-1;Ae++){As=As+" "+Ac[Ae]}As=As+" "+Ai.join(",");Ak.setAttribute("d",As);continue}}if(Am.indexOf(" ")==1&&Am.indexOf(",")==-1){var Aj=Am.split(" ");Aj[1]=Aj[1]-W;Aj[2]=Aj[2]-P;As=Aj.join(" ");Ak.setAttribute("d",As);continue}if(Am.indexOf(" ")==1){var Ac=Am.replace(/\ L/g,"#L").split("#");console.log(Am.replace(/\ L/g,"#L"));var Aj=null;for(var Ae=0;Ae<Ac.length;Ae++){Aj=Ac[Ae].split(" ");Aj[1]=Aj[1]-W;Aj[2]=Aj[2]-P;console.log(Ac);console.log(Aj+"pppp");As=As+Aj.join(" ")+" "}Ak.setAttribute("d",As.substr(0,As.length-1))}else{var Ac=Am.substr(1,Am.length-1).split(" ");var Aj=Ac[0].split(",");Aj[0]=Aj[0]-W;Aj[1]=Aj[1]-P;console.log(Ac);console.log(Aj);As="M"+Aj.join(",")+" "+Ac[1];if(Ac.length==3){As=As+Ac[2]}Ak.setAttribute("d",As)}break;default:break}}}}function J(Ag){var Ac=shapeInfo[Ag.tagName].split(",,");var Af,Ad,Ae;while(Ac.length){Af=Ac.shift().split("::");Ad=Af[0];Ae=Af[1];console.log(Ae);Ag.setAttribute(Ad,Ae)}for(Ad in defaultAttrs){if(Ag.tagName=="polygon"){break}Ae=Ag.getAttribute(Ad)||defaultAttrs[Ad];Ag.setAttribute(Ad,Ae)}V=Ag}function B(Ad){Ad=Ad||window.event;var Ac={x:0,y:0};if(Ad.clientX||Ad.clientY){Ac.x=Ad.offsetX;Ac.y=Ad.offsetY}else{Ac.x=Ad.clientX+document.body.scrollLeft-document.body.clientLeft;Ac.y=Ad.clientY+document.documentElement.scrollTop}return Ac}function f(Ac){switch(Ac){case"rect":return"x:y";break;case"text":return"x:y";break;case"circle":return"cx:cy";break;case"ellipse":return"cx:cy";break;case"polygon":return"points";break;case"polyline":return"points";break;case"line":return"x1:y1:x2:y2";break;case"path":return"ML";break;default:break}}var H=0;var h=new Array();var w;var m=null;var L;var K=0;var Aa;var G=null;var N=new Array();var T=new Array();var u=new Array();function Q(Ac,Ao){var Aj=b[Ao].indexOf(">");var Ap=b[Ao].substr(3,Aj-5);var Al=b[Ao].substr(Aj+1,b[Ao].length-5-Aj);var Ag=Ap.replace(/\" /g,'"!').split("!");var Ai;var Ae=document.createElementNS(O,"g");$(Ae).html(Al);$(svgg).append(Ae);var Af;var Ak;while(Ag.length){Ai=Ag.shift().split("=");Af=Ai[0];Ak=Ae.getAttribute(Af)||Ai[1];if(Ak!=undefined){Ak=Ak.substr(1,Ak.length-2)}else{Ak=""}if(Af!=""){Ae.setAttribute(Af,Ak)}}var Am=$(Ae).find("path")[0];var Ad=Am.getAttribute("d").split(" ");var An=F(Ac);W=Ad[1]-An.offsetX;P=Ad[2]-An.offsetY;Ad[1]=Ad[1]-W;Ad[2]=Ad[2]-P;Ad[4]=Ad[4]-W;Ad[5]=Ad[5]-P;Ad[7]=Ad[7]-W;Ad[8]=Ad[8]-P;Ad[10]=Ad[10]-W;Ad[11]=Ad[11]-P;Am.setAttribute("d",Ad.join(" "));Ae.setAttribute("id",E());jilubianhua();var Ah=Ae;Ah.onmouseenter=function(Aq){Ah.childNodes[0].setAttribute("stroke","aqua")};Ah.onmouseout=function(Aq){Ah.childNodes[0].setAttribute("stroke","#0000FF")}}var o=null;var c;var k=null;var a=null;svg.addEventListener("click",function(Ac){var Ad=F(Ac);console.log(svgg);console.log(type);switch(type){case"rect":H=2;if(o==null){o=document.createElementNS("http://www.w3.org/2000/svg","polygon");o.setAttribute("create","rect");o.setAttribute("stroke","#0000FF");o.setAttribute("stroke-width",2);o.setAttribute("fill","none");var Aj=F(Ac);c=new Array();for(var Ai=0;Ai<4;Ai++){c.push(Aj.offsetX);c.push(Aj.offsetY)}console.log(c+"iiii");o.setAttribute("points",c.join(" "));svgg.appendChild(o)}break;case"polygon":H=2;if(a==null){a=document.createElementNS("http://www.w3.org/2000/svg","polygon");w=new Array();a.setAttribute("create","polygon");a.setAttribute("stroke","#0000FF");a.setAttribute("stroke-width",2);a.setAttribute("fill","none");w[0]=Ad.offsetX;w[1]=Ad.offsetY;a.setAttribute("points",w.join(" "));svgg.appendChild(a)}else{w.push(Ad.offsetX);w.push(Ad.offsetY)}break;case"ellipse":H=2;if(k==null){k=document.createElementNS("http://www.w3.org/2000/svg","ellipse");k.setAttribute("create","ellipse");k.setAttribute("stroke","#0000FF");k.setAttribute("stroke-width",3);k.setAttribute("fill","none");var Aj=F(Ac);k.setAttribute("cx",Aj.offsetX);k.setAttribute("cy",Aj.offsetY);k.setAttribute("rx",0);k.setAttribute("ry",0);svgg.appendChild(k)}break;case"arrow":type="arrow";Q(Ac,type);break;case"text":type="text";var Ah=document.createElementNS(O,"text");Ah.setAttribute("create","text");Ah.setAttribute("x",Ac.offsetX);Ah.setAttribute("y",Ac.offsetY);Ah.setAttribute("font-family","Verdana");Ah.setAttribute("font-size","9pt");Ah.setAttribute("fill","#0000FF");Ah.setAttribute("text-anchor","start");Ah.setAttribute("type","comment");Ah.innerHTML="Text";Ah.setAttribute("id",E());jilubianhua();svgg.appendChild(Ah);break;case"gnd2":type="gnd2";j(type,Ac);break;case"gnd":type="gnd";j(type,Ac);break;case"groupUngroup":type="groupUngroup";j(type,Ac);break;case"netlabel":type="netlabel";j(type,Ac);break;case"netport":type="netport";j(type,Ac);break;case"vcc2":type="vcc2";j(type,Ac);break;case"vcc":type="vcc";j(type,Ac);break;case"volprobe":type="volprobe";j(type,Ac);break;case"x":type="x";Q(Ac,type);break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"10":j(type,Ac);break;case"arc":if(N.length==0){G=document.createElementNS("http://www.w3.org/2000/svg","ellipse");G.setAttribute("create","arc");G.setAttribute("cx",Ad.offsetX);G.setAttribute("cy",Ad.offsetY);G.setAttribute("stroke","#0000FF");G.setAttribute("stroke-width",2);G.setAttribute("fill","none");var Ae=document.createElementNS("http://www.w3.org/2000/svg","line");Ae.setAttribute("x1",Ad.offsetX);Ae.setAttribute("y1",Ad.offsetY);Ae.setAttribute("stroke","#0000FF");Ae.setAttribute("stroke-width",2);Ae.setAttribute("fill","none");N.push(Ae);svgg.appendChild(G);svgg.appendChild(Ae)}else{N[N.length-1].setAttribute("x2",Ad.offsetX);N[N.length-1].setAttribute("y2",Ad.offsetY);var Ae=document.createElementNS("http://www.w3.org/2000/svg","line");Ae.setAttribute("x1",N[0].getAttribute("x1"));Ae.setAttribute("y1",N[0].getAttribute("y1"));Ae.setAttribute("stroke","#0000FF");Ae.setAttribute("stroke-width",2);Ae.setAttribute("fill","none");N.push(Ae);svgg.appendChild(Ae);if(N.length==1){G.setAttribute("rx",Math.abs(Ad.offsetX-G.getAttribute("cx")));G.setAttribute("ry",Math.abs(Ad.offsetY-G.getAttribute("cy")))}}break;case"xieline":var Ae=document.createElementNS("http://www.w3.org/2000/svg","line");Ae.setAttribute("create","xieline");Ae.setAttribute("x1",Ad.offsetX);Ae.setAttribute("y1",Ad.offsetY);Ae.setAttribute("x2",Ad.offsetX+10);Ae.setAttribute("y2",Ad.offsetY-10);Ae.setAttribute("stroke","#0000FF");Ae.setAttribute("stroke-width",3);var Af=Ae;Af.onmouseenter=function(Ak){Af.setAttribute("stroke","aqua")};Af.onmouseout=function(Ak){Af.setAttribute("stroke","#0000FF")};Ae.setAttribute("id",E());jilubianhua();svgg.appendChild(Ae);break;case"zheline":H=2;if(polyline==null){polyline=document.createElementNS("http://www.w3.org/2000/svg","polyline");w=new Array();polyline.setAttribute("create","zheline");polyline.setAttribute("stroke","#0000FF");polyline.setAttribute("stroke-width",2);polyline.setAttribute("fill","none");w[0]=Ad.offsetX;w[1]=Ad.offsetY;polyline.setAttribute("points",w.join(" "));svgg.appendChild(polyline)}else{if(h.length!=0){w.push(h[0]);w.push(h[1])}w.push(Ad.offsetX);w.push(Ad.offsetY)}break;case"continuexieline":H=2;if(polyline==null){polyline=document.createElementNS("http://www.w3.org/2000/svg","polyline");w=new Array();polyline.setAttribute("create","continuexieline");polyline.setAttribute("stroke","#0000FF");polyline.setAttribute("stroke-width",2);polyline.setAttribute("fill","none");w[0]=Ad.offsetX;w[1]=Ad.offsetY;polyline.setAttribute("points",w.join(" "));svgg.appendChild(polyline)}else{w.push(Ad.offsetX);w.push(Ad.offsetY)}break;case"quxian":H=2;if(m==null){m=document.createElementNS("http://www.w3.org/2000/svg","path");w=new Array();L=new Array();Aa=new Array();Aa.push(document.createElementNS("http://www.w3.org/2000/svg","line"));Aa[0].setAttribute("stroke","#00EE00");Aa[0].setAttribute("stroke-width",2);Aa[0].setAttribute("fill","none");Aa[0].setAttribute("style","stroke-dasharray: 5,5");Aa[0].setAttribute("x1",Ad.offsetX);Aa[0].setAttribute("y1",Ad.offsetY);Aa[0].setAttribute("x2",Ad.offsetX);Aa[0].setAttribute("y2",Ad.offsetY);svgg.appendChild(Aa[0]);K=0;m.setAttribute("create","quxian");m.setAttribute("stroke","#0000FF");m.setAttribute("stroke-width",2);m.setAttribute("fill","none");w[0]=Ad.offsetX;w[1]=Ad.offsetY;L.push(Ad.offsetX);L.push(Ad.offsetY);L.push(Ad.offsetX);L.push(Ad.offsetY);L.push(Ad.offsetX);L.push(Ad.offsetY);m.setAttribute("d","M"+w.join(" ")+" C"+L.join(" "));svgg.appendChild(m)}else{K++;if(K%3==0){L.push(Ad.offsetX);L.push(Ad.offsetY);L.push(Ad.offsetX);L.push(Ad.offsetY);L.push(Ad.offsetX);L.push(Ad.offsetY);if(Aa.length!=1){Aa[Aa.length-1].setAttribute("x2",Ad.offsetX);Aa[Aa.length-1].setAttribute("y2",Ad.offsetY);var Ag=document.createElementNS("http://www.w3.org/2000/svg","line");Aa.push(Ag);Ag.setAttribute("stroke","#00EE00");Ag.setAttribute("stroke-width",2);Ag.setAttribute("fill","none");Ag.setAttribute("style","stroke-dasharray: 5,5");Ag.setAttribute("x1",Ad.offsetX);Ag.setAttribute("y1",Ad.offsetY);Ag.setAttribute("x2",Ad.offsetX);Ag.setAttribute("y2",Ad.offsetY);svgg.appendChild(Ag)}}if(K%3==1){var Ag=document.createElementNS("http://www.w3.org/2000/svg","line");Aa.push(Ag);Ag.setAttribute("stroke","#00EE00");Ag.setAttribute("stroke-width",2);Ag.setAttribute("fill","none");Ag.setAttribute("style","stroke-dasharray: 5,5");Ag.setAttribute("x1",Ad.offsetX);Ag.setAttribute("y1",Ad.offsetY);Ag.setAttribute("x2",Ad.offsetX);Ag.setAttribute("y2",Ad.offsetY);svgg.appendChild(Ag)}if(K%3==2){Aa[Aa.length-1].setAttribute("x1",Ad.offsetX);Aa[Aa.length-1].setAttribute("y1",Ad.offsetY);Aa[Aa.length-1].setAttribute("x2",Ad.offsetX);Aa[Aa.length-1].setAttribute("y2",Ad.offsetY)}}break;default:break}if(Ac.button==2){type=null;return}console.log(type)});svg.addEventListener("mousemove",function(Ac){var Ad=F(Ac);switch(type){case"rect":if(o!=null){var Ah=F(Ac);for(var Af=2;Af<c.length;Af++){if(Af==2){c[Af]=Ah.offsetX;Af++;c[Af]=c[1]}else{if(Af==4){c[Af]=Ah.offsetX;Af++;c[Af]=Ah.offsetY}else{c[Af]=c[0];Af++;c[Af]=Ah.offsetY}}}console.log(c+"rrrrr");o.setAttribute("points",c.join(" "))}break;case"polygon":if(a!=null){var Ai=Ad.offsetX;var Aj=Ad.offsetY;console.log(Ai);var Ae=Math.abs(Ai-w[w.length-2]);var Ag=Math.abs(Aj-w[w.length-1]);console.log(Ae);console.log(Ag);if(Ag==0&&Ae==0){return}else{a.setAttribute("points",w.join(" ")+" "+Ai+" "+Aj)}}break;case"ellipse":if(k!=null){k.setAttribute("rx",Ad.offsetX-k.getAttribute("cx"));k.setAttribute("ry",Ad.offsetY-k.getAttribute("cy"))}break;case"arc":if(N.length>0){if(N.length==1){G.setAttribute("rx",Math.abs(Ad.offsetX-G.getAttribute("cx")));G.setAttribute("ry",Math.abs(Ad.offsetY-G.getAttribute("cy")))}N[N.length-1].setAttribute("x2",Ad.offsetX);N[N.length-1].setAttribute("y2",Ad.offsetY)}break;case"zheline":if(polyline!=null){var Ai=Ad.offsetX;var Aj=Ad.offsetY;var Ae=Math.abs(Ai-w[w.length-2]);var Ag=Math.abs(Aj-w[w.length-1]);if(Ag==0){if(Ae==0){h.length=0;return}else{h.length=0;polyline.setAttribute("points",w.join(" ")+" "+Ai+" "+Aj);return}}else{if(Ae==0){h.length=0;polyline.setAttribute("points",w.join(" ")+" "+Ai+" "+Aj);return}}if(Ag>Ae){h[0]=w[w.length-2];h[1]=Aj;polyline.setAttribute("points",w.join(" ")+" "+h.join(" ")+" "+Ai+" "+Aj)}else{h[0]=Ai;h[1]=w[w.length-1];polyline.setAttribute("points",w.join(" ")+" "+h.join(" ")+" "+Ai+" "+Aj)}}break;case"continuexieline":if(polyline!=null){var Ai=Ad.offsetX;var Aj=Ad.offsetY;console.log(Ai);var Ae=Math.abs(Ai-w[w.length-2]);var Ag=Math.abs(Aj-w[w.length-1]);console.log(Ae);console.log(Ag);if(Ag==0&&Ae==0){return}else{polyline.setAttribute("points",w.join(" ")+" "+Ai+" "+Aj)}}break;case"quxian":if(m!=null){var Ai=Ad.offsetX;var Aj=Ad.offsetY;var Ae;var Ag;if(K%3==0){if(K==0){Ae=Math.abs(Ai-w[0]);Ag=Math.abs(Aj-w[1])}else{Ae=Math.abs(Ai-L[2*K-2]);Ag=Math.abs(Aj-L[2*K-1])}}else{Ae=Math.abs(Ai-L[2*K]);Ag=Math.abs(Aj-L[2*K+1])}if(Ag==0&&Ae==0){return}else{if(K%3==0){L[K*2]=Ai;L[K*2+1]=Aj;L[K*2+2]=Ai;L[K*2+3]=Aj;L[K*2+4]=Ai;L[K*2+5]=Aj;m.setAttribute("d","M"+w.join(" ")+" C"+L.join(" "))}else{if(K%3==1){L[K*2]=Ai;L[K*2+1]=Aj;L[K*2+2]=Ai;L[K*2+3]=Aj;m.setAttribute("d","M"+w.join(" ")+" C"+L.join(" "))}else{L[K*2]=Ai;L[K*2+1]=Aj;m.setAttribute("d","M"+w.join(" ")+" C"+L.join(" "))}}Aa[Aa.length-1].setAttribute("x2",Ai);Aa[Aa.length-1].setAttribute("y2",Aj)}}break;default:break}});svg.addEventListener("dblclick",function(Af){if(Af.target.tagName=="line"&&Af.target.parentNode.tagName=="svg"){return}if(Af.target.tagName=="g"&&Af.target.id=="svgcontent"){return}if(Af.target.tagName=="svg"){return}if(T.length!=0){for(var Ai=1;Ai<T.length;Ai++){svgg.removeChild(T[Ai]);console.log(T[Ai])}if(!isstroke){T[0].setAttribute("stroke","#0000FF");isstroke=false}T.length=0;type=null}for(var Ai=0;Ai<u.length;Ai++){svgg.removeChild(u[Ai])}u.length=0;var Ao=Af.target.getAttribute("create");diantarget=Af.target;if(Ao==undefined||Ao==null){var AA=I(Af.target);if(AA==null){return}Ao=AA.getAttribute("create");diantarget=I(Af.target)}switch(Ao){case"image":break;case"line":var Ad=diantarget;if(T.length!=0){for(var Ai=1;Ai<T.length;Ai++){svgg.removeChild(T[Ai]);console.log(T[Ai])}if(!isstroke){T[0].setAttribute("stroke","#0000FF");isstroke=false}T.length=0;type=null}Ad.setAttribute("stroke","aqua");var Ay=Ad.getAttribute("x1");var Az=Ad.getAttribute("y1");var AB=Ad.getAttribute("x2");var AC=Ad.getAttribute("y2");var Aq=document.createElementNS("http://www.w3.org/2000/svg","circle");var Ap=document.createElementNS("http://www.w3.org/2000/svg","circle");Aq.setAttribute("cx",Ay);Aq.setAttribute("cy",Az);Aq.setAttribute("r",5);Aq.setAttribute("stroke","red");Aq.setAttribute("stroke-width",1);Aq.setAttribute("fill","red");Ap.setAttribute("cx",AB);Ap.setAttribute("cy",AC);Ap.setAttribute("r",5);Ap.setAttribute("stroke","red");Ap.setAttribute("stroke-width",1);Ap.setAttribute("fill","red");T.push(Ad);T.push(Aq);T.push(Ap);Aq.onmousedown=function(AD){var AE;document.onmousemove=function(AF){AE=F(AF);Ad.setAttribute("x1",AE.offsetX);Ad.setAttribute("y1",AE.offsetY);Aq.setAttribute("cx",AE.offsetX);Aq.setAttribute("cy",AE.offsetY)};document.onmouseup=function(AF){document.onmousemove=null;document.onmouseup=null};jilubianhua()};Ap.onmousedown=function(AD){var AE;document.onmousemove=function(AF){AE=F(AF);Ad.setAttribute("x2",AE.offsetX);Ad.setAttribute("y2",AE.offsetY);Ap.setAttribute("cx",AE.offsetX);Ap.setAttribute("cy",AE.offsetY)};document.onmouseup=function(AF){document.onmousemove=null;document.onmouseup=null};jilubianhua()};svgg.appendChild(Aq);svgg.appendChild(Ap);break;case"polygon":var Ac=diantarget;if(T.length!=0){for(var Ai=1;Ai<T.length;Ai++){svgg.removeChild(T[Ai]);console.log(T[Ai])}if(!isstroke){T[0].setAttribute("stroke","#0000FF");isstroke=false}T.length=0;type=null}T[0]=Ac;T[0].setAttribute("stroke","aqua");var Ar=T[0].getAttribute("points").split(" ");for(var Ai=0;Ai<Ar.length;Ai++){var Ah=document.createElementNS("http://www.w3.org/2000/svg","circle");Ah.setAttribute("cx",Ar[Ai]);Ah.setAttribute("sign",Ai);Ai++;Ah.setAttribute("cy",Ar[Ai]);Ah.setAttribute("r",5);Ah.setAttribute("stroke","red");Ah.setAttribute("stroke-width",1);Ah.setAttribute("fill","red");Ah.onmousedown=function(AD){var AF=AD.target;var AE;document.onmousemove=function(AH){var AG=parseInt(AF.getAttribute("sign"));AE=F(AH);Ar[AG]=AE.offsetX;Ar[AG+1]=AE.offsetY;T[0].setAttribute("points",Ar.join(" "));AF.setAttribute("cx",AE.offsetX);AF.setAttribute("cy",AE.offsetY)};document.onmouseup=function(AG){document.onmousemove=null;document.onmouseup=null};jilubianhua()};T.push(Ah);svgg.appendChild(Ah)}break;case"rect":var Ac=diantarget;if(T.length!=0){for(var Ai=1;Ai<T.length;Ai++){svgg.removeChild(T[Ai]);console.log(T[Ai])}if(!isstroke){T[0].setAttribute("stroke","#0000FF");isstroke=false}T.length=0;type=null}T[0]=Ac;T[0].setAttribute("stroke","aqua");var At=Ac.getAttribute("points").split(" ");for(var Ag=0;Ag<At.length;Ag++){var Ah=document.createElementNS("http://www.w3.org/2000/svg","circle");Ah.setAttribute("sign",Ag);Ah.setAttribute("r",5);Ah.setAttribute("stroke","red");Ah.setAttribute("stroke-width",1);Ah.setAttribute("fill","red");Ah.setAttribute("cx",At[Ag]);Ag++;Ah.setAttribute("cy",At[Ag]);T.push(Ah);svgg.appendChild(Ah);Ah.onmousedown=function(AD){var AF=AD.target;var AE;document.onmousemove=function(AG){var AH=parseInt(AF.getAttribute("sign"));AE=F(AG);if(AH==0){At[0]=AE.offsetX;At[1]=AE.offsetY;At[3]=AE.offsetY;T[2].setAttribute("cy",AE.offsetY);At[6]=AE.offsetX;T[4].setAttribute("cx",AE.offsetX)}else{if(AH==2){At[2]=AE.offsetX;At[3]=AE.offsetY;At[1]=AE.offsetY;T[1].setAttribute("cy",AE.offsetY);At[4]=AE.offsetX;T[3].setAttribute("cx",AE.offsetX)}else{if(AH==4){At[4]=AE.offsetX;At[5]=AE.offsetY;At[7]=AE.offsetY;T[2].setAttribute("cx",AE.offsetX);At[2]=AE.offsetX;T[4].setAttribute("cy",AE.offsetY)}else{At[6]=AE.offsetX;At[7]=AE.offsetY;At[5]=AE.offsetY;T[3].setAttribute("cy",AE.offsetY);At[0]=AE.offsetX;T[1].setAttribute("cx",AE.offsetX)}}}AF.setAttribute("cx",AE.offsetX);AF.setAttribute("cy",AE.offsetY);T[0].setAttribute("points",At.join(" "))};document.onmouseup=function(AG){document.onmousemove=null;document.onmouseup=null};jilubianhua()}}break;case"xieline":break;case"zheline":var Ac=diantarget;if(T.length!=0){for(var Ai=1;Ai<T.length;Ai++){svgg.removeChild(T[Ai]);console.log(T[Ai])}if(!isstroke){T[0].setAttribute("stroke","#0000FF");isstroke=false}T.length=0;type=null}console.log(polyline+"ddddddd");T[0]=Ac;T[0].setAttribute("stroke","aqua");var Ar=T[0].getAttribute("points").split(" ");console.log(Ar);for(var Ai=0;Ai<Ar.length;Ai++){var Ah=document.createElementNS("http://www.w3.org/2000/svg","circle");Ah.setAttribute("cx",Ar[Ai]);Ah.setAttribute("sign",Ai);Ai++;Ah.setAttribute("cy",Ar[Ai]);console.log(Ai);Ah.setAttribute("r",5);Ah.setAttribute("stroke","red");Ah.setAttribute("stroke-width",1);Ah.setAttribute("fill","red");console.log(Ar[Ai]);Ah.onmousedown=function(AD){var AF=AD.target;var AE;document.onmousemove=function(AH){var AG=parseInt(AF.getAttribute("sign"));AE=F(AH);Ar[AG]=AE.offsetX;Ar[AG+1]=AE.offsetY;T[0].setAttribute("points",Ar.join(" "));AF.setAttribute("cx",AE.offsetX);AF.setAttribute("cy",AE.offsetY)};document.onmouseup=function(AG){document.onmousemove=null;document.onmouseup=null};jilubianhua()};T.push(Ah);svgg.appendChild(Ah)}break;case"continuexieline":var Ac=diantarget;if(T.length!=0){for(var Ai=1;Ai<T.length;Ai++){svgg.removeChild(T[Ai]);console.log(T[Ai])}if(!isstroke){T[0].setAttribute("stroke","#0000FF");isstroke=false}T.length=0;type=null}console.log(polyline+"ddddddd");T[0]=Ac;T[0].setAttribute("stroke","aqua");var Ar=T[0].getAttribute("points").split(" ");console.log(Ar);for(var Ai=0;Ai<Ar.length;Ai++){var Ah=document.createElementNS("http://www.w3.org/2000/svg","circle");Ah.setAttribute("cx",Ar[Ai]);Ah.setAttribute("sign",Ai);Ai++;Ah.setAttribute("cy",Ar[Ai]);console.log(Ai);Ah.setAttribute("r",5);Ah.setAttribute("stroke","red");Ah.setAttribute("stroke-width",1);Ah.setAttribute("fill","red");console.log(Ar[Ai]);Ah.onmousedown=function(AD){var AF=AD.target;var AE;document.onmousemove=function(AH){var AG=parseInt(AF.getAttribute("sign"));AE=F(AH);Ar[AG]=AE.offsetX;Ar[AG+1]=AE.offsetY;T[0].setAttribute("points",Ar.join(" "));AF.setAttribute("cx",AE.offsetX);AF.setAttribute("cy",AE.offsetY)};document.onmouseup=function(AG){document.onmousemove=null;document.onmouseup=null};jilubianhua()};T.push(Ah);svgg.appendChild(Ah)}break;case"quxian":var Aw=diantarget;var Am=Aw.getAttribute("d");var Ak=Am.indexOf("C");var An=Am.substring(1,Ak-1).split(" ");var Ae=Am.substr(Ak+1,Am.length-Ak-1).split(" ");console.log(An);console.log(Ae);if(T.length!=0){for(var Ai=1;Ai<T.length;Ai++){svgg.removeChild(T[Ai]);console.log(T[Ai])}if(!isstroke){T[0].setAttribute("stroke","#0000FF");isstroke=false}T.length=0;type=null}for(var Ai=0;Ai<u.length;Ai++){svgg.removeChild(u[Ai])}u.length=0;T.push(Aw);Aw.setAttribute("stroke","aqua");for(var Ai=0;Ai<An.length+Ae.length;Ai++){if(Ai==0){var Au=document.createElementNS("http://www.w3.org/2000/svg","line");Au.setAttribute("stroke","#00EE00");Au.setAttribute("stroke-width",2);Au.setAttribute("fill","none");Au.setAttribute("style","stroke-dasharray: 5,5");Au.setAttribute("x1",An[0]);Au.setAttribute("y1",An[1]);Au.setAttribute("x2",Ae[0]);Au.setAttribute("y2",Ae[1]);u.push(Au);svgg.appendChild(Au)}else{if(Ai%4==0){var Au=document.createElementNS("http://www.w3.org/2000/svg","line");Au.setAttribute("stroke","#00EE00");Au.setAttribute("stroke-width",2);Au.setAttribute("fill","none");Au.setAttribute("style","stroke-dasharray: 5,5");Au.setAttribute("x1",Ae[Ai-2]);Au.setAttribute("y1",Ae[Ai-1]);Au.setAttribute("x2",Ae[Ai]);Au.setAttribute("y2",Ae[Ai+1]);u.push(Au);svgg.appendChild(Au)}}var Ah=document.createElementNS("http://www.w3.org/2000/svg","circle");if(Ai==0){Ah.setAttribute("cx",An[Ai]);Ah.setAttribute("sign",Ai);Ah.setAttribute("cy",An[Ai+1]);Ah.setAttribute("r",5);Ah.setAttribute("stroke","red");Ah.setAttribute("stroke-width",1);Ah.setAttribute("fill","red");Ah.setAttribute("sign",Ai)}else{Ah.setAttribute("cx",Ae[Ai-2]);Ah.setAttribute("sign",Ai);Ah.setAttribute("cy",Ae[Ai-1]);Ah.setAttribute("r",5);Ah.setAttribute("stroke","red");Ah.setAttribute("stroke-width",1);Ah.setAttribute("fill","red");Ah.setAttribute("sign",Ai)}Ai++;T.push(Ah);svgg.appendChild(Ah);Ah.onmousedown=function(AD){var AF=AD.target;var AE;document.onmousemove=function(AH){AE=F(AH);var AG=parseInt(AF.getAttribute("sign"));if(AG==0){An[AG]=AE.offsetX;An[AG+1]=AE.offsetY}else{Ae[AG-2]=AE.offsetX;Ae[AG-1]=AE.offsetY}var AI=Math.floor(AG/4);if(AG%4==0){u[AI].setAttribute("x1",AE.offsetX);u[AI].setAttribute("y1",AE.offsetY)}else{u[AI].setAttribute("x2",AE.offsetX);u[AI].setAttribute("y2",AE.offsetY)}T[0].setAttribute("d","M"+An.join(" ")+" C"+Ae.join(" "));AF.setAttribute("cx",AE.offsetX);AF.setAttribute("cy",AE.offsetY)};document.onmouseup=function(AG){document.onmousemove=null;document.onmouseup=null};jilubianhua()}}break;case"pencil":break;case"text":txt=diantarget;$("#dialog").dialog({title:"输入框",width:200,height:70,modal:false,onClose:function(){var AD=document.getElementById("zhushi").value;if(AD!=""){txt.innerHTML=AD}},});document.getElementById("dialog").style.display="block";$("#dialog").window("move",{left:Af.clientX,top:Af.clientY,});break;case"ellipse":var Av=diantarget;if(T.length!=0){for(var Ai=1;Ai<T.length;Ai++){svgg.removeChild(T[Ai]);console.log(T[Ai])}if(!isstroke){T[0].setAttribute("stroke","#0000FF");isstroke=false}T.length=0;type=null}console.log(Av);console.log("fffff");T[0]=Av;T[0].setAttribute("stroke","aqua");var As=parseInt(Av.getAttribute("cx"));var Ax=parseInt(Av.getAttribute("cy"));var Aj=parseInt(Av.getAttribute("rx"));var Al=parseInt(Av.getAttribute("ry"));for(var Ag=0;Ag<4;Ag++){var Ah=document.createElementNS("http://www.w3.org/2000/svg","circle");Ah.setAttribute("sign",Ag);Ah.setAttribute("r",5);Ah.setAttribute("stroke","red");Ah.setAttribute("stroke-width",1);Ah.setAttribute("fill","red");if(Ag==0){Ah.setAttribute("cx",As-Aj);Ah.setAttribute("cy",Ax-Al)}else{if(Ag==1){Ah.setAttribute("cx",As+Aj);Ah.setAttribute("cy",Ax-Al)}else{if(Ag==2){Ah.setAttribute("cx",As+Aj);Ah.setAttribute("cy",Ax+Al)}else{Ah.setAttribute("cx",As-Aj);Ah.setAttribute("cy",Ax+Al)}}}T.push(Ah);svgg.appendChild(Ah);Ah.onmousedown=function(AE){var AG=AE.target;var AF;var AH,AD;document.onmousemove=function(AI){var AJ=parseInt(AG.getAttribute("sign"));AF=F(AI);AH=(AJ)%4+1;AD=(AJ+2)%4+1;As=(parseInt(T[AH].getAttribute("cx"))+parseInt(T[AD].getAttribute("cx")))/2;Ax=(parseInt(T[AH].getAttribute("cy"))+parseInt(T[AD].getAttribute("cy")))/2;Aj=Math.abs(parseInt(T[AH].getAttribute("cx"))-parseInt(T[AD].getAttribute("cx")))/2;Al=Math.abs(parseInt(T[AH].getAttribute("cy"))-parseInt(T[AD].getAttribute("cy")))/2;T[0].setAttribute("cx",As);T[0].setAttribute("cy",Ax);T[0].setAttribute("rx",Aj);T[0].setAttribute("ry",Al);if(AJ==0){T[2].setAttribute("cy",AF.offsetY);T[4].setAttribute("cx",AF.offsetX)}else{if(AJ==1){T[1].setAttribute("cy",AF.offsetY);T[3].setAttribute("cx",AF.offsetX)}else{if(AJ==2){T[2].setAttribute("cx",AF.offsetX);T[4].setAttribute("cy",AF.offsetY)}else{T[1].setAttribute("cx",AF.offsetX);T[3].setAttribute("cy",AF.offsetY)}}}AG.setAttribute("cx",AF.offsetX);AG.setAttribute("cy",AF.offsetY)};document.onmouseup=function(AI){document.onmousemove=null;document.onmouseup=null};jilubianhua()}}break;case"gnd2":case"netlabel":case"gnd":case"netport":case"vcc2":case"vcc":case"volprobe":case"groupUngroup":case"arrow":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"10":break;default:break}});i.addEventListener("mousedown",function(An){if(An.target.tagName=="line"&&An.target.parentNode.tagName=="svg"){return}if(An.target.tagName=="g"&&An.target.id=="svgcontent"){return}if(An.target.tagName=="svg"){return}var Aj=An.target.getAttribute("create");diantarget=An.target;if(Aj==undefined||Aj==null){var At=I(An.target);if(At==null){return}Aj=At.getAttribute("create");diantarget=I(An.target)}var Al=F(An);switch(Aj){case"image":var As=diantarget;document.onmousemove=function(Av){As.setAttribute("x",Av.offsetX);As.setAttribute("y",Av.offsetY)};break;case"line":var Ag;var Af;var Ak;document.onmousemove=function(Av){Ak=F(Av);console.log(diantarget.getAttribute("x1"));Ag=diantarget.getAttribute("x1")-Ak.offsetX;Af=diantarget.getAttribute("y1")-Ak.offsetY;console.log(Ag+"dddd");diantarget.setAttribute("x1",Ak.offsetX);diantarget.setAttribute("y1",Ak.offsetY);diantarget.setAttribute("x2",diantarget.getAttribute("x2")-Ag);diantarget.setAttribute("y2",diantarget.getAttribute("y2")-Af)};break;case"ellipse":var Ac=diantarget;var Ak=F(An);var Ao=parseInt(Ac.getAttribute("cx")-Ak.offsetX);var Ae=parseInt(Ac.getAttribute("cy")-Ak.offsetY);document.onmousemove=function(Av){Ak=F(Av);Ac.setAttribute("cx",Ak.offsetX+Ao);Ac.setAttribute("cy",Ak.offsetY+Ae)};break;case"text":var Am=diantarget;var Ak=F(An);var Ao=parseInt(Am.getAttribute("x")-Ak.offsetX);var Ae=parseInt(Am.getAttribute("y")-Ak.offsetY);document.onmousemove=function(Av){Am.setAttribute("x",Av.offsetX+Ao);Am.setAttribute("y",Av.offsetY+Ae)};break;case"pencil":var Ah;var Au=diantarget.getAttribute("d").split(" ");Au[0]=Au[0].substr(1,Au[0].length-1);Au[2]=Au[2].substr(1,Au[2].length-1);var Ak=F(An);var Ao=parseInt(Au[0]-Ak.offsetX);var Ae=parseInt(Au[1]-Ak.offsetY);document.onmousemove=function(Av){Ak=F(Av);W=Au[0]-Ak.offsetX;P=Au[1]-Ak.offsetY;Au[0]=Ak.offsetX+Ao;Au[1]=Ak.offsetY+Ae;Au[2]=Au[2]-W+Ao;Au[3]=Au[3]-P+Ae;Ah="M"+Au[0]+" "+Au[1]+" L"+Au[2]+" "+Au[3]+" ";for(var Aw=4;Aw<Au.length;Aw++){Au[Aw]=Au[Aw]-W+Ao;Ah=Ah+Au[Aw]+" ";Aw++;Au[Aw]=Au[Aw]-P+Ae;Ah=Ah+Au[Aw]+" "}diantarget.setAttribute("d",Ah)};break;case"quxian":var Ah;var Au=diantarget.getAttribute("d").split(" ");Au[0]=Au[0].substr(1,Au[0].length-1);Au[2]=Au[2].substr(1,Au[2].length-1);var Ak=F(An);var Ao=parseInt(Au[0]-Ak.offsetX);var Ae=parseInt(Au[1]-Ak.offsetY);document.onmousemove=function(Av){Ak=F(Av);W=Au[0]-Ak.offsetX;P=Au[1]-Ak.offsetY;Au[0]=Ak.offsetX+Ao;Au[1]=Ak.offsetY+Ae;Au[2]=Au[2]-W+Ao;Au[3]=Au[3]-P+Ae;Ah="M"+Au[0]+" "+Au[1]+" C"+Au[2]+" "+Au[3]+" ";for(var Aw=4;Aw<Au.length;Aw++){Au[Aw]=Au[Aw]-W+Ao;Ah=Ah+Au[Aw]+" ";Aw++;Au[Aw]=Au[Aw]-P+Ae;Ah=Ah+Au[Aw]+" "}diantarget.setAttribute("d",Ah)};break;case"continuexieline":var Ar=diantarget.getAttribute("points").split(" ");var Ak=F(An);var Ao=parseInt(Ar[0]-Ak.offsetX);var Ae=parseInt(Ar[1]-Ak.offsetY);document.onmousemove=function(Av){Ak=F(Av);W=Ar[0]-Ak.offsetX;P=Ar[1]-Ak.offsetY;Ar[0]=Ak.offsetX+Ao;Ar[1]=Ak.offsetY+Ae;for(var Aw=2;Aw<Ar.length;Aw++){Ar[Aw]=Ar[Aw]-W+Ao;Aw++;Ar[Aw]=Ar[Aw]-P+Ae}diantarget.setAttribute("points",Ar.join(" "))};break;case"zheline":var Ak;var Ar=diantarget.getAttribute("points").split(" ");var Ak=F(An);var Ao=parseInt(Ar[0]-Ak.offsetX);var Ae=parseInt(Ar[1]-Ak.offsetY);document.onmousemove=function(Av){Ak=F(Av);W=Ar[0]-Ak.offsetX;P=Ar[1]-Ak.offsetY;Ar[0]=Ak.offsetX+Ao;Ar[1]=Ak.offsetY+Ae;for(var Aw=2;Aw<Ar.length;Aw++){Ar[Aw]=Ar[Aw]-W+Ao;Aw++;Ar[Aw]=Ar[Aw]-P+Ae}diantarget.setAttribute("points",Ar.join(" "))};break;case"xieline":var Ai=diantarget;var Ap;document.onmousemove=function(Av){Ap=F(Av);Ai.setAttribute("x1",Ap.offsetX);Ai.setAttribute("y1",Ap.offsetY);Ai.setAttribute("x2",Ap.offsetX+10);Ai.setAttribute("y2",Ap.offsetY-10)};break;case"rect":var Ad=diantarget;var Aq;Aq=Ad.getAttribute("points").split(" ");var Ak=F(An);var Ao=parseInt(Aq[0]-Ak.offsetX);var Ae=parseInt(Aq[1]-Ak.offsetY);document.onmousemove=function(Av){Ak=F(Av);Aq=Ad.getAttribute("points").split(" ");W=Aq[0]-Ak.offsetX;P=Aq[1]-Ak.offsetY;for(var Aw=0;Aw<Aq.length;Aw++){Aq[Aw]=Aq[Aw]-W+Ao;Aw++;Aq[Aw]=Aq[Aw]-P+Ae}Ad.setAttribute("points",Aq.join(" "))};break;case"polygon":var Ar=diantarget.getAttribute("points").split(" ");var Ak=F(An);var Ao=parseInt(Ar[0]-Ak.offsetX);var Ae=parseInt(Ar[1]-Ak.offsetY);document.onmousemove=function(Av){Ak=F(Av);W=Ar[0]-Ak.offsetX;P=Ar[1]-Ak.offsetY;Ar[0]=Ak.offsetX+Ao;Ar[1]=Ak.offsetY+Ae;for(var Aw=2;Aw<Ar.length;Aw++){Ar[Aw]=Ar[Aw]-W+Ao;Aw++;Ar[Aw]=Ar[Aw]-P+Ae}diantarget.setAttribute("points",Ar.join(" "))};break;case"arrow":case"x":var Ak;document.onmousemove=function(Av){var Ay=$(diantarget).find("path")[0];var Aw=Ay.getAttribute("d").split(" ");var Ax=F(Av);W=Aw[1]-Ax.offsetX;P=Aw[2]-Ax.offsetY;Aw[1]=Ax.offsetX;Aw[2]=Ax.offsetY;Aw[4]=Aw[4]-W;Aw[5]=Aw[5]-P;Aw[7]=Aw[7]-W;Aw[8]=Aw[8]-P;Aw[10]=Aw[10]-W;Aw[11]=Aw[11]-P;Ay.setAttribute("d",Aw.join(" "))};break;case"gnd2":case"netlabel":case"gnd":case"netport":case"vcc2":case"vcc":case"volprobe":case"groupUngroup":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"10":document.onmousemove=function(Aw){var Av=$(diantarget).find("circle")[0];var Ax=F(Aw);W=Av.getAttribute("cx")-Ax.offsetX;P=Av.getAttribute("cy")-Ax.offsetY;console.log(W);console.log(P);Ab(diantarget)};break;default:break}document.onmouseup=function(Av){document.onmousemove=null;document.onmouseup=null}});svg.addEventListener("mousedown",function(Ac){if(Ac.button==2){if(T.length!=0){for(var Ai=1;Ai<T.length;Ai++){svgg.removeChild(T[Ai])}if(!isstroke){T[0].setAttribute("stroke","#0000FF");isstroke=false}T.length=0;type=null}for(var Ai=0;Ai<u.length;Ai++){svgg.removeChild(u[Ai])}u.length=0}var Ad=F(Ac);switch(type){case"rect":if(Ac.button==2){if(H==2){H=1;var Af=o;Af.onmouseenter=function(Al){Af.setAttribute("stroke","aqua")};Af.onmouseout=function(Al){Af.setAttribute("stroke","#0000FF")};o.setAttribute("id",E());jilubianhua();o=null}else{H=0;type=null}}break;case"polygon":if(Ac.button==2){if(H==2){H=1;var Af=a;Af.onmouseenter=function(Al){Af.setAttribute("stroke","aqua")};Af.onmouseout=function(Al){Af.setAttribute("stroke","#0000FF")};a.setAttribute("id",E());jilubianhua();a=null}else{H=0;type=null}}break;case"ellipse":if(Ac.button==2){if(H==2){H=1;var Af=k;Af.onmouseenter=function(Al){Af.setAttribute("stroke","aqua")};Af.onmouseout=function(Al){Af.setAttribute("stroke","#0000FF")};k.setAttribute("id",E());jilubianhua();k=null}else{H=0;type=null}}break;case"image":if(Ac.button==2){type=null}break;case"arrow":if(Ac.button==2){type=null}break;case"text":if(Ac.button==2){type=null}break;case"gnd2":if(Ac.button==2){type=null}break;case"gnd":if(Ac.button==2){type=null}break;case"groupUngroup":if(Ac.button==2){type=null}break;case"netlabel":if(Ac.button==2){type=null}break;case"netport":if(Ac.button==2){type=null}break;case"pin":if(Ac.button==2){type=null}break;case"vcc2":if(Ac.button==2){type=null}break;case"vcc":if(Ac.button==2){type=null}break;case"volprobe":if(Ac.button==2){type=null}break;case"x":if(Ac.button==2){type=null}break;case"xieline":if(Ac.button==2){type=null}break;case"arc":if(Ac.button==2){type=null;N[N.length-1].setAttribute("x2",Ad.offsetX);N[N.length-1].setAttribute("y2",Ad.offsetY)}break;case"pencil":if(Ac.button==2){type=null;break}var Ae=document.createElementNS("http://www.w3.org/2000/svg","path");Ae.setAttribute("create","pencil");Ae.setAttribute("stroke","#0000FF");Ae.setAttribute("stroke-width",2);Ae.setAttribute("fill","none");var Ag=new Array();var Ah=new Array();Ag.push(Ac.offsetX);Ag.push(Ac.offsetY);Ah.push(Ac.offsetX);Ah.push(Ac.offsetY);Ae.setAttribute("d","M"+Ag.join(" ")+" L"+Ah.join(" "));var Af=Ae;Af.onmouseenter=function(Al){Af.setAttribute("stroke","aqua")};Af.onmouseout=function(Al){Af.setAttribute("stroke","#0000FF")};svgg.appendChild(Ae);document.onmousemove=function(Al){var Al=Al||window.event;Ah[Ah.length-2]=Al.offsetX;Ah[Ah.length-1]=Al.offsetY;if((Al.offsetX-Ag[0])>3||(Al.offsetY-Ag[1])>3){Ah.push(Al.offsetX);Ah.push(Al.offsetY);Ae.setAttribute("d","M"+Ag.join(" ")+" L"+Ah.join(" "))}};Ae.setAttribute("id",E());jilubianhua();break;case"line":if(Ac.button==2){type=null}var Ak=document.createElementNS("http://www.w3.org/2000/svg","line");Ak.setAttribute("create","line");Ak.setAttribute("x1",Ad.offsetX);Ak.setAttribute("y1",Ad.offsetY);Ak.setAttribute("x2",Ad.offsetX);Ak.setAttribute("y2",Ad.offsetY);Ak.setAttribute("stroke","#0000FF");Ak.setAttribute("stroke-width",2);var Af=Ak;Af.onmouseenter=function(Al){Af.setAttribute("stroke","aqua")};Af.onmouseout=function(Al){Af.setAttribute("stroke","#0000FF")};var Aj;document.onmousemove=function(Al){var Al=Al||window.event;Aj=F(Al);Ak.setAttribute("x2",Aj.offsetX);Ak.setAttribute("y2",Aj.offsetY);svgg.appendChild(Ak)};Ak.setAttribute("id",E());jilubianhua();break;case"zheline":if(Ac.button==2){if(H==2){H=1;var Af=polyline;Af.onmouseenter=function(Al){Af.setAttribute("stroke","aqua")};Af.onmouseout=function(Al){Af.setAttribute("stroke","#0000FF")};polyline.setAttribute("id",E());jilubianhua();polyline=null}else{H=0;type=null}}break;case"continuexieline":if(Ac.button==2){if(H==2){H=1;var Af=polyline;Af.onmouseenter=function(Al){Af.setAttribute("stroke","aqua")};Af.onmouseout=function(Al){Af.setAttribute("stroke","#0000FF")};polyline.setAttribute("id",E());jilubianhua();polyline=null}else{H=0;type=null}}break;case"quxian":if(Ac.button==2){if(H==2){H=1;for(var Ai=0;Ai<Aa.length;Ai++){svgg.removeChild(Aa[Ai])}Aa.length=0;var Af=m;Af.onmouseenter=function(Al){Af.setAttribute("stroke","aqua")};Af.onmouseout=function(Al){Af.setAttribute("stroke","#0000FF")};m.setAttribute("id",E());jilubianhua();m=null}else{H=0;type=null}}break;default:break}document.onmouseup=function(Al){document.onmousemove=null;document.onmouseup=null}});function E(){var Ac=new Date();return"svg"+Ac.getTime()}})();